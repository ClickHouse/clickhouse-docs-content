"use strict";(self.webpackChunkclickhouse=self.webpackChunkclickhouse||[]).push([[83668],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return h}});var i=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,i,n=function(e,t){if(null==e)return{};var a,i,n={},o=Object.keys(e);for(i=0;i<o.length;i++)a=o[i],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)a=o[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=i.createContext({}),c=function(e){var t=i.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},u=function(e){var t=c(e.components);return i.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},p=i.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(a),h=n,m=p["".concat(l,".").concat(h)]||p[h]||d[h]||o;return a?i.createElement(m,r(r({ref:t},u),{},{components:a})):i.createElement(m,r({ref:t},u))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,r=new Array(o);r[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,r[1]=s;for(var c=2;c<o;c++)r[c]=a[c];return i.createElement.apply(null,r)}return i.createElement.apply(null,a)}p.displayName="MDXCreateElement"},81748:function(e,t,a){a.r(t),a.d(t,{assets:function(){return u},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return d}});var i=a(87462),n=a(63366),o=(a(67294),a(3905)),r=["components"],s={},l="Getting Started with ClickHouse Cloud",c={unversionedId:"en/guide/index",id:"en/guide/index",title:"Getting Started with ClickHouse Cloud",description:"With ClickHouse Cloud, we are building a turnkey hosted ClickHouse experience! This guide will help you get started with creating a new ClickHouse Service, creating a table and inserting data. We have included some important details and helpful tips that you need to be aware of as you start using the ClickHouse Cloud.",source:"@site/docs/en/guide/index.md",sourceDirName:"en/guide",slug:"/en/guide/",permalink:"/docs/en/guide/",draft:!1,editUrl:"https://github.com/ClickHouse/clickhouse-docs/blob/main/docs/en/guide/index.md",tags:[],version:"current",frontMatter:{}},u={},d=[{value:"Important Details\u200b",id:"important-detailsdirect-link-to-heading",level:2},{value:"1. Invite your team members\u200b",id:"1-invite-your-team-membersdirect-link-to-heading",level:4},{value:"2. We only show you the password once\u2026\u200b",id:"2-we-only-show-you-the-password-oncedirect-link-to-heading",level:4},{value:"3. The Play UI is available for connecting to your service\u200b",id:"3-the-play-ui-is-available-for-connecting-to-your-servicedirect-link-to-heading",level:4},{value:"4. You can also connect using HTTP or the native protocol\u200b",id:"4-you-can-also-connect-using-http-or-the-native-protocoldirect-link-to-heading",level:4},{value:"5. The default Database\u200b",id:"5-the-default-databasedirect-link-to-heading",level:4},{value:"6. Supported table engines\u200b",id:"6-supported-table-enginesdirect-link-to-heading",level:4},{value:"7. Insert Data\u200b",id:"7-insert-datadirect-link-to-heading",level:4},{value:"8. Available AWS Regions\u200b",id:"8-available-aws-regionsdirect-link-to-heading",level:4},{value:"Known Limitations\u200b",id:"known-limitationsdirect-link-to-heading",level:2},{value:"0. CREATE DATABASE is not available\u200b",id:"0-create-database-is-not-availabledirect-link-to-heading",level:4},{value:"1. Access to external systems is limited\u200b",id:"1-access-to-external-systems-is-limiteddirect-link-to-heading",level:4},{value:"2. Unavailable functions and settings\u200b",id:"2-unavailable-functions-and-settingsdirect-link-to-heading",level:4},{value:"3. Backups are not available yet\u200b",id:"3-backups-are-not-available-yetdirect-link-to-heading",level:4},{value:"4. Security limitations\u200b",id:"4-security-limitationsdirect-link-to-heading",level:4},{value:"5. Observability\u200b",id:"5-observabilitydirect-link-to-heading",level:4},{value:"6. CREATE AS SELECT queries\u200b",id:"6-create-as-select-queriesdirect-link-to-heading",level:4},{value:"Common Tasks\u200b",id:"common-tasksdirect-link-to-heading",level:2},{value:"1. Using the clickhouse-client\u200b",id:"1-using-the-clickhouse-clientdirect-link-to-heading",level:3},{value:"On Linux\u200b",id:"on-linuxdirect-link-to-heading",level:4},{value:"1. Download and install the ClickHouse binary for Linux:",id:"1-download-and-install-the-clickhouse-binary-for-linux",level:5},{value:"2. Copy-and-paste the command provided from the <strong>&quot;Native&quot;</strong> tab on the Services links pop-up:",id:"2-copy-and-paste-the-command-provided-from-the-native-tab-on-the-services-links-pop-up",level:5},{value:"On Mac\u200b",id:"on-macdirect-link-to-heading",level:4},{value:"1. Download the <code>clickhouse</code> binary for Mac",id:"1-download-the-clickhouse-binary-for-mac",level:5},{value:"2. Start the <code>clickhouse client</code>. You can copy and paste this from the Services links pop-up, but notice the binary you are running is slightly different (change <code>clickhouse-client</code> to <code>./clickhouse client</code>):",id:"2-start-the-clickhouse-client-you-can-copy-and-paste-this-from-the-services-links-pop-up-but-notice-the-binary-you-are-running-is-slightly-different-change-clickhouse-client-to-clickhouse-client",level:5},{value:"On Windows\u200b",id:"on-windowsdirect-link-to-heading",level:4},{value:"1. The <code>clickhouse-client</code> can run inside WSL (Windows Subsystem for Linux), so start by following the install instructions for WSL if you do not have it installed already. From the WSL prompt, run the command provided from the &quot;Native&quot; tab on the Services links pop-up (the same command as Linux above):",id:"1-the-clickhouse-client-can-run-inside-wsl-windows-subsystem-for-linux-so-start-by-following-the-install-instructions-for-wsl-if-you-do-not-have-it-installed-already-from-the-wsl-prompt-run-the-command-provided-from-the-native-tab-on-the-services-links-pop-up-the-same-command-as-linux-above",level:5},{value:"Using Docker\u200b",id:"using-dockerdirect-link-to-heading",level:4},{value:"1. Use the <code>clickhouse/clickhouse-server</code> image in Docker Hub to run the <code>clickhouse-client</code> in a Docker container:",id:"1-use-the-clickhouseclickhouse-server-image-in-docker-hub-to-run-the-clickhouse-client-in-a-docker-container",level:5},{value:"2. Insert Data from a Local File\u200b",id:"2-insert-data-from-a-local-filedirect-link-to-heading",level:3},{value:"1. First create the table, either from the <code>clickhouse-client</code> prompt or using the Play UI. The dataset represents New York City taxi rides:",id:"1-first-create-the-table-either-from-the-clickhouse-client-prompt-or-using-the-play-ui-the-dataset-represents-new-york-city-taxi-rides",level:5},{value:"2. If you are at the <code>clickhouse-client</code> prompt, exit it:",id:"2-if-you-are-at-the-clickhouse-client-prompt-exit-it",level:5},{value:"3. Download the file, which consists of about 1M rows of taxi rides:",id:"3-download-the-file-which-consists-of-about-1m-rows-of-taxi-rides",level:5},{value:"4. Run the following command to unzip the file, stream it to the <code>clickhouse-client</code> and insert it into the trips table. Be sure to modify the <code>clickhouse-client</code> portion of the command to match your OS (see the Linux, Mac, Windows and Docker options above):",id:"4-run-the-following-command-to-unzip-the-file-stream-it-to-the-clickhouse-client-and-insert-it-into-the-trips-table-be-sure-to-modify-the-clickhouse-client-portion-of-the-command-to-match-your-os-see-the-linux-mac-windows-and-docker-options-above",level:5},{value:"5. When the insertion is complete, run the following query from either the <code>clickhouse-client</code> or the Play UI to verify you have about a 1M rows in trips (999,825 to be precise):",id:"5-when-the-insertion-is-complete-run-the-following-query-from-either-the-clickhouse-client-or-the-play-ui-to-verify-you-have-about-a-1m-rows-in-trips-999825-to-be-precise",level:5},{value:"6. Run a query to see how fast 1M rows can be processed by ClickHouse:",id:"6-run-a-query-to-see-how-fast-1m-rows-can-be-processed-by-clickhouse",level:5},{value:"3. Insert Data using the HTTP Interface\u200b",id:"3-insert-data-using-the-http-interfacedirect-link-to-heading",level:3},{value:"1. Download the file first:",id:"1-download-the-file-first",level:5},{value:"2. Create the <code>trips</code> table defined in the previous section.",id:"2-create-the-trips-table-defined-in-the-previous-section",level:5},{value:"3. Unzip the <code>.gz</code> file and pipe the output to curl:",id:"3-unzip-the-gz-file-and-pipe-the-output-to-curl",level:5},{value:"NOTE",id:"note",level:5},{value:"4. Create a table from files in S3\u200b",id:"4-create-a-table-from-files-in-s3direct-link-to-heading",level:3},{value:"1. Start by creating the table. Notice the table engine is <code>ReplicatedMergeTree</code>, which means it will automatically be replicated across the nodes in your cluster.",id:"1-start-by-creating-the-table-notice-the-table-engine-is-replicatedmergetree-which-means-it-will-automatically-be-replicated-across-the-nodes-in-your-cluster",level:5},{value:"2. Utilizing the <code>s3</code> function, insert approximately 1M rows into the table. This will take around 10s to execute:",id:"2-utilizing-the-s3-function-insert-approximately-1m-rows-into-the-table-this-will-take-around-10s-to-execute",level:5},{value:"3. Confirm the data is available with a simple query to count the average fare per passenger count:",id:"3-confirm-the-data-is-available-with-a-simple-query-to-count-the-average-fare-per-passenger-count",level:5},{value:"5. Use S3 for table storage\u200b",id:"5-use-s3-for-table-storagedirect-link-to-heading",level:3},{value:"1. Start by creating the table that uses the <code>S3</code> table engine:",id:"1-start-by-creating-the-table-that-uses-the-s3-table-engine",level:5},{value:"2. Run the following query to compute the average fare by passenger count. This should take around 15s to execute on most getting started clusters. View the S3 table function page in the docs for further details on the S3 function and table engine.",id:"2-run-the-following-query-to-compute-the-average-fare-by-passenger-count-this-should-take-around-15s-to-execute-on-most-getting-started-clusters-view-the-s3-table-function-page-in-the-docs-for-further-details-on-the-s3-function-and-table-engine",level:5},{value:"6. Connect a UI\u200b",id:"6-connect-a-uidirect-link-to-heading",level:3},{value:"Users and Roles\u200b",id:"users-and-rolesdirect-link-to-heading",level:2},{value:"1. Creating a Power User\u200b",id:"1-creating-a-power-userdirect-link-to-heading",level:3},{value:"1. Create a user, specifying the password. By default this user will have no permissions.",id:"1-create-a-user-specifying-the-password-by-default-this-user-will-have-no-permissions",level:5},{value:"2. Grant the user the following permissions to the trips table. Selectively exclude commands to limit specific permissions for the user.",id:"2-grant-the-user-the-following-permissions-to-the-trips-table-selectively-exclude-commands-to-limit-specific-permissions-for-the-user",level:5},{value:"Replicating the clickhouse user",id:"replicating-the-clickhouse-user",level:5},{value:"2. Restrict Table Permissions\u200b",id:"2-restrict-table-permissionsdirect-link-to-heading",level:3},{value:"1. Creating a read-only user is as simple as a executing a subset of the above commands. The following user has <code>SELECT</code> access only on the <code>trips</code> table.",id:"1-creating-a-read-only-user-is-as-simple-as-a-executing-a-subset-of-the-above-commands-the-following-user-has-select-access-only-on-the-trips-table",level:5},{value:"2. Confirm the user can perform SELECTs on the trips table. The following query can either be executed via the Play UI and modifying the user credentials; or via the <code>clickhouse-client</code>:",id:"2-confirm-the-user-can-perform-selects-on-the-trips-table-the-following-query-can-either-be-executed-via-the-play-ui-and-modifying-the-user-credentials-or-via-the-clickhouse-client",level:5},{value:"3. Restrict Column Permissions\u200b",id:"3-restrict-column-permissionsdirect-link-to-heading",level:3},{value:"1. Create both a user and role.",id:"1-create-both-a-user-and-role",level:5},{value:"2. Grant permissions to column_users role to see only the columns trip_id, passenger_count and total_amount columns.",id:"2-grant-permissions-to-column_users-role-to-see-only-the-columns-trip_id-passenger_count-and-total_amount-columns",level:5},{value:"3. Add the column_restricted_user to the column_users role.",id:"3-add-the-column_restricted_user-to-the-column_users-role",level:5},{value:"4. Confirm the user can execute queries on the columns to which they have access:",id:"4-confirm-the-user-can-execute-queries-on-the-columns-to-which-they-have-access",level:5},{value:"5. Confirm the following query is not permitted.",id:"5-confirm-the-following-query-is-not-permitted",level:5},{value:"4. Restrict Row permissions\u200b",id:"4-restrict-row-permissionsdirect-link-to-heading",level:3},{value:"1. Create a both a user and role:",id:"1-create-a-both-a-user-and-role",level:5},{value:"2. Create a policy <code>row_filter</code> to allow only those rows with a <code>passenger_count = 1</code>, assigning this to the row created above:",id:"2-create-a-policy-row_filter-to-allow-only-those-rows-with-a-passenger_count--1-assigning-this-to-the-row-created-above",level:5},{value:"3. Create a row policy to permit all users, except those belonging to the <code>row_users</code> group, the ability to see rows in the trips table:",id:"3-create-a-row-policy-to-permit-all-users-except-those-belonging-to-the-row_users-group-the-ability-to-see-rows-in-the-trips-table",level:5},{value:"4. Confirm for the first query a count greater than 0. The second query should result in no hits:",id:"4-confirm-for-the-first-query-a-count-greater-than-0-the-second-query-should-result-in-no-hits",level:5},{value:"5. Modifying Users and Roles\u200b",id:"5-modifying-users-and-rolesdirect-link-to-heading",level:3},{value:"1. To remove a privilege from a role:",id:"1-to-remove-a-privilege-from-a-role",level:5},{value:"2. To delete a policy:",id:"2-to-delete-a-policy",level:5},{value:"3. To unassign a user from a role:",id:"3-to-unassign-a-user-from-a-role",level:5},{value:"4. To delete a role:",id:"4-to-delete-a-role",level:5},{value:"5. To delete a user:",id:"5-to-delete-a-user",level:5},{value:"6. Troubleshooting RBAC\u200b",id:"6-troubleshooting-rbacdirect-link-to-heading",level:4},{value:"1. To show all users:",id:"1-to-show-all-users",level:5},{value:"2. Listing the grants and roles for a user:",id:"2-listing-the-grants-and-roles-for-a-user",level:5},{value:"3. List roles in ClickHouse:",id:"3-list-roles-in-clickhouse",level:5},{value:"4. Display the policies:",id:"4-display-the-policies",level:5},{value:"5. View how a policy was defined and current privileges:",id:"5-view-how-a-policy-was-defined-and-current-privileges",level:5}],p={toc:d};function h(e){var t=e.components,s=(0,n.Z)(e,r);return(0,o.kt)("wrapper",(0,i.Z)({},p,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"getting-started-with-clickhouse-cloud"},"Getting Started with ClickHouse Cloud"),(0,o.kt)("p",null,"With ClickHouse Cloud, we are building a turnkey hosted ClickHouse experience! This guide will help you get started with creating a new ClickHouse Service, creating a table and inserting data. We have included some important details and helpful tips that you need to be aware of as you start using the ClickHouse Cloud."),(0,o.kt)("iframe",{width:"100%",src:"https://player.vimeo.com/video/704181801?h=5cd587cba1&badge=0&autopause=0&player_id=0&app_id=58479",frameborder:"0",allow:"autoplay; fullscreen; picture-in-picture",allowfullscreen:!0,title:"ClickHouse Onboarding"}),(0,o.kt)("script",{src:"https://player.vimeo.com/api/player.js"}),(0,o.kt)("h2",{id:"important-detailsdirect-link-to-heading"},"Important Details",(0,o.kt)("a",{parentName:"h2",href:"#important-details",title:"Direct link to heading"},"\u200b")),(0,o.kt)("h4",{id:"1-invite-your-team-membersdirect-link-to-heading"},"1","."," Invite your team members",(0,o.kt)("a",{parentName:"h4",href:"#1-wait-for-the-new-service-to-be-running",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"While you are waiting for your new ClickHouse service to start, you can click on ",(0,o.kt)("strong",{parentName:"p"},"Members")," in the left navigation menu and invite others using the ",(0,o.kt)("strong",{parentName:"p"},"Invite Members")," button. ",(0,o.kt)("strong",{parentName:"p"},"Admin")," users can access your services and create new ones; users with ",(0,o.kt)("strong",{parentName:"p"},"Developer")," privileges can access existing services only."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"invite users",src:a(63389).Z,width:"930",height:"728"})),(0,o.kt)("h4",{id:"2-we-only-show-you-the-password-oncedirect-link-to-heading"},"2","."," We only show you the password once\u2026",(0,o.kt)("a",{parentName:"h4",href:"#2-we-only-show-you-the-password-once",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"\u2026so hang on to it! Once your service is provisioned, the password will appear in the dialog window. After you refresh the page in your browser, the password will no longer appear and you will have to reset it if you have not saved it:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"save password",src:a(46320).Z,width:"1706",height:"614"})),(0,o.kt)("h4",{id:"3-the-play-ui-is-available-for-connecting-to-your-servicedirect-link-to-heading"},"3","."," The Play UI is available for connecting to your service",(0,o.kt)("a",{parentName:"h4",href:"#3-the-play-ui-is-available-for-connecting-to-your-service",title:"Direct link to heading"},"\u200b")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"First, copy your password,"),(0,o.kt)("li",{parentName:"ul"},'then click on the "Connect to SQL console" button and the UI will open in a pop-up window,'),(0,o.kt)("li",{parentName:"ul"},'paste your password into the "password" text field:')),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"play ui",src:a(76376).Z,width:"898",height:"337"})),(0,o.kt)("h4",{id:"4-you-can-also-connect-using-http-or-the-native-protocoldirect-link-to-heading"},"4","."," You can also connect using HTTP or the native protocol",(0,o.kt)("a",{parentName:"h4",href:"#4-you-can-also-connect-using-http-or-the-native-protocol",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"The two commands you can use are provided for you - just copy-and-paste them from the Cloud console:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"getting commands",src:a(11076).Z,width:"1708",height:"1348"})),(0,o.kt)("p",null,"The curl command for the HTTP interface looks like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"curl --user 'default:[password]' --data-binary 'SELECT 1' https://mtjl6ecaan.us-west-2.aws.clickhouse.cloud:8443\n")),(0,o.kt)("p",null,"And the ",(0,o.kt)("inlineCode",{parentName:"p"},"clickhouse-client")," command for the native interface looks like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"clickhouse-client --host mtjl6ecaan.us-west-2.aws.clickhouse.cloud --secure --user default --port 9440 --password [password]\n")),(0,o.kt)("h4",{id:"5-the-default-databasedirect-link-to-heading"},"5","."," The default Database",(0,o.kt)("a",{parentName:"h4",href:"#5-the-default-database",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"Your ClickHouse Cloud service consists of the ",(0,o.kt)("inlineCode",{parentName:"p"},"default")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"system")," databases. All tables and views are created in the ",(0,o.kt)("inlineCode",{parentName:"p"},"default")," database, and any attempts to create a new database will generate an error. (If you need a new database, simply create a new service.)"),(0,o.kt)("h4",{id:"6-supported-table-enginesdirect-link-to-heading"},"6","."," Supported table engines",(0,o.kt)("a",{parentName:"h4",href:"#6-supported-table-engines",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"Here is a list of the supported table engines. (These table engines support replication, which is a requirement in a cluster environment):"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"ReplicatedMergeTree")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"ReplicatedSummingMergeTree")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"ReplicatedAggregatingMergeTree")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"ReplicatedReplacingMergeTree")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"S3")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"URL")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"View")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"MaterializedView")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"GenerateRandom")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Join")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Null"))),(0,o.kt)("h4",{id:"7-insert-datadirect-link-to-heading"},"7","."," Insert Data",(0,o.kt)("a",{parentName:"h4",href:"#7-insert-data",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"Data can either be inserted using the ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"native interface"))," (e.g. the clickhouse-client) or ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"HTTP interface"))," (e.g. curl or a custom client application). See the Common Tasks section below for an example of both techniques."),(0,o.kt)("h4",{id:"8-available-aws-regionsdirect-link-to-heading"},"8","."," Available AWS Regions",(0,o.kt)("a",{parentName:"h4",href:"#8-available-aws-regions",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"Each ClickHouse service runs in a single region across 3 availability zones for high availability. ClickHouse Cloud is currently available in the following AWS regions:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Ohio (us-east-2)"),(0,o.kt)("li",{parentName:"ul"},"Oregon (us-west-2)"),(0,o.kt)("li",{parentName:"ul"},"Ireland (eu-west-1)")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"known-limitationsdirect-link-to-heading"},"Known Limitations",(0,o.kt)("a",{parentName:"h2",href:"#known-limitations",title:"Direct link to heading"},"\u200b")),(0,o.kt)("h4",{id:"0-create-database-is-not-availabledirect-link-to-heading"},"0","."," CREATE DATABASE is not available",(0,o.kt)("a",{parentName:"h4",href:"#0-create-databased",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"A ClickHouse Cloud service includes a single database named ",(0,o.kt)("inlineCode",{parentName:"p"},"default"),". At the current time, ",(0,o.kt)("inlineCode",{parentName:"p"},"CREATE DATABASE")," is not permitted. We are working on implementing this capability."),(0,o.kt)("h4",{id:"1-access-to-external-systems-is-limiteddirect-link-to-heading"},"1","."," Access to external systems is limited",(0,o.kt)("a",{parentName:"h4",href:"#1-access-to-external-systems-is-limited",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"AWS S3 is supported in ClickHouse Cloud, so you can use the S3 functions and table engine. External functions and engines like ODBC, JDBC, PostgreSQL, MySQL, SQLite, MongoDB, Redis, Kafka, RabbitMQ, HDFS and Hive will work as long as ClickHouse has external access to them from over the Internet."),(0,o.kt)("h4",{id:"2-unavailable-functions-and-settingsdirect-link-to-heading"},"2","."," Unavailable functions and settings",(0,o.kt)("a",{parentName:"h4",href:"#2-unavailable-functions-and-settings",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"Some functionality is disabled for security purposes, including:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Reading from sources local to clickhouse server, e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"File")," table engine"),(0,o.kt)("li",{parentName:"ul"},"SQL functions relying on local filesystem access, e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"file")),(0,o.kt)("li",{parentName:"ul"},"User-defined functions that rely on executables and external scripts"),(0,o.kt)("li",{parentName:"ul"},"SQL functions for introspection are restricted for security reasons, e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"addressToLine"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"tcpPort")),(0,o.kt)("li",{parentName:"ul"},"Most system settings are not configurable at this time and/or do not have any effect")),(0,o.kt)("h4",{id:"3-backups-are-not-available-yetdirect-link-to-heading"},"3","."," Backups are not available yet",(0,o.kt)("a",{parentName:"h4",href:"#3-backups-are-not-available-yet",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"The backups functionality is undergoing additional testing and not enabled at this time"),(0,o.kt)("h4",{id:"4-security-limitationsdirect-link-to-heading"},"4","."," Security limitations",(0,o.kt)("a",{parentName:"h4",href:"#4-security-limitations",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"As part of creating the ClickHouse service, we create a ",(0,o.kt)("inlineCode",{parentName:"p"},"default")," database, and a user named ",(0,o.kt)("inlineCode",{parentName:"p"},"default")," that has broad permissions to this database. This initial user can create additional users and assign their permissions to this database. Beyond this, the ability to enable the following security features within the database using Kerberos, LDAP, or SSL X.509 certificate authentication are not supported at this time."),(0,o.kt)("h4",{id:"5-observabilitydirect-link-to-heading"},"5","."," Observability",(0,o.kt)("a",{parentName:"h4",href:"#5-observability",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"Each ClickHouse service is collecting metrics, and you can view those metrics by clicking on the three dots next to your service's name and selecting ",(0,o.kt)("strong",{parentName:"p"},"Details")," from the menu."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"We have provided some basic metrics out of the box, but we would love to hear from you if you have ideas and suggetions for metrics to collect. Click the ",(0,o.kt)("strong",{parentName:"li"},"New metric")," button (below all of the metrics) to share your ideas with us."),(0,o.kt)("li",{parentName:"ul"},"The ability to query ",(0,o.kt)("strong",{parentName:"li"},"system")," tables is available, but note that not all metrics exposed in this way are relevant, and we may remove or restrict access to these details in the future."),(0,o.kt)("li",{parentName:"ul"},"Direct access to ClickHouse server logs is not provided."),(0,o.kt)("li",{parentName:"ul"},"Audit log of Cloud actions is available on the backend, but not yet exposed in the Cloud console.")),(0,o.kt)("h4",{id:"6-create-as-select-queriesdirect-link-to-heading"},"6","."," CREATE AS SELECT queries",(0,o.kt)("a",{parentName:"h4",href:"#6-select-as-create",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"CREATE AS SELECT")," queries are not supported now. Use ",(0,o.kt)("inlineCode",{parentName:"p"},"CREATE VIEW AS + CREATE TABLE AS view + INSERT SELECT"),". Also, ",(0,o.kt)("inlineCode",{parentName:"p"},"CREATE DATABASE IF NOT EXISITS")," should not be used to check database availability for now. Use ",(0,o.kt)("inlineCode",{parentName:"p"},"EXISTS"),">"," instead."),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"common-tasksdirect-link-to-heading"},"Common Tasks",(0,o.kt)("a",{parentName:"h2",href:"#common-tasks",title:"Direct link to heading"},"\u200b")),(0,o.kt)("h3",{id:"1-using-the-clickhouse-clientdirect-link-to-heading"},"1","."," Using the clickhouse-client",(0,o.kt)("a",{parentName:"h3",href:"#1-using-the-clickhouse-client",title:"Direct link to heading"},"\u200b")),(0,o.kt)("h4",{id:"on-linuxdirect-link-to-heading"},"On Linux",(0,o.kt)("a",{parentName:"h4",href:"#on-linux",title:"Direct link to heading"},"\u200b")),(0,o.kt)("h5",{id:"1-download-and-install-the-clickhouse-binary-for-linux"},"1","."," Download and install the ClickHouse binary for Linux:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"curl https://clickhouse.com/ | sh ./clickhouse install\n")),(0,o.kt)("h5",{id:"2-copy-and-paste-the-command-provided-from-the-native-tab-on-the-services-links-pop-up"},"2","."," Copy-and-paste the command provided from the ",(0,o.kt)("strong",{parentName:"h5"},'"Native"')," tab on the Services links pop-up:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"clickhouse-client --host magenta-wg-58.aws.us-west-2.clickhouse.cloud --secure --user default --port 9440 --password [password]\n")),(0,o.kt)("h4",{id:"on-macdirect-link-to-heading"},"On Mac",(0,o.kt)("a",{parentName:"h4",href:"#on-mac",title:"Direct link to heading"},"\u200b")),(0,o.kt)("h5",{id:"1-download-the-clickhouse-binary-for-mac"},"1","."," Download the ",(0,o.kt)("inlineCode",{parentName:"h5"},"clickhouse")," binary for Mac"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"curl https://clickhouse.com/ | sh\n")),(0,o.kt)("h5",{id:"2-start-the-clickhouse-client-you-can-copy-and-paste-this-from-the-services-links-pop-up-but-notice-the-binary-you-are-running-is-slightly-different-change-clickhouse-client-to-clickhouse-client"},"2","."," Start the ",(0,o.kt)("inlineCode",{parentName:"h5"},"clickhouse client"),". You can copy and paste this from the Services links pop-up, but notice the binary you are running is slightly different (change ",(0,o.kt)("inlineCode",{parentName:"h5"},"clickhouse-client")," to ",(0,o.kt)("inlineCode",{parentName:"h5"},"./clickhouse client"),"):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./clickhouse client --host magenta-wg-58.aws.us-west-2.clickhouse.cloud --secure --user default --password [password]\n")),(0,o.kt)("h4",{id:"on-windowsdirect-link-to-heading"},"On Windows",(0,o.kt)("a",{parentName:"h4",href:"#on-windows",title:"Direct link to heading"},"\u200b")),(0,o.kt)("h5",{id:"1-the-clickhouse-client-can-run-inside-wsl-windows-subsystem-for-linux-so-start-by-following-the-install-instructions-for-wsl-if-you-do-not-have-it-installed-already-from-the-wsl-prompt-run-the-command-provided-from-the-native-tab-on-the-services-links-pop-up-the-same-command-as-linux-above"},"1","."," The ",(0,o.kt)("inlineCode",{parentName:"h5"},"clickhouse-client")," can run inside WSL (Windows Subsystem for Linux), so start by ",(0,o.kt)("a",{parentName:"h5",href:"https://docs.microsoft.com/en-us/windows/wsl/install"},"following the install instructions for WSL"),' if you do not have it installed already. From the WSL prompt, run the command provided from the "Native" tab on the Services links pop-up (the same command as Linux above):'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"clickhouse-client --host magenta-wg-58.aws.us-west-2.clickhouse.cloud --secure --user default --port 9440 --password [password]\n")),(0,o.kt)("h4",{id:"using-dockerdirect-link-to-heading"},"Using Docker",(0,o.kt)("a",{parentName:"h4",href:"#using-docker",title:"Direct link to heading"},"\u200b")),(0,o.kt)("h5",{id:"1-use-the-clickhouseclickhouse-server-image-in-docker-hub-to-run-the-clickhouse-client-in-a-docker-container"},"1","."," Use the ",(0,o.kt)("inlineCode",{parentName:"h5"},"clickhouse/clickhouse-server")," image in Docker Hub to run the ",(0,o.kt)("inlineCode",{parentName:"h5"},"clickhouse-client")," in a Docker container:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker run -it clickhouse/clickhouse-server clickhouse-client --host magenta-wg-58.aws.us-west-2.clickhouse.cloud  --secure --user default --port 9440 --password [password]\n")),(0,o.kt)("h3",{id:"2-insert-data-from-a-local-filedirect-link-to-heading"},"2","."," Insert Data from a Local File",(0,o.kt)("a",{parentName:"h3",href:"#2-insert-data-from-a-local-file",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"The following steps demonstrate how to insert a local text file into a table using ",(0,o.kt)("inlineCode",{parentName:"p"},"clickhouse-client"),"."),(0,o.kt)("h5",{id:"1-first-create-the-table-either-from-the-clickhouse-client-prompt-or-using-the-play-ui-the-dataset-represents-new-york-city-taxi-rides"},"1","."," First create the table, either from the ",(0,o.kt)("inlineCode",{parentName:"h5"},"clickhouse-client")," prompt or using the Play UI. The dataset represents New York City taxi rides:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE trips (\n    `trip_id` UInt32,\n    `vendor_id` Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, 'CMT' = 5, 'VTS' = 6, 'DDS' = 7, 'B02512' = 10, 'B02598' = 11, 'B02617' = 12, 'B02682' = 13, 'B02764' = 14, '' = 15),\n    `pickup_date` Date,\n    `pickup_datetime` DateTime,\n    `dropoff_date` Date,\n    `dropoff_datetime` DateTime,\n    `store_and_fwd_flag` UInt8,\n    `rate_code_id` UInt8,\n    `pickup_longitude` Float64,\n    `pickup_latitude` Float64,\n    `dropoff_longitude` Float64,\n    `dropoff_latitude` Float64,\n    `passenger_count` UInt8,\n    `trip_distance` Float64,\n    `fare_amount` Float32,\n    `extra` Float32,\n    `mta_tax` Float32,\n    `tip_amount` Float32,\n    `tolls_amount` Float32,\n    `ehail_fee` Float32,\n    `improvement_surcharge` Float32,\n    `total_amount` Float32,\n    `payment_type` Enum8('UNK' = 0, 'CSH' = 1, 'CRE' = 2, 'NOC' = 3, 'DIS' = 4),\n    `trip_type` UInt8,\n    `pickup` FixedString(25),\n    `dropoff` FixedString(25),\n    `cab_type` Enum8('yellow' = 1, 'green' = 2, 'uber' = 3),\n    `pickup_nyct2010_gid` Int8,\n    `pickup_ctlabel` Float32,\n    `pickup_borocode` Int8,\n    `pickup_ct2010` String,\n    `pickup_boroct2010` String,\n    `pickup_cdeligibil` String,\n    `pickup_ntacode` FixedString(4),\n    `pickup_ntaname` String,\n    `pickup_puma` UInt16,\n    `dropoff_nyct2010_gid` UInt8,\n    `dropoff_ctlabel` Float32,\n    `dropoff_borocode` UInt8,\n    `dropoff_ct2010` String,\n    `dropoff_boroct2010` String,\n    `dropoff_cdeligibil` String,\n    `dropoff_ntacode` FixedString(4),\n    `dropoff_ntaname` String,\n    `dropoff_puma` UInt16 )\nENGINE = ReplicatedMergeTree\nPARTITION BY toYYYYMM(pickup_date)\nORDER BY pickup_datetime;\n")),(0,o.kt)("h5",{id:"2-if-you-are-at-the-clickhouse-client-prompt-exit-it"},"2","."," If you are at the ",(0,o.kt)("inlineCode",{parentName:"h5"},"clickhouse-client")," prompt, exit it:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"clickhouse-cloud :) exit\n")),(0,o.kt)("h5",{id:"3-download-the-file-which-consists-of-about-1m-rows-of-taxi-rides"},"3","."," Download the file, which consists of about 1M rows of taxi rides:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"curl -O https://datasets-documentation.s3.eu-west-3.amazonaws.com/nyc-taxi/trips_2.gz\n")),(0,o.kt)("h5",{id:"4-run-the-following-command-to-unzip-the-file-stream-it-to-the-clickhouse-client-and-insert-it-into-the-trips-table-be-sure-to-modify-the-clickhouse-client-portion-of-the-command-to-match-your-os-see-the-linux-mac-windows-and-docker-options-above"},"4","."," Run the following command to unzip the file, stream it to the ",(0,o.kt)("inlineCode",{parentName:"h5"},"clickhouse-client")," and insert it into the trips table. Be sure to modify the ",(0,o.kt)("inlineCode",{parentName:"h5"},"clickhouse-client")," portion of the command to match your OS (see the Linux, Mac, Windows and Docker options above):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'gzip -d -c trips_2.gz | ./clickhouse-client --host magenta-wg-58.aws.us-west-2.clickhouse.cloud --secure --user default --password [password] --database=default --query="INSERT INTO trips FORMAT TabSeparatedWithNames"\n')),(0,o.kt)("h5",{id:"5-when-the-insertion-is-complete-run-the-following-query-from-either-the-clickhouse-client-or-the-play-ui-to-verify-you-have-about-a-1m-rows-in-trips-999825-to-be-precise"},"5","."," When the insertion is complete, run the following query from either the ",(0,o.kt)("inlineCode",{parentName:"h5"},"clickhouse-client")," or the Play UI to verify you have about a 1M rows in trips (999,825 to be precise):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT count() FROM TRIPS\n")),(0,o.kt)("h5",{id:"6-run-a-query-to-see-how-fast-1m-rows-can-be-processed-by-clickhouse"},"6","."," Run a query to see how fast 1M rows can be processed by ClickHouse:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT passenger_count, avg(total_amount) FROM trips GROUP BY passenger_count;\n")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"More details on the ",(0,o.kt)("inlineCode",{parentName:"p"},"clickhouse-client")," can be ",(0,o.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/interfaces/cli"},"found in the docs"),"."))),(0,o.kt)("h3",{id:"3-insert-data-using-the-http-interfacedirect-link-to-heading"},"3","."," Insert Data using the HTTP Interface",(0,o.kt)("a",{parentName:"h3",href:"#3-insert-data-using-the-http-interface",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"This example uses the same NYC taxi dataset as the previous example, except the data is inserted using the HTTP interface:"),(0,o.kt)("h5",{id:"1-download-the-file-first"},"1","."," Download the file first:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"curl -O https://datasets-documentation.s3.eu-west-3.amazonaws.com/nyc-taxi/trips_2.gz\n")),(0,o.kt)("h5",{id:"2-create-the-trips-table-defined-in-the-previous-section"},"2","."," Create the ",(0,o.kt)("inlineCode",{parentName:"h5"},"trips")," table defined in the previous section."),(0,o.kt)("h5",{id:"3-unzip-the-gz-file-and-pipe-the-output-to-curl"},"3","."," Unzip the ",(0,o.kt)("inlineCode",{parentName:"h5"},".gz")," file and pipe the output to curl:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gzip -d -c trips_2.gz | curl -u default:[password] 'https://host:8443/?query=INSERT%20INTO%20trips%20FORMAT%20TabSeparatedWithNames' --data-binary @-\n")),(0,o.kt)("h5",{id:"note"},"NOTE"),(0,o.kt)("p",null,"The query in the URL is ",(0,o.kt)("inlineCode",{parentName:"p"},"INSERT%20INTO%20trips%20FORMAT%20TabSeparatedWithNames"),", which is a URL-encoded version of ",(0,o.kt)("inlineCode",{parentName:"p"},"INSERT INTO trips FORMAT TabSeparatedWithNames"),"."),(0,o.kt)("p",null,"Further details on the ",(0,o.kt)("inlineCode",{parentName:"p"},"http")," interface can be found ",(0,o.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/interfaces/http"},"here"),"."),(0,o.kt)("h3",{id:"4-create-a-table-from-files-in-s3direct-link-to-heading"},"4","."," Create a table from files in S3",(0,o.kt)("a",{parentName:"h3",href:"#4-create-a-table-from-files-in-s3",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"In this step, you will see how to populate a table with data from files stored in S3. The example uses the New York Taxi dataset, which is publicly available on S3."),(0,o.kt)("h5",{id:"1-start-by-creating-the-table-notice-the-table-engine-is-replicatedmergetree-which-means-it-will-automatically-be-replicated-across-the-nodes-in-your-cluster"},"1","."," Start by creating the table. Notice the table engine is ",(0,o.kt)("inlineCode",{parentName:"h5"},"ReplicatedMergeTree"),", which means it will automatically be replicated across the nodes in your cluster."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE trips(\n    `trip_id` UInt32,\n    `vendor_id` Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, 'CMT' = 5, 'VTS' = 6, 'DDS' = 7, 'B02512' = 10, 'B02598' = 11, 'B02617' = 12, 'B02682' = 13, 'B02764' = 14, '' = 15),\n    `pickup_date` Date,\n    `pickup_datetime` DateTime,\n    `dropoff_date` Date,\n    `dropoff_datetime` DateTime,\n    `store_and_fwd_flag` UInt8,\n    `rate_code_id` UInt8,\n     `pickup_longitude` Float64,\n     `pickup_latitude` Float64,\n     `dropoff_longitude` Float64,\n     `dropoff_latitude` Float64,\n     `passenger_count` UInt8,\n     `trip_distance` Float64,\n     `fare_amount` Float32,\n     `extra` Float32,\n     `mta_tax` Float32,\n     `tip_amount` Float32,\n     `tolls_amount` Float32,\n      `ehail_fee` Float32,\n      `improvement_surcharge` Float32,\n      `total_amount` Float32,\n      `payment_type` Enum8('UNK' = 0, 'CSH' = 1, 'CRE' = 2, 'NOC' = 3, 'DIS' = 4),\n      `trip_type` UInt8,\n      `pickup` FixedString(25),\n      `dropoff` FixedString(25),\n      `cab_type` Enum8('yellow' = 1, 'green' = 2, 'uber' = 3),\n      `pickup_nyct2010_gid` Int8,\n      `pickup_ctlabel` Float32,\n      `pickup_borocode` Int8,\n      `pickup_ct2010` String,\n      `pickup_boroct2010` String,\n      `pickup_cdeligibil` String,\n      `pickup_ntacode` FixedString(4),\n      `pickup_ntaname` String,\n      `pickup_puma` UInt16,\n      `dropoff_nyct2010_gid` UInt8,\n      `dropoff_ctlabel` Float32,\n      `dropoff_borocode` UInt8,\n      `dropoff_ct2010` String,\n      `dropoff_boroct2010` String,\n      `dropoff_cdeligibil` String,\n      `dropoff_ntacode` FixedString(4),\n      `dropoff_ntaname` String,\n      `dropoff_puma` UInt16\n    )\nENGINE = ReplicatedMergeTree\nPARTITION BY toYYYYMM(pickup_date)\nORDER BY pickup_datetime;\n")),(0,o.kt)("h5",{id:"2-utilizing-the-s3-function-insert-approximately-1m-rows-into-the-table-this-will-take-around-10s-to-execute"},"2","."," Utilizing the ",(0,o.kt)("inlineCode",{parentName:"h5"},"s3")," function, insert approximately 1M rows into the table. This will take around 10s to execute:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"INSERT INTO trips SELECT * FROM s3('https://datasets-documentation.s3.eu-west-3.amazonaws.com/nyc-taxi/trips_0.gz', 'TabSeparatedWithNames');\n")),(0,o.kt)("h5",{id:"3-confirm-the-data-is-available-with-a-simple-query-to-count-the-average-fare-per-passenger-count"},"3","."," Confirm the data is available with a simple query to count the average fare per passenger count:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT passenger_count, avg(total_amount) FROM trips GROUP BY passenger_count;\n")),(0,o.kt)("p",null,"The response should look like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-response"},"+---------------+------------------+\n|passenger_count|avg(total_amount) |\n+---------------+------------------+\n|0              |29.16213358481725 |\n|1              |15.949619633974189|\n|2              |17.156779017363604|\n|3              |19.446272162315193|\n|4              |17.101371068907223|\n|5              |16.366309569286106|\n|6              |15.92480646257438 |\n|7              |75.80000305175781 |\n|8              |10.700000166893005|\n|9              |11.800000190734863|\n+---------------+------------------+\n")),(0,o.kt)("h3",{id:"5-use-s3-for-table-storagedirect-link-to-heading"},"5","."," Use S3 for table storage",(0,o.kt)("a",{parentName:"h3",href:"#5-use-s3-for-table-storage",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"In the following example we create a table that uses an S3 bucket for its table storage. The table references 9 files of the NYC taxi dataset - so 9m rows in total."),(0,o.kt)("h5",{id:"1-start-by-creating-the-table-that-uses-the-s3-table-engine"},"1","."," Start by creating the table that uses the ",(0,o.kt)("inlineCode",{parentName:"h5"},"S3")," table engine:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE trips_raw(\n    `trip_id` UInt32,\n    `vendor_id` Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, 'CMT' = 5, 'VTS' = 6, 'DDS' = 7, 'B02512' = 10, 'B02598' = 11, 'B02617' = 12, 'B02682' = 13, 'B02764' = 14, '' = 15),\n    `pickup_date` Date,\n    `pickup_datetime` DateTime,\n    `dropoff_date` Date,\n    `dropoff_datetime` DateTime,\n    `store_and_fwd_flag` UInt8,\n    `rate_code_id` UInt8,\n    `pickup_longitude` Float64,\n    `pickup_latitude` Float64,\n    `dropoff_longitude` Float64,\n    `dropoff_latitude` Float64,\n    `passenger_count` UInt8,\n    `trip_distance` Float64,\n    `fare_amount` Float32,\n    `extra` Float32,\n    `mta_tax` Float32,\n    `tip_amount` Float32,\n    `tolls_amount` Float32,\n    `ehail_fee` Float32,\n    `improvement_surcharge` Float32,\n    `total_amount` Float32,\n    `payment_type` Enum8('UNK' = 0, 'CSH' = 1, 'CRE' = 2, 'NOC' = 3, 'DIS' = 4),\n    `trip_type` UInt8,\n    `pickup` FixedString(25),\n    `dropoff` FixedString(25),\n    `cab_type` Enum8('yellow' = 1, 'green' = 2, 'uber' = 3),\n    `pickup_nyct2010_gid` Int8,\n    `pickup_ctlabel` Float32,\n    `pickup_borocode` Int8,\n    `pickup_ct2010` String,\n    `pickup_boroct2010` String,\n    `pickup_cdeligibil` String,\n    `pickup_ntacode` FixedString(4),\n    `pickup_ntaname` String,\n    `pickup_puma` UInt16,\n    `dropoff_nyct2010_gid` UInt8,\n    `dropoff_ctlabel` Float32,\n    `dropoff_borocode` UInt8,\n    `dropoff_ct2010` String,\n    `dropoff_boroct2010` String,\n    `dropoff_cdeligibil` String,\n    `dropoff_ntacode` FixedString(4),\n    `dropoff_ntaname` String,\n    `dropoff_puma` UInt16\n)\nENGINE = S3('https://datasets-documentation.s3.eu-west-3.amazonaws.com/nyc-taxi/trips_{1..9}.gz', 'TabSeparatedWithNames', 'gzip');\n")),(0,o.kt)("h5",{id:"2-run-the-following-query-to-compute-the-average-fare-by-passenger-count-this-should-take-around-15s-to-execute-on-most-getting-started-clusters-view-the-s3-table-function-page-in-the-docs-for-further-details-on-the-s3-function-and-table-engine"},"2","."," Run the following query to compute the average fare by passenger count. This should take around 15s to execute on most getting started clusters. View the ",(0,o.kt)("a",{parentName:"h5",href:"https://clickhouse.com/docs/en/integrations/s3/s3-table-functions/"},"S3 table function page")," in the docs for further details on the S3 function and table engine."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT passenger_count, avg(total_amount) FROM trips_raw GROUP BY passenger_count;\n")),(0,o.kt)("p",null,"The response should look like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-response"},"+---------------+------------------+\n|passenger_count|avg(total_amount) |\n+---------------+------------------+\n|0              |26.504418398169953|\n|1              |16.0056070582809  |\n|2              |17.115858410446098|\n|3              |17.06865096517502 |\n|4              |17.236546043445877|\n|5              |16.363680363493543|\n|6              |16.01205029060048 |\n|7              |64.60190670014848 |\n|8              |42.02687507122755 |\n|9              |95.6616637772984  |\n+---------------+------------------+\n")),(0,o.kt)("h3",{id:"6-connect-a-uidirect-link-to-heading"},"6. Connect a UI",(0,o.kt)("a",{parentName:"h3",href:"#6-connect-a-ui",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"The ClickHouse docs has a section on ",(0,o.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/connect-a-ui"},"connecting a UI to ClickHouse"),"."),(0,o.kt)("p",null,"For example, if you want to connect Grafana to ClickHouse, you should be able to ",(0,o.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/connect-a-ui/grafana-and-clickhouse"},"follow the steps in the documentation"),". The Grafana settings for connecting to a ClickHouse Cloud service will look like the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Name: a Grafana setting - give your data source any name you like"),(0,o.kt)("li",{parentName:"ul"},"Server address: the URL of your ClickHouse Cloud service. This should not include the protocol prefixServer port: 9440"),(0,o.kt)("li",{parentName:"ul"},"Username: default"),(0,o.kt)("li",{parentName:"ul"},"Password: Password provided when you create the ClickHouse Cloud service"),(0,o.kt)("li",{parentName:"ul"},"Default database: leave empty"),(0,o.kt)("li",{parentName:"ul"},"Secure Connection: Enable")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"users-and-rolesdirect-link-to-heading"},"Users and Roles",(0,o.kt)("a",{parentName:"h2",href:"#users-and-roles",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"In the following examples we create 3 users, each with their own permissions. We assume users have created and inserted data into the trips table using the earlier examples."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"A user power","_","user with permissive permissions on the trips table"),(0,o.kt)("li",{parentName:"ul"},"A user read","_","only with read only permissions on the trips table."),(0,o.kt)("li",{parentName:"ul"},"A user column","_","restricted","_","user with limited read access to columns in the trips table"),(0,o.kt)("li",{parentName:"ul"},"A user row","_","restricted","_","user with limited read access to rows in the trips table")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"For all examples, ensure the ",(0,o.kt)("inlineCode",{parentName:"p"},"<password>")," is modified. Currently no password policies are enforced, leaving the administrator to ensure these follow sensible rules."))),(0,o.kt)("h3",{id:"1-creating-a-power-userdirect-link-to-heading"},"1","."," Creating a Power User",(0,o.kt)("a",{parentName:"h3",href:"#1-creating-a-power-user",title:"Direct link to heading"},"\u200b")),(0,o.kt)("h5",{id:"1-create-a-user-specifying-the-password-by-default-this-user-will-have-no-permissions"},"1","."," Create a user, specifying the password. By default this user will have no permissions."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE USER power_user IDENTIFIED WITH plaintext_password BY 'password';\n")),(0,o.kt)("h5",{id:"2-grant-the-user-the-following-permissions-to-the-trips-table-selectively-exclude-commands-to-limit-specific-permissions-for-the-user"},"2","."," Grant the user the following permissions to the trips table. Selectively exclude commands to limit specific permissions for the user."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"GRANT SELECT ON default.trips TO power_user WITH GRANT OPTION;\nGRANT SELECT ON default.`trips-distributed` TO power_user WITH GRANT OPTION;\nGRANT INSERT ON default.trips TO power_user WITH GRANT OPTION;\nGRANT INSERT ON default.`trips-distributed` TO power_user WITH GRANT OPTION;\nGRANT ALTER ON default.trips TO power_user WITH GRANT OPTION;\nGRANT ALTER ON default.`trips-distributed` TO power_user WITH GRANT OPTION;\nGRANT TRUNCATE ON default.trips TO power_user WITH GRANT OPTION;\nGRANT TRUNCATE ON default.`trips-distributed` TO power_user WITH GRANT OPTION;\nGRANT OPTIMIZE ON default.trips TO power_user WITH GRANT OPTION;\nGRANT OPTIMIZE ON default.`trips-distributed` TO power_user WITH GRANT OPTION;\n")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"The use of ",(0,o.kt)("inlineCode",{parentName:"p"},"WITH GRANT OPTION")," allows the ",(0,o.kt)("inlineCode",{parentName:"p"},"power_user")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"GRANT")," equivalent or lower permissions to other users. Edit as appropriate. In order for the user to grant permissions, they will also need a grantee rights specified"),(0,o.kt)("pre",{parentName:"div"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER USER power_user GRANTEES ANY;\n")),(0,o.kt)("p",{parentName:"div"},(0,o.kt)("inlineCode",{parentName:"p"},"ANY")," here allows them to grant permissions to users and roles. Other options are documented here."))),(0,o.kt)("h5",{id:"replicating-the-clickhouse-user"},"Replicating the clickhouse user"),(0,o.kt)("p",null,"To replicate permissions of the default clickhouse user, issue the following command and execute the statements provided in the reply - replacing the username clickhouse for your target user."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW GRANTS;\n")),(0,o.kt)("h3",{id:"2-restrict-table-permissionsdirect-link-to-heading"},"2","."," Restrict Table Permissions",(0,o.kt)("a",{parentName:"h3",href:"#2-restrict-table-permissions",title:"Direct link to heading"},"\u200b")),(0,o.kt)("h5",{id:"1-creating-a-read-only-user-is-as-simple-as-a-executing-a-subset-of-the-above-commands-the-following-user-has-select-access-only-on-the-trips-table"},"1","."," Creating a read-only user is as simple as a executing a subset of the above commands. The following user has ",(0,o.kt)("inlineCode",{parentName:"h5"},"SELECT")," access only on the ",(0,o.kt)("inlineCode",{parentName:"h5"},"trips")," table."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE USER read_only IDENTIFIED WITH plaintext_password BY 'password';\nGRANT SELECT ON default.`trips-distributed` TO read_only;\n")),(0,o.kt)("h5",{id:"2-confirm-the-user-can-perform-selects-on-the-trips-table-the-following-query-can-either-be-executed-via-the-play-ui-and-modifying-the-user-credentials-or-via-the-clickhouse-client"},"2","."," Confirm the user can perform SELECTs on the trips table. The following query can either be executed via the Play UI and modifying the user credentials; or via the ",(0,o.kt)("inlineCode",{parentName:"h5"},"clickhouse-client"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'clickhouse-client --host \\<host\\> --secure --port 9440 --user read_only --password \\<password\\> --query  "SELECT count() FROM trips"\n')),(0,o.kt)("h3",{id:"3-restrict-column-permissionsdirect-link-to-heading"},"3","."," Restrict Column Permissions",(0,o.kt)("a",{parentName:"h3",href:"#3-restrict-column-permissions",title:"Direct link to heading"},"\u200b")),(0,o.kt)("h5",{id:"1-create-both-a-user-and-role"},"1","."," Create both a user and role."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE USER column_restricted_user IDENTIFIED WITH plaintext_password BY 'password';CREATE ROLE column_users;\n")),(0,o.kt)("h5",{id:"2-grant-permissions-to-column_users-role-to-see-only-the-columns-trip_id-passenger_count-and-total_amount-columns"},"2","."," Grant permissions to column","_","users role to see only the columns trip","_","id, passenger","_","count and total","_","amount columns."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"GRANT SELECT(trip_id, passenger_count, total_amount) ON default.`trips-distributed` TO column_users;\n")),(0,o.kt)("h5",{id:"3-add-the-column_restricted_user-to-the-column_users-role"},"3","."," Add the column","_","restricted","_","user to the column","_","users role."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"GRANT column_users TO column_restricted_user;\n")),(0,o.kt)("h5",{id:"4-confirm-the-user-can-execute-queries-on-the-columns-to-which-they-have-access"},"4","."," Confirm the user can execute queries on the columns to which they have access:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'clickhouse-client --host \\<host\\> --secure --port 9440 --user column_restricted_user --password \\<password\\> --query  "SELECT trip_id, passenger_count, total_amount FROM trips LIMIT 10;"\n')),(0,o.kt)("h5",{id:"5-confirm-the-following-query-is-not-permitted"},"5","."," Confirm the following query is not permitted."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'clickhouse-client --host \\<host\\> --secure --port 9440 --user column_restricted_user --password \\<password\\> --query  "SELECT trip_id, passenger_count, total_amount, trip_distance FROM trips LIMIT 10;"\n')),(0,o.kt)("h3",{id:"4-restrict-row-permissionsdirect-link-to-heading"},"4","."," Restrict Row permissions",(0,o.kt)("a",{parentName:"h3",href:"#4-restrict-row-permissions",title:"Direct link to heading"},"\u200b")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Row policies make sense only for users with read-only access. If a user can modify a table or copy partitions between tables, it defeats the restrictions of row policies."))),(0,o.kt)("h5",{id:"1-create-a-both-a-user-and-role"},"1","."," Create a both a user and role:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE USER row_restricted_user IDENTIFIED WITH plaintext_password BY 'password';\nCREATE ROLE row_users;\nGRANT SELECT ON default.`trips-distributed` TO row_restricted_user;\nGRANT SELECT ON default.trips TO row_restricted_user;\n")),(0,o.kt)("h5",{id:"2-create-a-policy-row_filter-to-allow-only-those-rows-with-a-passenger_count--1-assigning-this-to-the-row-created-above"},"2","."," Create a policy ",(0,o.kt)("inlineCode",{parentName:"h5"},"row_filter")," to allow only those rows with a ",(0,o.kt)("inlineCode",{parentName:"h5"},"passenger_count = 1"),", assigning this to the row created above:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE ROW POLICY row_filter ON default.trips FOR SELECT USING passenger_count = 1 TO row_users;\n")),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Assigning of the row policy will, at this point, forbid all users from seeing rows in the ",(0,o.kt)("inlineCode",{parentName:"p"},"trips")," table. You must explicitly permit other users to see these rows."))),(0,o.kt)("h5",{id:"3-create-a-row-policy-to-permit-all-users-except-those-belonging-to-the-row_users-group-the-ability-to-see-rows-in-the-trips-table"},"3","."," Create a row policy to permit all users, except those belonging to the ",(0,o.kt)("inlineCode",{parentName:"h5"},"row_users")," group, the ability to see rows in the trips table:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE ROW POLICY allow_other_users_filter ON default.trips FOR SELECT USING 1 TO ALL EXCEPT row_users;\n")),(0,o.kt)("h5",{id:"4-confirm-for-the-first-query-a-count-greater-than-0-the-second-query-should-result-in-no-hits"},"4","."," Confirm for the first query a count greater than 0. The second query should result in no hits:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'clickhouse-client --host \\<host\\> --secure --port 9440 --user row_restricted_user --password \\<password\\> --query  "SELECT count() FROM trips WHERE passenger_count = 1"\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'clickhouse-client --host \\<host\\> --secure --port 9440 --user row_restricted_user --password \\<password\\> --query  "SELECT count() FROM trips WHERE passenger_count > 1"\n')),(0,o.kt)("h3",{id:"5-modifying-users-and-rolesdirect-link-to-heading"},"5","."," Modifying Users and Roles",(0,o.kt)("a",{parentName:"h3",href:"#5-modifying-users-and-roles",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"Here are some examples on how to delete privileges, policies, unassign users from roles, and delete users and roles:"),(0,o.kt)("h5",{id:"1-to-remove-a-privilege-from-a-role"},"1","."," To remove a privilege from a role:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"REVOKE SELECT(trip_id, passenger_count, total_amount) ON default.trips FROM column_users;\n")),(0,o.kt)("h5",{id:"2-to-delete-a-policy"},"2","."," To delete a policy:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"DROP ROW POLICY row_filter ON default.trips;\n")),(0,o.kt)("h5",{id:"3-to-unassign-a-user-from-a-role"},"3","."," To unassign a user from a role:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"REVOKE row_users FROM row_restricted_user;\n")),(0,o.kt)("h5",{id:"4-to-delete-a-role"},"4","."," To delete a role:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"DROP ROLE A_rows_users;\n")),(0,o.kt)("h5",{id:"5-to-delete-a-user"},"5","."," To delete a user:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"DROP USER row_user;\n")),(0,o.kt)("h4",{id:"6-troubleshooting-rbacdirect-link-to-heading"},"6","."," Troubleshooting RBAC",(0,o.kt)("a",{parentName:"h4",href:"#6-troubleshooting-rbac",title:"Direct link to heading"},"\u200b")),(0,o.kt)("p",null,"Here are some helpful commands for troubleshooting users and roles:"),(0,o.kt)("h5",{id:"1-to-show-all-users"},"1","."," To show all users:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW USERS;\n")),(0,o.kt)("h5",{id:"2-listing-the-grants-and-roles-for-a-user"},"2","."," Listing the grants and roles for a user:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW GRANTS FOR power_user;\n")),(0,o.kt)("h5",{id:"3-list-roles-in-clickhouse"},"3","."," List roles in ClickHouse:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW ROLES;\n")),(0,o.kt)("h5",{id:"4-display-the-policies"},"4","."," Display the policies:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW ROW POLICIES\n")),(0,o.kt)("h5",{id:"5-view-how-a-policy-was-defined-and-current-privileges"},"5","."," View how a policy was defined and current privileges:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"SHOW CREATE ROW POLICY row_filter ON default.trips;\n")))}h.isMDXComponent=!0},63389:function(e,t,a){t.Z=a.p+"assets/images/cloud1-057c00612c9486c5ceaa4a2df6a907ed.png"},46320:function(e,t,a){t.Z=a.p+"assets/images/cloud2-a530895548d3da8cd83660d80e3622c4.png"},76376:function(e,t,a){t.Z=a.p+"assets/images/cloud3-758ea402d1436a68087f7de8b63ef788.png"},11076:function(e,t,a){t.Z=a.p+"assets/images/cloud4-4816c3389fb2b0ff957b57b52221eb4b.png"}}]);