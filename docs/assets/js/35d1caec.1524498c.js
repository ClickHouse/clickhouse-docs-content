"use strict";(self.webpackChunknew_nav_docusaurus_2_2=self.webpackChunknew_nav_docusaurus_2_2||[]).push([[84349],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=d(n),h=r,m=u["".concat(l,".").concat(h)]||u[h]||p[h]||o;return n?a.createElement(m,i(i({ref:t},c),{},{components:n})):a.createElement(m,i({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:r,i[1]=s;for(var d=2;d<o;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},3560:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var a=n(87462),r=(n(67294),n(3905));const o={slug:"/en/getting-started/example-datasets/amazon-reviews",sidebar_label:"Amazon customer reviews"},i="Amazon customer reviews dataset",s={unversionedId:"en/getting-started/example-datasets/amazon-reviews",id:"en/getting-started/example-datasets/amazon-reviews",title:"Amazon customer reviews dataset",description:"Amazon Customer Reviews (a.k.a. Product Reviews) is one of Amazon\u2019s iconic products. In a period of over two decades since the first review in 1995, millions of Amazon customers have contributed over a hundred million reviews to express opinions and describe their experiences regarding products on the Amazon.com website. This makes Amazon Customer Reviews a rich source of information for academic researchers in the fields of Natural Language Processing (NLP), Information Retrieval (IR), and Machine Learning (ML), amongst others. By accessing the dataset, you agree to the license terms.",source:"@site/docs/en/getting-started/example-datasets/amazon-reviews.md",sourceDirName:"en/getting-started/example-datasets",slug:"/en/getting-started/example-datasets/amazon-reviews",permalink:"/docs/en/getting-started/example-datasets/amazon-reviews",draft:!1,editUrl:"https://github.com/ClickHouse/ClickHouse/tree/master/docs/en/getting-started/example-datasets/amazon-reviews.md",tags:[],version:"current",frontMatter:{slug:"/en/getting-started/example-datasets/amazon-reviews",sidebar_label:"Amazon customer reviews"},sidebar:"docs",previous:{title:"Geo Data",permalink:"/docs/en/getting-started/example-datasets/cell-towers"},next:{title:"AMPLab Big Data Benchmark",permalink:"/docs/en/getting-started/example-datasets/amplab-benchmark"}},l={},d=[],c={toc:d},u="wrapper";function p(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"amazon-customer-reviews-dataset"},"Amazon customer reviews dataset"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://s3.amazonaws.com/amazon-reviews-pds/readme.html"},(0,r.kt)("strong",{parentName:"a"},"Amazon Customer Reviews"))," (a.k.a. Product Reviews) is one of Amazon\u2019s iconic products. In a period of over two decades since the first review in 1995, millions of Amazon customers have contributed over a hundred million reviews to express opinions and describe their experiences regarding products on the Amazon.com website. This makes Amazon Customer Reviews a rich source of information for academic researchers in the fields of Natural Language Processing (NLP), Information Retrieval (IR), and Machine Learning (ML), amongst others. By accessing the dataset, you agree to the ",(0,r.kt)("a",{parentName:"p",href:"https://s3.amazonaws.com/amazon-reviews-pds/license.txt"},"license terms"),"."),(0,r.kt)("p",null,"The data is in a tab-separated format in gzipped files are up in AWS S3. Let's walk through the steps to insert it into ClickHouse."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The queries below were executed on a ",(0,r.kt)("strong",{parentName:"p"},"Production")," instance of ",(0,r.kt)("a",{parentName:"p",href:"https://clickhouse.cloud"},"ClickHouse Cloud"),".")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Without inserting the data into ClickHouse, we can query it in place. Let's grab some rows so we can see what they look like:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT *\nFROM s3('https://s3.amazonaws.com/amazon-reviews-pds/tsv/amazon_reviews_us_Wireless_v1_00.tsv.gz',\n    'TabSeparatedWithNames',\n    'marketplace String,\n    customer_id Int64,\n    review_id String,\n    product_id String,\n    product_parent Int64,\n    product_title String,\n    product_category String,\n    star_rating Int64,\n    helpful_votes Int64,\n    total_votes Int64,\n    vine Bool,\n    verified_purchase Bool,\n    review_headline String,\n    review_body String,\n    review_date Date'\n)\nLIMIT 10;\n")),(0,r.kt)("p",null,"The rows look like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-response"},"\u250c\u2500marketplace\u2500\u252c\u2500customer_id\u2500\u252c\u2500review_id\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500product_id\u2500\u252c\u2500product_parent\u2500\u252c\u2500product_title\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500product_category\u2500\u252c\u2500star_rating\u2500\u252c\u2500helpful_votes\u2500\u252c\u2500total_votes\u2500\u252c\u2500vine\u2500\u2500\u252c\u2500verified_purchase\u2500\u252c\u2500review_headline\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500review_body\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500review_date\u2500\u2510\n\u2502 US          \u2502    16414143 \u2502 R3W4P9UBGNGH1U \u2502 B00YL0EKWE \u2502      852431543 \u2502 LG G4 Case Hard Transparent Slim Clear Cover for LG G4                                                                                                                                                                                                     \u2502 Wireless         \u2502           2 \u2502             1 \u2502           3 \u2502 false \u2502 true              \u2502 Looks good, functions meh \u2502 2 issues  -  Once I turned on the circle apps and installed this case,  my battery drained twice as fast as usual.  I ended up turning off the circle apps, which kind of makes the case just a case...  with a hole in it.  Second,  the wireless charging doesn't work.  I have a Motorola 360 watch and a Qi charging pad. The watch charges fine but this case doesn't. But hey, it looks nice. \u2502  2015-08-31 \u2502\n\u2502 US          \u2502    50800750 \u2502 R15V54KBMTQWAY \u2502 B00XK95RPQ \u2502      516894650 \u2502 Selfie Stick Fiblastiq&trade; Extendable Wireless Bluetooth Selfie Stick with built-in Bluetooth Adjustable Phone Holder                                                                                                                                   \u2502 Wireless         \u2502           4 \u2502             0 \u2502           0 \u2502 false \u2502 false             \u2502 A fun little gadget       \u2502 I\u2019m embarrassed to admit that until recently, I have had a very negative opinion about \u201cselfie sticks\u201d aka \u201cmonopods\u201d aka \u201cnarcissticks.\u201d But having reviewed a number of them recently, they\u2019re growing on me. This one is pretty nice and simple to set up and with easy instructions illustrated on the back of the box (not sure why some reviewers have stated that there are no instructions when they are clearly printed on the box unless they received different packaging than I did). Once assembled, the pairing via bluetooth and use of the stick are easy and intuitive. Nothing to it.<br /><br />The stick comes with a USB charging cable but arrived with a charge so you can use it immediately, though it\u2019s probably a good idea to charge it right away so that you have no interruption of use out of the box. Make sure the stick is switched to on (it will light up) and extend your stick to the length you desire up to about a yard\u2019s length and snap away.<br /><br />The phone clamp held the phone sturdily so I wasn\u2019t worried about it slipping out. But the longer you extend the stick, the harder it is to maneuver.  But that will happen with any stick and is not specific to this one in particular.<br /><br />Two things that could improve this: 1) add the option to clamp this in portrait orientation instead of having to try and hold the stick at the portrait angle, which makes it feel unstable; 2) add the opening for a tripod so that this can be used to sit upright on a table for skyping and facetime eliminating the need to hold the phone up with your hand, causing fatigue.<br /><br />But other than that, this is a nice quality monopod for a variety of picture taking opportunities.<br /><br />I received a sample in exchange for my honest opinion. \u2502  2015-08-31 \u2502\n\u2502 US          \u2502    15184378 \u2502 RY8I449HNXSVF  \u2502 B00SXRXUKO \u2502      984297154 \u2502 Tribe AB40 Water Resistant Sports Armband with Key Holder for 4.7-Inch iPhone 6S/6/5/5S/5C, Galaxy S4 + Screen Protector - Dark Pink                                                                                                                       \u2502 Wireless         \u2502           5 \u2502             0 \u2502           0 \u2502 false \u2502 true              \u2502 Five Stars                \u2502 Fits iPhone 6 well                                                                                                                                                                                                                                         \u2502  2015-08-31 \u2502\n\u2502 US          \u2502    10203548 \u2502 R18TLJYCKJFLSR \u2502 B009V5X1CE \u2502      279912704 \u2502 RAVPower\xae Element 10400mAh External Battery USB Portable Charger (Dual USB Outputs, Ultra Compact Design), Travel Charger for iPhone 6,iPhone 6 plus,iPhone 5, 5S, 5C, 4S, 4, iPad Air, 4, 3, 2, Mini 2 (Apple adapters not included); Samsung Galaxy S5, S4, S3, S2, Note 3, Note 2; HTC One, EVO, Thunderbolt, Incredible, Droid DNA, Motorola ATRIX, Droid, Moto X, Google Glass, Nexus 4, Nexus 5, Nexus 7, \u2502 Wireless         \u2502           5 \u2502             0 \u2502           0 \u2502 false \u2502 true              \u2502 Great charger             \u2502 Great charger.  I easily get 3+ charges on a Samsung Galaxy 3.  Works perfectly for camping trips or long days on the boat.                                                                                                                                \u2502  2015-08-31 \u2502\n\u2502 US          \u2502      488280 \u2502 R1NK26SWS53B8Q \u2502 B00D93OVF0 \u2502      662791300 \u2502 Fosmon Micro USB Value Pack Bundle for Samsung Galaxy Exhilarate - Includes Home / Travel Charger, Car / Vehicle Charger and USB Cable                                                                                                                     \u2502 Wireless         \u2502           5 \u2502             0 \u2502           0 \u2502 false \u2502 true              \u2502 Five Stars                \u2502 Great for the price :-)                                                                                                                                                                                                                                    \u2502  2015-08-31 \u2502\n\u2502 US          \u2502    13334021 \u2502 R11LOHEDYJALTN \u2502 B00XVGJMDQ \u2502      421688488 \u2502 iPhone 6 Case, Vofolen Impact Resistant Protective Shell iPhone 6S Wallet Cover Shockproof Rubber Bumper Case Anti-scratches Hard Cover Skin Card Slot Holder for iPhone 6 6S                                                                              \u2502 Wireless         \u2502           5 \u2502             0 \u2502           0 \u2502 false \u2502 true              \u2502 Five Stars                \u2502 Great Case, better customer service!                                                                                                                                                                                                                       \u2502  2015-08-31 \u2502\n\u2502 US          \u2502    27520697 \u2502 R3ALQVQB2P9LA7 \u2502 B00KQW1X1C \u2502      554285554 \u2502 Nokia Lumia 630 RM-978 White Factory Unlocked - International Version No Warranty                                                                                                                                                                          \u2502 Wireless         \u2502           4 \u2502             0 \u2502           0 \u2502 false \u2502 true              \u2502 Four Stars                \u2502 Easy to set up and use. Great functions for the price                                                                                                                                                                                                      \u2502  2015-08-31 \u2502\n\u2502 US          \u2502    48086021 \u2502 R3MWLXLNO21PDQ \u2502 B00IP1MQNK \u2502      488006702 \u2502 Lumsing 10400mah external battery                                                                                                                                                                                                                          \u2502 Wireless         \u2502           5 \u2502             0 \u2502           0 \u2502 false \u2502 true              \u2502 Five Stars                \u2502 Works great                                                                                                                                                                                                                                                \u2502  2015-08-31 \u2502\n\u2502 US          \u2502    12738196 \u2502 R2L15IS24CX0LI \u2502 B00HVORET8 \u2502      389677711 \u2502 iPhone 5S Battery Case - iPhone 5 Battery Case , Maxboost Atomic S [MFI Certified] External Protective Battery Charging Case Power Bank Charger All Versions of Apple iPhone 5/5S [Juice Battery Pack]                                                     \u2502 Wireless         \u2502           5 \u2502             0 \u2502           0 \u2502 false \u2502 true              \u2502 So far so good            \u2502 So far so good. It is essentially identical to the one it replaced from another company. That one stopped working after 7 months so I am a bit apprehensive about this one.                                                                                \u2502  2015-08-31 \u2502\n\u2502 US          \u2502    15867807 \u2502 R1DJ8976WPWVZU \u2502 B00HX3G6J6 \u2502      299654876 \u2502 HTC One M8 Screen Protector, Skinomi TechSkin Full Coverage Screen Protector for HTC One M8 Clear HD Anti-Bubble Film \u2502 Wireless         \u2502           3 \u2502             0 \u2502           0 \u2502 false \u2502 true              \u2502 seems durable but these are always harder to get on ... \u2502 seems durable but these are always harder to get on right than people make them out to be. also send to curl up at the edges after a while. with today's smartphones, you hardly need screen protectors anyway. \u2502  2015-08-31 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Normally you would not need to pass in the schema into the ",(0,r.kt)("inlineCode",{parentName:"p"},"s3")," table function - ClickHouse can infer the names and data types of the columns. However, this particular dataset uses a non-standard tab-separated format, but the ",(0,r.kt)("inlineCode",{parentName:"p"},"s3")," function seems to work fine with this non-standard format if you include the schema.")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Let's define a new table named ",(0,r.kt)("inlineCode",{parentName:"li"},"amazon_reviews"),". We'll optimize some of the column data types - and choose a primary key (the ",(0,r.kt)("inlineCode",{parentName:"li"},"ORDER BY")," clause):")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE amazon_reviews\n(\n    review_date Date,\n    marketplace LowCardinality(String),\n    customer_id UInt64,\n    review_id String,\n    product_id String,\n    product_parent UInt64,\n    product_title String,\n    product_category LowCardinality(String),\n    star_rating UInt8,\n    helpful_votes UInt32,\n    total_votes UInt32,\n    vine FixedString(1),\n    verified_purchase FixedString(1),\n    review_headline String,\n    review_body String\n)\nENGINE = MergeTree\nORDER BY (marketplace, review_date, product_category);\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"We are now ready to insert the data into ClickHouse. Before we do, check out the ",(0,r.kt)("a",{parentName:"p",href:"https://s3.amazonaws.com/amazon-reviews-pds/tsv/index.txt"},"list of files in the dataset")," and decide which ones you want to include.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"We will insert all of the US reviews - which is about 151M rows. The following ",(0,r.kt)("inlineCode",{parentName:"p"},"INSERT")," command uses the ",(0,r.kt)("inlineCode",{parentName:"p"},"s3Cluster")," table function, which allows the processing of mulitple S3 files in parallel using all the nodes of your cluster. We also use a wildcard to insert any file that starts with the name ",(0,r.kt)("inlineCode",{parentName:"p"},"https://s3.amazonaws.com/amazon-reviews-pds/tsv/amazon_reviews_us_"),":"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"INSERT INTO amazon_reviews\nSELECT\n   * REPLACE(vine = 'Y' AS vine, verified_purchase = 'Y' AS verified_purchase)\nFROM s3Cluster(\n    'default',\n    'https://s3.amazonaws.com/amazon-reviews-pds/tsv/amazon_reviews_us_*.tsv.gz',\n    'TSVWithNames',\n    'review_date Date,\n    marketplace LowCardinality(String),\n    customer_id UInt64,\n    review_id String,\n    product_id String,\n    product_parent UInt64,\n    product_title String,\n    product_category LowCardinality(String),\n    star_rating UInt8,\n    helpful_votes UInt32,\n    total_votes UInt32,\n    vine FixedString(1),\n    verified_purchase FixedString(1),\n    review_headline String,\n    review_body String'\n    );\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"In ClickHouse Cloud, there is a cluster named ",(0,r.kt)("inlineCode",{parentName:"p"},"default"),". Change ",(0,r.kt)("inlineCode",{parentName:"p"},"default")," to the name of your cluster...or use the ",(0,r.kt)("inlineCode",{parentName:"p"},"s3")," table function (instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"s3Cluster"),") if you do not have a cluster.")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"That query doesn't take long - within 5 minutes or so you should see all the rows inserted:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT formatReadableQuantity(count())\nFROM amazon_reviews\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-response"},"\u250c\u2500formatReadableQuantity(count())\u2500\u2510\n\u2502 150.96 million                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,r.kt)("ol",{start:6},(0,r.kt)("li",{parentName:"ol"},"Let's see how much space our data is using:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    disk_name,\n    formatReadableSize(sum(data_compressed_bytes) AS size) AS compressed,\n    formatReadableSize(sum(data_uncompressed_bytes) AS usize) AS uncompressed,\n    round(usize / size, 2) AS compr_rate,\n    sum(rows) AS rows,\n    count() AS part_count\nFROM system.parts\nWHERE (active = 1) AND (table = 'amazon_reviews')\nGROUP BY disk_name\nORDER BY size DESC;\n")),(0,r.kt)("p",null,"The original data was about 70G, but compressed in ClickHouse it takes up about 30G:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-response"},"\u250c\u2500disk_name\u2500\u252c\u2500compressed\u2500\u252c\u2500uncompressed\u2500\u252c\u2500compr_rate\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500rows\u2500\u252c\u2500part_count\u2500\u2510\n\u2502 s3disk    \u2502 30.00 GiB  \u2502 70.61 GiB    \u2502       2.35 \u2502 150957260 \u2502          9 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,r.kt)("ol",{start:7},(0,r.kt)("li",{parentName:"ol"},"Let's run some queries...here are the top 10 most-helpful reviews on Amazon:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    product_title,\n    review_headline\nFROM amazon_reviews\nORDER BY helpful_votes DESC\nLIMIT 10;\n")),(0,r.kt)("p",null,"Notice the query has to process all 151M rows, and it takes about 17 seconds:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-response"},'\u250c\u2500product_title\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500review_headline\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Kindle: Amazon\'s Original Wireless Reading Device (1st generation)                       \u2502 Why and how the Kindle changes everything                             \u2502\n\u2502 BIC Cristal For Her Ball Pen, 1.0mm, Black, 16ct (MSLP16-Blk)                            \u2502 FINALLY!                                                              \u2502\n\u2502 The Mountain Kids 100% Cotton Three Wolf Moon T-Shirt                                    \u2502 Dual Function Design                                                  \u2502\n\u2502 Kindle Keyboard 3G, Free 3G + Wi-Fi, 6" E Ink Display                                    \u2502 Kindle vs. Nook (updated)                                             \u2502\n\u2502 Kindle Fire HD 7", Dolby Audio, Dual-Band Wi-Fi                                          \u2502 You Get What You Pay For                                              \u2502\n\u2502 Kindle Fire (Previous Generation - 1st)                                                  \u2502 A great device WHEN you consider price and function, with a few flaws \u2502\n\u2502 Fifty Shades of Grey: Book One of the Fifty Shades Trilogy (Fifty Shades of Grey Series) \u2502 Did a teenager write this???                                          \u2502\n\u2502 Wheelmate Laptop Steering Wheel Desk                                                     \u2502 Perfect for an Starfleet Helmsman                                     \u2502\n\u2502 Kindle Wireless Reading Device (6" Display, U.S. Wireless)                               \u2502 BEWARE of the SIGNIFICANT DIFFERENCES between Kindle 1 and Kindle 2!  \u2502\n\u2502 Tuscan Dairy Whole Vitamin D Milk, Gallon, 128 oz                                        \u2502 Make this your only stock and store                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n10 rows in set. Elapsed: 17.595 sec. Processed 150.96 million rows, 15.36 GB (8.58 million rows/s., 872.89 MB/s.)\n')),(0,r.kt)("ol",{start:8},(0,r.kt)("li",{parentName:"ol"},"Here are the top 10 products in Amazon with the most reviews:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    any(product_title),\n    count()\nFROM amazon_reviews\nGROUP BY product_id\nORDER BY 2 DESC\nLIMIT 10;\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-response"},"\u250c\u2500any(product_title)\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500count()\u2500\u2510\n\u2502 Candy Crush Saga                              \u2502   50051 \u2502\n\u2502 The Secret Society\xae - Hidden Mystery          \u2502   41255 \u2502\n\u2502 Google Chromecast HDMI Streaming Media Player \u2502   35977 \u2502\n\u2502 Minecraft                                     \u2502   35129 \u2502\n\u2502 Bosch Season 1                                \u2502   33610 \u2502\n\u2502 Gone Girl: A Novel                            \u2502   33240 \u2502\n\u2502 Subway Surfers                                \u2502   32328 \u2502\n\u2502 The Fault in Our Stars                        \u2502   30149 \u2502\n\u2502 Amazon.com eGift Cards                        \u2502   28879 \u2502\n\u2502 Crossy Road                                   \u2502   28111 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n10 rows in set. Elapsed: 16.684 sec. Processed 195.05 million rows, 20.86 GB (11.69 million rows/s., 1.25 GB/s.)\n")),(0,r.kt)("ol",{start:9},(0,r.kt)("li",{parentName:"ol"},"Here are the average review ratings per month for each product (an actual ",(0,r.kt)("a",{parentName:"li",href:"https://datalemur.com/questions/sql-avg-review-ratings"},"Amazon job interview question"),"!):")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    toYYYYMM(review_date) AS month,\n    any(product_title),\n    avg(star_rating) AS avg_stars\nFROM amazon_reviews\nGROUP BY\n    month,\n    product_id\nORDER BY\n    month DESC,\n    product_id ASC\nLIMIT 20;\n")),(0,r.kt)("p",null,"It calculates all the monthly averages for each product, but we only returned 20 rows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-response"},"\u250c\u2500\u2500month\u2500\u252c\u2500any(product_title)\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500avg_stars\u2500\u2510\n\u2502 201508 \u2502 Mystiqueshapes Girls Ballet Tutu Neon Lime Green                                        \u2502         4 \u2502\n\u2502 201508 \u2502 Adult Ballet Tutu Yellow                                                                \u2502         5 \u2502\n\u2502 201508 \u2502 The Way Things Work: An Illustrated Encyclopedia of Technology                          \u2502         5 \u2502\n\u2502 201508 \u2502 Hilda Boswell's Treasury of Poetry                                                      \u2502         5 \u2502\n\u2502 201508 \u2502 Treasury of Poetry                                                                      \u2502         5 \u2502\n\u2502 201508 \u2502 Uncle Remus Stories                                                                     \u2502         5 \u2502\n\u2502 201508 \u2502 The Book of Daniel                                                                      \u2502         5 \u2502\n\u2502 201508 \u2502 Berenstains' B Book                                                                     \u2502         5 \u2502\n\u2502 201508 \u2502 The High Hills (Brambly Hedge)                                                          \u2502       4.5 \u2502\n\u2502 201508 \u2502 Fuzzypeg Goes to School (The Little Grey Rabbit library)                                \u2502         5 \u2502\n\u2502 201508 \u2502 Dictionary in French: The Cat in the Hat (Beginner Series)                              \u2502         5 \u2502\n\u2502 201508 \u2502 Windfallen                                                                              \u2502         5 \u2502\n\u2502 201508 \u2502 The Monk Who Sold His Ferrari: A Remarkable Story About Living Your Dreams              \u2502         5 \u2502\n\u2502 201508 \u2502 Illustrissimi: The Letters of Pope John Paul I                                          \u2502         5 \u2502\n\u2502 201508 \u2502 Social Contract: A Personal Inquiry into the Evolutionary Sources of Order and Disorder \u2502         5 \u2502\n\u2502 201508 \u2502 Mexico The Beautiful Cookbook: Authentic Recipes from the Regions of Mexico             \u2502       4.5 \u2502\n\u2502 201508 \u2502 Alanbrooke                                                                              \u2502         5 \u2502\n\u2502 201508 \u2502 Back to Cape Horn                                                                       \u2502         4 \u2502\n\u2502 201508 \u2502 Ovett: An Autobiography (Willow books)                                                  \u2502         5 \u2502\n\u2502 201508 \u2502 The Birds of West Africa (Collins Field Guides)                                         \u2502         4 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n20 rows in set. Elapsed: 55.529 sec. Processed 252.02 million rows, 35.58 GB (4.54 million rows/s., 640.79 MB/s.)\n")),(0,r.kt)("ol",{start:10},(0,r.kt)("li",{parentName:"ol"},"Here are the total number of votes per product category. This query is fast because ",(0,r.kt)("inlineCode",{parentName:"li"},"product_category")," is in the primary key:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    sum(total_votes),\n    product_category\nFROM amazon_reviews\nGROUP BY product_category\nORDER BY 1 DESC;\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-response"},"\u250c\u2500sum(total_votes)\u2500\u252c\u2500product_category\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        103877874 \u2502 Books                    \u2502\n\u2502         25330411 \u2502 Digital_Ebook_Purchase   \u2502\n\u2502         23065953 \u2502 Video DVD                \u2502\n\u2502         18048069 \u2502 Music                    \u2502\n\u2502         17292294 \u2502 Mobile_Apps              \u2502\n\u2502         15977124 \u2502 Health & Personal Care   \u2502\n\u2502         13554090 \u2502 PC                       \u2502\n\u2502         13065746 \u2502 Kitchen                  \u2502\n\u2502         12537926 \u2502 Home                     \u2502\n\u2502         11067538 \u2502 Beauty                   \u2502\n\u2502         10418643 \u2502 Wireless                 \u2502\n\u2502          9089085 \u2502 Toys                     \u2502\n\u2502          9071484 \u2502 Sports                   \u2502\n\u2502          7335647 \u2502 Electronics              \u2502\n\u2502          6885504 \u2502 Apparel                  \u2502\n\u2502          6710085 \u2502 Video Games              \u2502\n\u2502          6556319 \u2502 Camera                   \u2502\n\u2502          6305478 \u2502 Lawn and Garden          \u2502\n\u2502          5954422 \u2502 Office Products          \u2502\n\u2502          5339437 \u2502 Home Improvement         \u2502\n\u2502          5284343 \u2502 Outdoors                 \u2502\n\u2502          5125199 \u2502 Pet Products             \u2502\n\u2502          4733251 \u2502 Grocery                  \u2502\n\u2502          4697750 \u2502 Shoes                    \u2502\n\u2502          4666487 \u2502 Automotive               \u2502\n\u2502          4361518 \u2502 Digital_Video_Download   \u2502\n\u2502          4033550 \u2502 Tools                    \u2502\n\u2502          3559010 \u2502 Baby                     \u2502\n\u2502          3317662 \u2502 Home Entertainment       \u2502\n\u2502          2559501 \u2502 Video                    \u2502\n\u2502          2204328 \u2502 Furniture                \u2502\n\u2502          2157587 \u2502 Musical Instruments      \u2502\n\u2502          1881662 \u2502 Software                 \u2502\n\u2502          1676081 \u2502 Jewelry                  \u2502\n\u2502          1499945 \u2502 Watches                  \u2502\n\u2502          1224071 \u2502 Digital_Music_Purchase   \u2502\n\u2502           847918 \u2502 Luggage                  \u2502\n\u2502           503939 \u2502 Major Appliances         \u2502\n\u2502           392001 \u2502 Digital_Video_Games      \u2502\n\u2502           348990 \u2502 Personal_Care_Appliances \u2502\n\u2502           321372 \u2502 Digital_Software         \u2502\n\u2502           169585 \u2502 Mobile_Electronics       \u2502\n\u2502            72970 \u2502 Gift Card                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n43 rows in set. Elapsed: 0.423 sec. Processed 150.96 million rows, 756.20 MB (356.70 million rows/s., 1.79 GB/s.)\n")),(0,r.kt)("ol",{start:11},(0,r.kt)("li",{parentName:"ol"},"Let's find the products with the word ",(0,r.kt)("strong",{parentName:"li"},'"awful"')," occurring most frequently in the review. This is a big task - over 151M strings have to be parsed looking for a single word:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    product_id,\n    any(product_title),\n    avg(star_rating),\n    count() AS count\nFROM amazon_reviews\nWHERE position(review_body, 'awful') > 0\nGROUP BY product_id\nORDER BY count DESC\nLIMIT 50;\n")),(0,r.kt)("p",null,"The query takes a couple of minutes, but the results are a fun read:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-response"},'\n\u250c\u2500product_id\u2500\u252c\u2500any(product_title)\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500avg(star_rating)\u2500\u252c\u2500count\u2500\u2510\n\u2502 0345803485 \u2502 Fifty Shades of Grey: Book One of the Fifty Shades Trilogy (Fifty Shades of Grey Series) \u2502 1.3870967741935485 \u2502   248 \u2502\n\u2502 B007J4T2G8 \u2502 Fifty Shades of Grey (Fifty Shades, Book 1)                                              \u2502 1.4439834024896265 \u2502   241 \u2502\n\u2502 B006LSZECO \u2502 Gone Girl: A Novel                                                                       \u2502 2.2986425339366514 \u2502   221 \u2502\n\u2502 B00008OWZG \u2502 St. Anger                                                                                \u2502 1.6565656565656566 \u2502   198 \u2502\n\u2502 B00BD99JMW \u2502 Allegiant (Divergent Trilogy, Book 3)                                                    \u2502 1.8342541436464088 \u2502   181 \u2502\n\u2502 B0000YUXI0 \u2502 Mavala Switzerland Mavala Stop Nail Biting                                               \u2502  4.473684210526316 \u2502   171 \u2502\n\u2502 B004S8F7QM \u2502 Cards Against Humanity                                                                   \u2502  4.753012048192771 \u2502   166 \u2502\n\u2502 031606792X \u2502 Breaking Dawn (The Twilight Saga, Book 4)                                                \u2502           1.796875 \u2502   128 \u2502\n\u2502 006202406X \u2502 Allegiant (Divergent Series)                                                             \u2502 1.4242424242424243 \u2502    99 \u2502\n\u2502 B0051VVOB2 \u2502 Kindle Fire (Previous Generation - 1st)                                                  \u2502 2.7448979591836733 \u2502    98 \u2502\n\u2502 B00I3MP3SG \u2502 Pilot                                                                                    \u2502 1.8762886597938144 \u2502    97 \u2502\n\u2502 030758836X \u2502 Gone Girl                                                                                \u2502            2.15625 \u2502    96 \u2502\n\u2502 B0009X29WK \u2502 Precious Cat Ultra Premium Clumping Cat Litter                                           \u2502 3.0759493670886076 \u2502    79 \u2502\n\u2502 B00JB3MVCW \u2502 Noah                                                                                     \u2502 1.2027027027027026 \u2502    74 \u2502\n\u2502 B00BAXFECK \u2502 The Goldfinch: A Novel (Pulitzer Prize for Fiction)                                      \u2502  2.643835616438356 \u2502    73 \u2502\n\u2502 B00N28818A \u2502 Amazon Prime Video                                                                       \u2502 1.4305555555555556 \u2502    72 \u2502\n\u2502 B007FTE2VW \u2502 SimCity - Limited Edition                                                                \u2502 1.2794117647058822 \u2502    68 \u2502\n\u2502 0439023513 \u2502 Mockingjay (The Hunger Games)                                                            \u2502 2.6417910447761193 \u2502    67 \u2502\n\u2502 B00178630A \u2502 Diablo III - PC/Mac                                                                      \u2502           1.671875 \u2502    64 \u2502\n\u2502 B000OCEWGW \u2502 Liquid Ass                                                                               \u2502             4.8125 \u2502    64 \u2502\n\u2502 B005ZOBNOI \u2502 The Fault in Our Stars                                                                   \u2502  4.316666666666666 \u2502    60 \u2502\n\u2502 B00L9B7IKE \u2502 The Girl on the Train: A Novel                                                           \u2502 2.0677966101694913 \u2502    59 \u2502\n\u2502 B007S6Y6VS \u2502 Garden of Life Raw Organic Meal                                                          \u2502 2.8793103448275863 \u2502    58 \u2502\n\u2502 B0064X7B4A \u2502 Words With Friends                                                                       \u2502 2.2413793103448274 \u2502    58 \u2502\n\u2502 B003WUYPPG \u2502 Unbroken: A World War II Story of Survival, Resilience, and Redemption                   \u2502  4.620689655172414 \u2502    58 \u2502\n\u2502 B00006HBUJ \u2502 Star Wars: Episode II - Attack of the Clones (Widescreen Edition)                        \u2502 2.2982456140350878 \u2502    57 \u2502\n\u2502 B000XUBFE2 \u2502 The Book Thief                                                                           \u2502  4.526315789473684 \u2502    57 \u2502\n\u2502 B0006399FS \u2502 How to Dismantle an Atomic Bomb                                                          \u2502 1.9821428571428572 \u2502    56 \u2502\n\u2502 B003ZSJ212 \u2502 Star Wars: The Complete Saga (Episodes I-VI) (Packaging May Vary) [Blu-ray]              \u2502  2.309090909090909 \u2502    55 \u2502\n\u2502 193700788X \u2502 Dead Ever After (Sookie Stackhouse/True Blood)                                           \u2502 1.5185185185185186 \u2502    54 \u2502\n\u2502 B004FYEZMQ \u2502 Mass Effect 3                                                                            \u2502  2.056603773584906 \u2502    53 \u2502\n\u2502 B000CFYAMC \u2502 The Room                                                                                 \u2502 3.9615384615384617 \u2502    52 \u2502\n\u2502 B0031JK95S \u2502 Garden of Life Raw Organic Meal                                                          \u2502 3.3137254901960786 \u2502    51 \u2502\n\u2502 B0012JY4G4 \u2502 Color Oops Hair Color Remover Extra Strength 1 Each                                      \u2502 3.9019607843137254 \u2502    51 \u2502\n\u2502 B007VTVRFA \u2502 SimCity - Limited Edition                                                                \u2502 1.2040816326530612 \u2502    49 \u2502\n\u2502 B00CE18P0K \u2502 Pilot                                                                                    \u2502 1.7142857142857142 \u2502    49 \u2502\n\u2502 0316015849 \u2502 Twilight (The Twilight Saga, Book 1)                                                     \u2502 1.8979591836734695 \u2502    49 \u2502\n\u2502 B00DR0PDNE \u2502 Google Chromecast HDMI Streaming Media Player                                            \u2502 2.5416666666666665 \u2502    48 \u2502\n\u2502 B000056OWC \u2502 The First Years: 4-Stage Bath System                                                     \u2502 1.2127659574468086 \u2502    47 \u2502\n\u2502 B007IXWKUK \u2502 Fifty Shades Darker (Fifty Shades, Book 2)                                               \u2502 1.6304347826086956 \u2502    46 \u2502\n\u2502 1892112000 \u2502 To Train Up a Child                                                                      \u2502 1.4130434782608696 \u2502    46 \u2502\n\u2502 043935806X \u2502 Harry Potter and the Order of the Phoenix (Book 5)                                       \u2502  3.977272727272727 \u2502    44 \u2502\n\u2502 B00BGO0Q9O \u2502 Fitbit Flex Wireless Wristband with Sleep Function, Black                                \u2502 1.9318181818181819 \u2502    44 \u2502\n\u2502 B003XF1XOQ \u2502 Mockingjay (Hunger Games Trilogy, Book 3)                                                \u2502  2.772727272727273 \u2502    44 \u2502\n\u2502 B00DD2B52Y \u2502 Spring Breakers                                                                          \u2502 1.2093023255813953 \u2502    43 \u2502\n\u2502 B0064X7FVE \u2502 The Weather Channel: Forecast, Radar & Alerts                                            \u2502 1.5116279069767442 \u2502    43 \u2502\n\u2502 B0083PWAPW \u2502 Kindle Fire HD 7", Dolby Audio, Dual-Band Wi-Fi                                          \u2502  2.627906976744186 \u2502    43 \u2502\n\u2502 B00192KCQ0 \u2502 Death Magnetic                                                                           \u2502 3.5714285714285716 \u2502    42 \u2502\n\u2502 B007S6Y74O \u2502 Garden of Life Raw Organic Meal                                                          \u2502  3.292682926829268 \u2502    41 \u2502\n\u2502 B0052QYLUM \u2502 Infant Optics DXR-5 Portable Video Baby Monitor                                          \u2502 2.1463414634146343 \u2502    41 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n50 rows in set. Elapsed: 60.052 sec. Processed 150.96 million rows, 68.93 GB (2.51 million rows/s., 1.15 GB/s.)\n')),(0,r.kt)("ol",{start:12},(0,r.kt)("li",{parentName:"ol"},"We can run the same query again, except this time we search for ",(0,r.kt)("strong",{parentName:"li"},"awesome")," in the reviews:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    product_id,\n    any(product_title),\n    avg(star_rating),\n    count() AS count\nFROM amazon_reviews\nWHERE position(review_body, 'awesome') > 0\nGROUP BY product_id\nORDER BY count DESC\nLIMIT 50;\n")),(0,r.kt)("p",null,"It runs quite a bit faster - which means the cache is helping us out here:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-response"},"\n\u250c\u2500product_id\u2500\u252c\u2500any(product_title)\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500avg(star_rating)\u2500\u252c\u2500count\u2500\u2510\n\u2502 B00992CF6W \u2502 Minecraft                                                             \u2502  4.848130353039482 \u2502  4787 \u2502\n\u2502 B009UX2YAC \u2502 Subway Surfers                                                        \u2502  4.866720955483171 \u2502  3684 \u2502\n\u2502 B00QW8TYWO \u2502 Crossy Road                                                           \u2502  4.935217903415784 \u2502  2547 \u2502\n\u2502 B00DJFIMW6 \u2502 Minion Rush: Despicable Me Official Game                              \u2502  4.850450450450451 \u2502  2220 \u2502\n\u2502 B00AREIAI8 \u2502 My Horse                                                              \u2502  4.865313653136531 \u2502  2168 \u2502\n\u2502 B00I8Q77Y0 \u2502 Flappy Wings (not Flappy Bird)                                        \u2502 4.8246561886051085 \u2502  2036 \u2502\n\u2502 B0054JZC6E \u2502 101-in-1 Games                                                        \u2502  4.792542016806722 \u2502  1904 \u2502\n\u2502 B00G5LQ5MU \u2502 Escape The Titanic                                                    \u2502  4.724673710379117 \u2502  1609 \u2502\n\u2502 B0086700CM \u2502 Temple Run                                                            \u2502   4.87636130685458 \u2502  1561 \u2502\n\u2502 B009HKL4B8 \u2502 The Sims Freeplay                                                     \u2502  4.763942931258106 \u2502  1542 \u2502\n\u2502 B00I6IKSZ0 \u2502 Pixel Gun 3D (Pocket Edition) - multiplayer shooter with skin creator \u2502  4.849894291754757 \u2502  1419 \u2502\n\u2502 B006OC2ANS \u2502 BLOOD & GLORY                                                         \u2502 4.8561538461538465 \u2502  1300 \u2502\n\u2502 B00FATEJYE \u2502 Injustice: Gods Among Us (Kindle Tablet Edition)                      \u2502  4.789265982636149 \u2502  1267 \u2502\n\u2502 B00B2V66VS \u2502 Temple Run 2                                                          \u2502  4.764705882352941 \u2502  1173 \u2502\n\u2502 B00JOT3HQ2 \u2502 Geometry Dash Lite                                                    \u2502  4.909747292418772 \u2502  1108 \u2502\n\u2502 B00DUGCLY4 \u2502 Guess The Emoji                                                       \u2502  4.813606710158434 \u2502  1073 \u2502\n\u2502 B00DR0PDNE \u2502 Google Chromecast HDMI Streaming Media Player                         \u2502  4.607276119402985 \u2502  1072 \u2502\n\u2502 B00FAPF5U0 \u2502 Candy Crush Saga                                                      \u2502  4.825757575757576 \u2502  1056 \u2502\n\u2502 B0051VVOB2 \u2502 Kindle Fire (Previous Generation - 1st)                               \u2502  4.600407747196738 \u2502   981 \u2502\n\u2502 B007JPG04E \u2502 FRONTLINE COMMANDO                                                    \u2502             4.8125 \u2502   912 \u2502\n\u2502 B00PTB7B34 \u2502 Call of Duty\xae: Heroes                                                 \u2502  4.876404494382022 \u2502   890 \u2502\n\u2502 B00846GKTW \u2502 Style Me Girl - Free 3D Fashion Dressup                               \u2502  4.785714285714286 \u2502   882 \u2502\n\u2502 B004S8F7QM \u2502 Cards Against Humanity                                                \u2502  4.931034482758621 \u2502   754 \u2502\n\u2502 B00FAX6XQC \u2502 DEER HUNTER CLASSIC                                                   \u2502  4.700272479564033 \u2502   734 \u2502\n\u2502 B00PSGW79I \u2502 Buddyman: Kick                                                        \u2502  4.888736263736264 \u2502   728 \u2502\n\u2502 B00CTQ6SIG \u2502 The Simpsons: Tapped Out                                              \u2502  4.793948126801153 \u2502   694 \u2502\n\u2502 B008JK6W5K \u2502 Logo Quiz                                                             \u2502  4.782106782106782 \u2502   693 \u2502\n\u2502 B00EDTSKLU \u2502 Geometry Dash                                                         \u2502  4.942028985507246 \u2502   690 \u2502\n\u2502 B00CSR2J9I \u2502 Hill Climb Racing                                                     \u2502  4.880059970014993 \u2502   667 \u2502\n\u2502 B005ZXWMUS \u2502 Netflix                                                               \u2502  4.722306525037936 \u2502   659 \u2502\n\u2502 B00CRFAAYC \u2502 Fab Tattoo Artist FREE                                                \u2502  4.907435508345979 \u2502   659 \u2502\n\u2502 B00DHQHQCE \u2502 Battle Beach                                                          \u2502  4.863287250384024 \u2502   651 \u2502\n\u2502 B00BGA9WK2 \u2502 PlayStation 4 500GB Console [Old Model]                               \u2502  4.688751926040061 \u2502   649 \u2502\n\u2502 B008Y7SMQU \u2502 Logo Quiz - Fun Plus Free                                             \u2502             4.7888 \u2502   625 \u2502\n\u2502 B0083PWAPW \u2502 Kindle Fire HD 7\", Dolby Audio, Dual-Band Wi-Fi                       \u2502  4.593900481540931 \u2502   623 \u2502\n\u2502 B008XG1X18 \u2502 Pinterest                                                             \u2502 4.8148760330578515 \u2502   605 \u2502\n\u2502 B007SYWFRM \u2502 Ice Age Village                                                       \u2502 4.8566666666666665 \u2502   600 \u2502\n\u2502 B00K7WGUKA \u2502 Don't Tap The White Tile (Piano Tiles)                                \u2502  4.922689075630252 \u2502   595 \u2502\n\u2502 B00BWYQ9YE \u2502 Kindle Fire HDX 7\", HDX Display (Previous Generation - 3rd)           \u2502  4.649913344887349 \u2502   577 \u2502\n\u2502 B00IZLM8MY \u2502 High School Story                                                     \u2502  4.840425531914893 \u2502   564 \u2502\n\u2502 B004MC8CA2 \u2502 Bible                                                                 \u2502  4.884476534296029 \u2502   554 \u2502\n\u2502 B00KNWYDU8 \u2502 Dragon City                                                           \u2502  4.861111111111111 \u2502   540 \u2502\n\u2502 B009ZKSPDK \u2502 Survivalcraft                                                         \u2502  4.738317757009346 \u2502   535 \u2502\n\u2502 B00A4O6NMG \u2502 My Singing Monsters                                                   \u2502  4.845559845559846 \u2502   518 \u2502\n\u2502 B002MQYOFW \u2502 The Hunger Games (Hunger Games Trilogy, Book 1)                       \u2502  4.846899224806202 \u2502   516 \u2502\n\u2502 B005ZFOOE8 \u2502 iHeartRadio \u2013 Free Music & Internet Radio                             \u2502  4.837301587301587 \u2502   504 \u2502\n\u2502 B00AIUUXHC \u2502 Hungry Shark Evolution                                                \u2502  4.846311475409836 \u2502   488 \u2502\n\u2502 B00E8KLWB4 \u2502 The Secret Society\xae - Hidden Mystery                                  \u2502  4.669438669438669 \u2502   481 \u2502\n\u2502 B006D1ONE4 \u2502 Where's My Water?                                                     \u2502  4.916317991631799 \u2502   478 \u2502\n\u2502 B00G6ZTM3Y \u2502 Terraria                                                              \u2502  4.728421052631579 \u2502   475 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n50 rows in set. Elapsed: 33.954 sec. Processed 150.96 million rows, 68.95 GB (4.45 million rows/s., 2.03 GB/s.)\n")))}p.isMDXComponent=!0}}]);