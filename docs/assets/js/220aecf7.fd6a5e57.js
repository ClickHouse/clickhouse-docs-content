"use strict";(self.webpackChunknew_nav_docusaurus_2_2=self.webpackChunknew_nav_docusaurus_2_2||[]).push([[12822],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>h});var o=a(67294);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function n(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,o,s=function(e,t){if(null==e)return{};var a,o,s={},r=Object.keys(e);for(o=0;o<r.length;o++)a=r[o],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)a=r[o],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}var l=o.createContext({}),c=function(e){var t=o.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):n(n({},t),e)),a},u=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var a=e.components,s=e.mdxType,r=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=c(a),m=s,h=p["".concat(l,".").concat(m)]||p[m]||d[m]||r;return a?o.createElement(h,n(n({ref:t},u),{},{components:a})):o.createElement(h,n({ref:t},u))}));function h(e,t){var a=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var r=a.length,n=new Array(r);n[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[p]="string"==typeof e?e:s,n[1]=i;for(var c=2;c<r;c++)n[c]=a[c];return o.createElement.apply(null,n)}return o.createElement.apply(null,a)}m.displayName="MDXCreateElement"},20967:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>n,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>c});var o=a(87462),s=(a(67294),a(3905));const r={sidebar_position:1,sidebar_label:"Why is ClickHouse so Fast?",description:"It was designed to be fast. Query execution performance has always been a top priority during the development process, but other important characteristics like user-friendliness, scalability, and security were also considered so ClickHouse could become a real production system."},n="Why is ClickHouse so fast?",i={unversionedId:"en/concepts/why-clickhouse-is-so-fast",id:"en/concepts/why-clickhouse-is-so-fast",title:"Why is ClickHouse so fast?",description:"It was designed to be fast. Query execution performance has always been a top priority during the development process, but other important characteristics like user-friendliness, scalability, and security were also considered so ClickHouse could become a real production system.",source:"@site/docs/en/concepts/why-clickhouse-is-so-fast.md",sourceDirName:"en/concepts",slug:"/en/concepts/why-clickhouse-is-so-fast",permalink:"/docs/en/concepts/why-clickhouse-is-so-fast",draft:!1,editUrl:"https://github.com/ClickHouse/clickhouse-docs/blob/main/docs/en/concepts/why-clickhouse-is-so-fast.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,sidebar_label:"Why is ClickHouse so Fast?",description:"It was designed to be fast. Query execution performance has always been a top priority during the development process, but other important characteristics like user-friendliness, scalability, and security were also considered so ClickHouse could become a real production system."},sidebar:"docs",previous:{title:"Install",permalink:"/docs/en/install"},next:{title:"What is OLAP?",permalink:"/docs/en/concepts/olap"}},l={},c=[{value:"&quot;Building for Fast&quot;, Alexey Milovidov (CTO, ClickHouse)",id:"building-for-fast-alexey-milovidov-cto-clickhouse",level:3},{value:"What Makes ClickHouse so Fast?",id:"what-makes-clickhouse-so-fast",level:2},{value:"Architecture choices",id:"architecture-choices",level:3},{value:"Attention to Low-Level Details",id:"attention-to-low-level-details",level:3}],u={toc:c},p="wrapper";function d(e){let{components:t,...a}=e;return(0,s.kt)(p,(0,o.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"why-clickhouse-is-so-fast"},"Why is ClickHouse so fast?"),(0,s.kt)("p",null,"It was designed to be fast. Query execution performance has always been a top priority during the development process, but other important characteristics like user-friendliness, scalability, and security were also considered so ClickHouse could become a real production system."),(0,s.kt)("h3",{id:"building-for-fast-alexey-milovidov-cto-clickhouse"},'"Building for Fast", Alexey Milovidov (CTO, ClickHouse)'),(0,s.kt)("iframe",{width:"675",height:"380",src:"https://www.youtube.com/embed/CAS2otEoerM",frameborder:"0",allow:"accelerometer; autoplay; gyroscope; picture-in-picture",allowfullscreen:!0}),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=CAS2otEoerM"},'"Building for Fast"')," talk from ClickHouse Meetup Amsterdam, June 2022."),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=ZOZQCQEtrz8"},'"Secrets of ClickHouse Performance Optimizations"')," talk from Big Data Technology Conference, December 2019, offers a more technical take on the same topic."),(0,s.kt)("h2",{id:"what-makes-clickhouse-so-fast"},"What Makes ClickHouse so Fast?"),(0,s.kt)("h3",{id:"architecture-choices"},"Architecture choices"),(0,s.kt)("p",null,"ClickHouse was initially built as a prototype to do just a single task well: to filter and aggregate data as fast as possible. That\u2019s what needs to be done to build a typical analytical report, and that\u2019s what a typical ",(0,s.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/statements/select/group-by"},"GROUP BY")," query does. The ClickHouse team has made several high-level decisions that, when combined, made achieving this task possible:"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Column-oriented storage:"),"   Source data often contain hundreds or even thousands of columns, while a report can use just a few of them. The system needs to avoid reading unnecessary columns to avoid expensive disk read operations."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Indexes:"),"  Memory resident ClickHouse data structures allow the reading of only the necessary columns, and only the necessary row ranges of those columns."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Data compression:"),"   Storing different values of the same column together often leads to better compression ratios (compared to row-oriented systems) because in real data a column often has the same, or not so many different, values for neighboring rows. In addition to general-purpose compression, ClickHouse supports ",(0,s.kt)("a",{parentName:"p",href:"/docs/en/sql-reference/statements/create/table/#specialized-codecs"},"specialized codecs")," that can make data even more compact."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Vectorized query execution:"),"  ClickHouse not only stores data in columns but also processes data in columns. This leads to better CPU cache utilization and allows for ",(0,s.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/SIMD"},"SIMD")," CPU instructions usage."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Scalability:"),"   ClickHouse can leverage all available CPU cores and disks to execute even a single query. Not only on a single server but all CPU cores and disks of a cluster as well."),(0,s.kt)("h3",{id:"attention-to-low-level-details"},"Attention to Low-Level Details"),(0,s.kt)("p",null,"But many other database management systems use similar techniques. What really makes ClickHouse stand out is ",(0,s.kt)("strong",{parentName:"p"},"attention to low-level details"),". Most programming languages provide implementations for most common algorithms and data structures, but they tend to be too generic to be effective. Every task can be considered as a landscape with various characteristics, instead of just throwing in random implementation. For example, if you need a hash table, here are some key questions to consider:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Which hash function to choose?"),(0,s.kt)("li",{parentName:"ul"},"Collision resolution algorithm: ",(0,s.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Open_addressing"},"open addressing")," vs ",(0,s.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Hash_table#Separate_chaining"},"chaining"),"?"),(0,s.kt)("li",{parentName:"ul"},"Memory layout: one array for keys and values or separate arrays? Will it store small or large values?"),(0,s.kt)("li",{parentName:"ul"},"Fill factor: when and how to resize? How to move values around on resize?"),(0,s.kt)("li",{parentName:"ul"},"Will values be removed and which algorithm will work better if they will?"),(0,s.kt)("li",{parentName:"ul"},"Will we need fast probing with bitmaps, inline placement of string keys, support for non-movable values, prefetch, and batching?")),(0,s.kt)("p",null,"Hash table is a key data structure for ",(0,s.kt)("inlineCode",{parentName:"p"},"GROUP BY")," implementation and ClickHouse automatically chooses one of ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/ClickHouse/blob/master/src/Interpreters/Aggregator.h"},"30+ variations")," for each specific query."),(0,s.kt)("p",null,"The same goes for algorithms, for example, in sorting you might consider:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"What will be sorted: an array of numbers, tuples, strings, or structures?"),(0,s.kt)("li",{parentName:"ul"},"Is all data available completely in RAM?"),(0,s.kt)("li",{parentName:"ul"},"Do we need a stable sort?"),(0,s.kt)("li",{parentName:"ul"},"Do we need a full sort? Maybe partial sort or n-th element will suffice?"),(0,s.kt)("li",{parentName:"ul"},"How to implement comparisons?"),(0,s.kt)("li",{parentName:"ul"},"Are we sorting data that has already been partially sorted?")),(0,s.kt)("p",null,"Algorithms that they rely on characteristics of data they are working with can often do better than their generic counterparts. If it is not really known in advance, the system can try various implementations and choose the one that works best in runtime. For example, see an ",(0,s.kt)("a",{parentName:"p",href:"https://habr.com/en/company/yandex/blog/457612/"},"article on how LZ4 decompression is implemented in ClickHouse"),"."),(0,s.kt)("p",null,"Last but not least, the ClickHouse team always monitors the Internet on people claiming that they came up with the best implementation, algorithm, or data structure to do something and tries it out. Those claims mostly appear to be false, but from time to time you\u2019ll indeed find a gem."),(0,s.kt)("admonition",{title:"Tips for building your own high-performance software",type:"info"},(0,s.kt)("ul",{parentName:"admonition"},(0,s.kt)("li",{parentName:"ul"},"Keep in mind low-level details when designing your system."),(0,s.kt)("li",{parentName:"ul"},"Design based on hardware capabilities."),(0,s.kt)("li",{parentName:"ul"},"Choose data structures and abstractions based on the needs of the task."),(0,s.kt)("li",{parentName:"ul"},"Provide specializations for special cases."),(0,s.kt)("li",{parentName:"ul"},'Try new, "best" algorithms, that you read about yesterday.'),(0,s.kt)("li",{parentName:"ul"},"Choose an algorithm in runtime based on statistics."),(0,s.kt)("li",{parentName:"ul"},"Benchmark on real datasets."),(0,s.kt)("li",{parentName:"ul"},"Test for performance regressions in CI."),(0,s.kt)("li",{parentName:"ul"},"Measure and observe everything."))))}d.isMDXComponent=!0}}]);