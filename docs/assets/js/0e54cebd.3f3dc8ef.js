"use strict";(self.webpackChunkclickhouse=self.webpackChunkclickhouse||[]).push([[5349],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,s=e.originalType,c=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=l(n),m=i,v=u["".concat(c,".").concat(m)]||u[m]||d[m]||s;return n?a.createElement(v,r(r({ref:t},p),{},{components:n})):a.createElement(v,r({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var s=n.length,r=new Array(s);r[0]=u;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o.mdxType="string"==typeof e?e:i,r[1]=o;for(var l=2;l<s;l++)r[l]=n[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},13142:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>c,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var a=n(87462),i=(n(67294),n(3905));const s={toc:[]};function r(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Region"),(0,i.kt)("th",{parentName:"tr",align:null},"VPC Service Name"),(0,i.kt)("th",{parentName:"tr",align:null},"AZ IDs"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ap-south-1"),(0,i.kt)("td",{parentName:"tr",align:null},"com.amazonaws.vpce.ap-south-1.vpce-svc-0a786406c7ddc3a1b"),(0,i.kt)("td",{parentName:"tr",align:null},"aps1-az1 aps1-az2 aps1-az3")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"ap-southeast-1"),(0,i.kt)("td",{parentName:"tr",align:null},"com.amazonaws.vpce.ap-southeast-1.vpce-svc-0a8b096ec9d2acb01"),(0,i.kt)("td",{parentName:"tr",align:null},"apse1-az1 apse1-az2 apse1-az3")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"eu-central-1"),(0,i.kt)("td",{parentName:"tr",align:null},"com.amazonaws.vpce.eu-central-1.vpce-svc-0536fc4b80a82b8ed"),(0,i.kt)("td",{parentName:"tr",align:null},"euc1-az2 euc1-az3 euc1-az1")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"eu-west-1"),(0,i.kt)("td",{parentName:"tr",align:null},"com.amazonaws.vpce.eu-west-1.vpce-svc-066b03c9b5f61c6fc"),(0,i.kt)("td",{parentName:"tr",align:null},"euw1-az2 euw1-az3 euw1-az1")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"us-east-1"),(0,i.kt)("td",{parentName:"tr",align:null},"com.amazonaws.vpce.us-east-1.vpce-svc-0a0218fa75c646d81"),(0,i.kt)("td",{parentName:"tr",align:null},"use1-az6 use1-az1 use1-az2")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"us-east-2"),(0,i.kt)("td",{parentName:"tr",align:null},"com.amazonaws.vpce.us-east-2.vpce-svc-0b99748bf269a86b4"),(0,i.kt)("td",{parentName:"tr",align:null},"use2-az1 use2-az2 use2-az3")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"us-west-2"),(0,i.kt)("td",{parentName:"tr",align:null},"com.amazonaws.vpce.us-west-2.vpce-svc-049bbd33f61271781"),(0,i.kt)("td",{parentName:"tr",align:null},"usw2-az2 usw2-az1 usw2-az3")))))}r.isMDXComponent=!0;const o={slug:"/en/manage/security/aws-privatelink",sidebar_label:"Setting up AWS PrivateLink",title:"Setting up AWS PrivateLink"},c=void 0,l={unversionedId:"en/cloud/security/aws-privatelink",id:"en/cloud/security/aws-privatelink",title:"Setting up AWS PrivateLink",description:"Private Link Services",source:"@site/docs/en/cloud/security/aws-privatelink.md",sourceDirName:"en/cloud/security",slug:"/en/manage/security/aws-privatelink",permalink:"/docs/en/manage/security/aws-privatelink",draft:!1,editUrl:"https://github.com/ClickHouse/clickhouse-docs/blob/main/docs/en/cloud/security/aws-privatelink.md",tags:[],version:"current",frontMatter:{slug:"/en/manage/security/aws-privatelink",sidebar_label:"Setting up AWS PrivateLink",title:"Setting up AWS PrivateLink"},sidebar:"english",previous:{title:"Organization Activity",permalink:"/docs/en/manage/security/organization-activity"},next:{title:"Cloud Support",permalink:"/docs/en/cloud/support"}},p={},d=[{value:"Private Link Services",id:"private-link-services",level:2},{value:"Create service endpoint",id:"create-service-endpoint",level:2},{value:"Select VPC and subnets",id:"select-vpc-and-subnets",level:2},{value:"AWS CloudFormation",id:"aws-cloudformation",level:2},{value:"Terraform",id:"terraform",level:2},{value:"Reach out to ClickHouse Support",id:"reach-out-to-clickhouse-support",level:2},{value:"Test connectivity",id:"test-connectivity",level:2},{value:"Shift network traffic to VPC Endpoint",id:"shift-network-traffic-to-vpc-endpoint",level:2},{value:"AWS Console",id:"aws-console",level:2},{value:"AWS CloudFormation",id:"aws-cloudformation-1",level:3},{value:"Terraform",id:"terraform-1",level:3},{value:"Verification",id:"verification",level:2},{value:"Verify connectivity to ClickHouse Cloud service",id:"verify-connectivity-to-clickhouse-cloud-service",level:3}],u={toc:d};function m(e){let{components:t,...s}=e;return(0,i.kt)("wrapper",(0,a.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"private-link-services"},"Private Link Services"),(0,i.kt)("p",null,"You can use ",(0,i.kt)("a",{parentName:"p",href:"https://aws.amazon.com/privatelink/"},"AWS PrivateLink")," to provide connectivity between VPCs, AWS services, your on-premises systems, and ClickHouse Cloud without having your traffic go across the internet.  This document describes how to connect to ClickHouse Cloud using AWS PrivateLink, and how to disable access to your ClickHouse Cloud services from addresses other than AWS PrivateLink addresses using ClickHouse Cloud IP Access Lists."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"VPC network diagram",src:n(72507).Z,width:"913",height:"555"})),(0,i.kt)("p",null,"This table lists the AWS Regions where ClickHouse Cloud services can be deployed, the associated VPC service name, and Availability Zone IDs.  You will need this information to setup AWS PrivateLink to connect to ClickHouse Cloud services."),(0,i.kt)(r,{mdxType:"AWSRegions"}),(0,i.kt)("h2",{id:"create-service-endpoint"},"Create service endpoint"),(0,i.kt)("p",null,"Create a service endpoint, please use a region from the table above."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"AWS PrivateLink is a regional service (as of today). You can only establish a connection within the same region."))),(0,i.kt)("p",null,"In the AWS console go to ",(0,i.kt)("strong",{parentName:"p"},"VPC > Endpoints > Create endpoints"),". Click on ",(0,i.kt)("strong",{parentName:"p"},"Other endpoint services")," and use one of the VPC Service Names from supported regions. Then click on ",(0,i.kt)("strong",{parentName:"p"},"Verify service"),"."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Endpoint settings",src:n(77778).Z,width:"1604",height:"1186"})),(0,i.kt)("div",{className:"admonition admonition-important alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"important")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Please note, AWS PrivateLink connectivity works in tandem with the ClickHouse ",(0,i.kt)("a",{parentName:"p",href:"/docs/en/manage/security/ip-access-list"},"IP Access List")," feature."),(0,i.kt)("p",{parentName:"div"},"We strongly recommend enabling IP Access Lists on each ClickHouse Cloud service, otherwise, the PrivateLink traffic filter will not be applied and the ClickHouse Cloud service could potentially be accessible to other ClickHouse PrivateLink customers."))),(0,i.kt)("h2",{id:"select-vpc-and-subnets"},"Select VPC and subnets"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Select VPC and subnets",src:n(41931).Z,width:"1654",height:"1200"})),(0,i.kt)("p",null,"Optional: assign Security groups/Tags"),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Make sure that the ClickHouse ports 8443 and 9440 are allowed in the Security group."))),(0,i.kt)("p",null,"After creating the VPC Endpoint, please write down the VPC Endpoint ID, you will need to provide this to ClickHouse Support."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"VPC endpoint ID",src:n(29194).Z,width:"1999",height:"561"})),(0,i.kt)("h2",{id:"aws-cloudformation"},"AWS CloudFormation"),(0,i.kt)("p",null,"Please use correct subnet IDs, security groups and VPC ID."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-response"},"Resources:\n  ClickHouseInterfaceEndpoint:\n    Type: 'AWS::EC2::VPCEndpoint'\n    Properties:\n      VpcEndpointType: Interface\n      PrivateDnsEnabled: false\n      ServiceName: com.amazonaws.vpce.us-west-2.vpce-svc-049bbd33f61271781\n      VpcId: vpc-vpc_id\n      SubnetIds:\n        - subnet-subnet_id1\n        - subnet-subnet_id2\n        - subnet-subnet_id3\n      SecurityGroupIds:\n        - sg-security_group_id1\n        - sg-security_group_id2\n        - sg-security_group_id3\n")),(0,i.kt)("h2",{id:"terraform"},"Terraform"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpc_endpoint"},"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpc_endpoint")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'resource "aws_vpc_endpoint" "this" {\n  vpc_id            = var.vpc_id\n  service_name      = \u201ccom.amazonaws.vpce.us-west-2.vpce-svc-049bbd33f61271781"\n  vpc_endpoint_type = "Interface"\n  security_group_ids = [\n    Var.security_group_id1,var.security_group_id2, var.security_group_id3,\n  ]\n  subnet_ids          = [var.subnet_id1,var.subnet_id2,var.subnet_id3]\n  private_dns_enabled = false\n}\n')),(0,i.kt)("h2",{id:"reach-out-to-clickhouse-support"},"Reach out to ClickHouse Support"),(0,i.kt)("p",null,"Click on ",(0,i.kt)("strong",{parentName:"p"},"Help")," in the ClickHouse Cloud console and choose Support to open a case.\nPlease provide the VPC Endpoint ID(s) and ClickHouse service hostname(s) to ClickHouse Support."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"VPC Endpoint IDs\nThere may be more than one VPC Endpoint ID, you should have a list of one or more of these from the step where you created the endpoint.  This is the section of the UI where the endpoint IDs are located:"),(0,i.kt)("p",{parentName:"li"},"  ",(0,i.kt)("img",{alt:"VPC endpoint ID",src:n(29194).Z,width:"1999",height:"561"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"ClickHouse instance URLs:\nThe ClickHouse instance URLs can be found in the Cloud console.  Click on a service that you need the URL for and open ",(0,i.kt)("strong",{parentName:"p"},"Connect"),".  The cluster hostname will be available:"),(0,i.kt)("p",{parentName:"li"},"  ",(0,i.kt)("img",{alt:"Cluster URL",src:n(33273).Z,width:"586",height:"470"})))),(0,i.kt)("p",null,"Once the request is processed, the VPC Endpoint service status will change from ",(0,i.kt)("strong",{parentName:"p"},"pendingAcceptance")," to ",(0,i.kt)("strong",{parentName:"p"},"Available"),"."),(0,i.kt)("h2",{id:"test-connectivity"},"Test connectivity"),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This step validates TCP connectivity between your VPC and ClickHouse cloud infrastructure over PrivateLink."))),(0,i.kt)("p",null,"Please get ",(0,i.kt)("strong",{parentName:"p"},"DNS Names")," from VPC Endpoint configuration:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Get DNS names",src:n(25634).Z,width:"1999",height:"783"})),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Please use this FQDN only for connectivity testing"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-response"},"telnet vpce-08c316c04b3a5623f-bi21tevr.vpce-svc-049bbd33f61271781.us-west-2.vpce.amazonaws.com 9440\nTrying 172.31.27.78...\n# highlight-next-line\nConnected to vpce-08c316c04b3a5623f-bi21tevr.vpce-svc-049bbd33f61271781.us-west-2.vpce.amazonaws.com\nEscape character is '^]'.\n^]\ntelnet> Connection closed.\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-response"},"telnet vpce-08c316c04b3a5623f-bi21tevr.vpce-svc-049bbd33f61271781.us-west-2.vpce.amazonaws.com 8443\nTrying 172.31.27.78...\n# highlight-next-line\nConnected to vpce-08c316c04b3a5623f-bi21tevr.vpce-svc-049bbd33f61271781.us-west-2.vpce.amazonaws.com.\nEscape character is '^]'.\n^]\ntelnet> Connection closed.\n")),(0,i.kt)("p",null,"The error below indicates a problem with connectivity."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-response"},"telnet vpce-08c316c04b3a5623f-bi21tevr.vpce-svc-049bbd33f61271781.us-west-2.vpce.amazonaws.com 9440\nTrying 172.31.25.195...\n# highlight-next-line\ntelnet: connect to address 172.31.25.195: No route to host\nTrying 172.31.3.200...\n")),(0,i.kt)("h2",{id:"shift-network-traffic-to-vpc-endpoint"},"Shift network traffic to VPC Endpoint"),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This step switches network traffic from traveliing over the Internet to using the VPC Endpoint."))),(0,i.kt)("p",null,"Before this step:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-response"},"[ec2-user@ip-172-31-29-231 ~]$ nslookup HOSTNAME.clickhouse.cloud\nServer:         172.31.0.2\nAddress:        172.31.0.2#53\n\nNon-authoritative answer:\nName:   HOSTNAME.clickhouse.cloud\n# highlight-next-line\nAddress: 44.226.232.172\nName:   HOSTNAME.clickhouse.cloud\n# highlight-next-line\nAddress: 35.82.252.60\nName:   HOSTNAME.clickhouse.cloud\n# highlight-next-line\nAddress: 35.85.205.122\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-response"},"After completion of this step:\n[ec2-user@ip-172-31-29-231 ~]$ nslookup HOSTNAME.clickhouse.cloud\nServer:         172.31.0.2\nAddress:        172.31.0.2#53\n\nNon-authoritative answer:\nName:   HOSTNAME.clickhouse.cloud\n# highlight-next-line\nAddress: 172.31.27.78\nName:   HOSTNAME.clickhouse.cloud\n# highlight-next-line\nAddress: 172.31.33.234\nName:   HOSTNAME.clickhouse.cloud\n# highlight-next-line\nAddress: 172.31.8.117\n")),(0,i.kt)("h2",{id:"aws-console"},"AWS Console"),(0,i.kt)("p",null,"Go to ",(0,i.kt)("strong",{parentName:"p"},"VPC Endpoints")," and right click the VPC Endpoint, then click to ",(0,i.kt)("strong",{parentName:"p"},"Modify private DNS name"),":"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Endpoints menu",src:n(32170).Z,width:"366",height:"558"})),(0,i.kt)("p",null,"On the opened page, please enable the checkbox ",(0,i.kt)("strong",{parentName:"p"},"Enable private DNS names")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Modify DNS names",src:n(39938).Z,width:"1622",height:"526"})),(0,i.kt)("h3",{id:"aws-cloudformation-1"},"AWS CloudFormation"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Please update CloudFormation template and set PrivateDnsEnabled to ",(0,i.kt)("inlineCode",{parentName:"li"},"true"),":")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"  PrivateDnsEnabled: true\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Apply the change")),(0,i.kt)("h3",{id:"terraform-1"},"Terraform"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Change the ",(0,i.kt)("inlineCode",{parentName:"li"},"aws_vpc_endpoint")," resource in Terraform code and set ",(0,i.kt)("inlineCode",{parentName:"li"},"private_dns_enabled")," to ",(0,i.kt)("inlineCode",{parentName:"li"},"true"),":")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"  private_dns_enabled = true\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Apply the change")),(0,i.kt)("h2",{id:"verification"},"Verification"),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"IP address ranges may vary."))),(0,i.kt)("div",{className:"admonition admonition-important alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"important")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Please make sure ClickHouse instance FQDN is pointed to the internal IP address of your VPC, otherwise connectivity will be established using the Internet. Please find these IP addresses on \u201cSubnets\u201d tab of VPC Endpoint configuration."))),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Subnets tab",src:n(47785).Z,width:"1999",height:"508"})),(0,i.kt)("p",null,"Verify that instance FQDN is pointed to VPC Endpoint ID IP addresses."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"nslookup HOSTNAME.clickhouse.cloud\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-response"},"Server:         172.31.0.2\nAddress:        172.31.0.2#53\n\nNon-authoritative answer:\nName:   HOSTNAME.clickhouse.cloud\nAddress: 172.31.25.195\nName:   HOSTNAME.clickhouse.cloud\nAddress: 172.31.40.109\nName:   HOSTNAME.clickhouse.cloud\nAddress: 172.31.3.200\n")),(0,i.kt)("h3",{id:"verify-connectivity-to-clickhouse-cloud-service"},"Verify connectivity to ClickHouse Cloud service"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl https://HOSTNAME.clickhouse.cloud:8443\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-response"},"Ok.\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"clickhouse-client --host HOSTNAME.clickhouse.cloud \\\n  --secure --port 9440 \\\n  --password PASSWORD\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-response"},"1\n")))}m.isMDXComponent=!0},33273:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/connection-details-https-6ceceb667ac0b41ab35a2ad390b7e2dc.png"},77778:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/aws-privatelink-endpoint-settings-278b83e6b9b541d35c28b6c87b57b81a.png"},32170:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/aws-privatelink-endpoints-menu-38907f5cf42c36d0433bec237419b4ca.png"},72507:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/aws-privatelink-flow-c83f77b1ce4b03c08421cca9d8f50384.png"},25634:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/aws-privatelink-get-dns-names-9caee0be0ad19f1f8529aabcd1698c7b.png"},39938:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/aws-privatelink-modify-dns-name-00e8ce4b4f6b83fe6ccf808af067ca24.png"},41931:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/aws-privatelink-select-vpc-and-subnets-1c28d24d1bcc2428181498459ca89b2b.png"},47785:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/aws-privatelink-subnets-tab-f99640da8e9bf46930f48eb68059cb97.png"},29194:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/aws-privatelink-vpc-endpoint-id-5876774954b3337c84c8b947ea98bfcf.png"}}]);