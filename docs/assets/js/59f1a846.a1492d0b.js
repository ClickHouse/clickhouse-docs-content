"use strict";(self.webpackChunknew_nav_docusaurus_2_2=self.webpackChunknew_nav_docusaurus_2_2||[]).push([[68572],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>f});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=c(n),u=r,f=d["".concat(l,".").concat(u)]||d[u]||m[u]||o;return n?a.createElement(f,s(s({ref:t},p),{},{components:n})):a.createElement(f,s({ref:t},p))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[d]="string"==typeof e?e:r,s[1]=i;for(var c=2;c<o;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},41079:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const o={title:"Is it possible to delete old records from a ClickHouse table?",description:"The short answer is \u201cyes\u201d. ClickHouse has multiple mechanisms that allow freeing up disk space by removing old data. Each mechanism is aimed for different scenarios."},s="Is It Possible to Delete Old Records from a ClickHouse Table?",i={permalink:"/docs/knowledgebase/delete-old-data",source:"@site/knowledgebase/delete-old-data.md",title:"Is it possible to delete old records from a ClickHouse table?",description:"The short answer is \u201cyes\u201d. ClickHouse has multiple mechanisms that allow freeing up disk space by removing old data. Each mechanism is aimed for different scenarios.",date:"2023-03-21T05:30:49.000Z",formattedDate:"March 21, 2023",tags:[],readingTime:1.845,hasTruncateMarker:!1,authors:[],frontMatter:{title:"Is it possible to delete old records from a ClickHouse table?",description:"The short answer is \u201cyes\u201d. ClickHouse has multiple mechanisms that allow freeing up disk space by removing old data. Each mechanism is aimed for different scenarios."},prevItem:{title:"What does \u201cClickHouse\u201d mean?",permalink:"/docs/knowledgebase/dbms-naming"},nextItem:{title:"DB::Exception: Too many parts (600). Merges are processing significantly slower than inserts",permalink:"/docs/knowledgebase/exception-too-many-parts"}},l={authorsImageUrls:[]},c=[{value:"TTL",id:"ttl",level:2},{value:"DELETE FROM",id:"delete-from",level:2},{value:"ALTER DELETE",id:"alter-delete",level:2},{value:"DROP PARTITION",id:"drop-partition",level:2},{value:"TRUNCATE",id:"truncate",level:2}],p={toc:c},d="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The short answer is \u201cyes\u201d. ClickHouse has multiple mechanisms that allow freeing up disk space by removing old data. Each mechanism is aimed for different scenarios."),(0,r.kt)("h2",{id:"ttl"},"TTL"),(0,r.kt)("p",null,"ClickHouse allows to automatically drop values when some condition happens. This condition is configured as an expression based on any columns, usually just static offset for any timestamp column."),(0,r.kt)("p",null,"The key advantage of this approach is that it does not need any external system to trigger, once TTL is configured, data removal happens automatically in background."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"TTL can also be used to move data not only to ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Null_device"},"/dev/null"),", but also between different storage systems, like from SSD to HDD.")),(0,r.kt)("p",null,"More details on ",(0,r.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree#table_engine-mergetree-ttl"},"configuring TTL"),"."),(0,r.kt)("h2",{id:"delete-from"},"DELETE FROM"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/sql-reference/statements/delete"},"DELETE FROM")," allows standard DELETE queries to be run in ClickHouse. The rows targeted in the filter clause are marked as deleted, and removed from future result sets.  Cleanup of the rows happens asynchronously."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"DELETE FROM is an experimental feature and must be enabled with:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre"},"SET allow_experimental_lightweight_delete = true;\n"))),(0,r.kt)("h2",{id:"alter-delete"},"ALTER DELETE"),(0,r.kt)("p",null,"ALTER DELETE removes rows using asynchronous batch operations. Unlike DELETE FROM, queries run after the ALTER DELETE and before the batch operations complete will include the rows targeted for deletion.  For more details see the ",(0,r.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/sql-reference/statements/alter/delete"},"ALTER DELETE")," docs."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ALTER DELETE")," can be issued to flexibly remove old data. If you need to do it regularly, the main downside will be the need to have an external system to submit the query. There are also some performance considerations since mutations rewrite complete parts even there is only a single row to be deleted."),(0,r.kt)("p",null,"This is the most common approach to make your system based on ClickHouse ",(0,r.kt)("a",{parentName:"p",href:"https://gdpr-info.eu"},"GDPR"),"-compliant."),(0,r.kt)("p",null,"More details on ",(0,r.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/sql-reference/statements/alter/#alter-mutations"},"mutations"),"."),(0,r.kt)("h2",{id:"drop-partition"},"DROP PARTITION"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ALTER TABLE ... DROP PARTITION")," provides a cost-efficient way to drop a whole partition. It\u2019s not that flexible and needs proper partitioning scheme configured on table creation, but still covers most common cases. Like mutations need to be executed from an external system for regular use."),(0,r.kt)("p",null,"More details on ",(0,r.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/sql-reference/statements/alter/partition/#alter_drop-partition"},"manipulating partitions"),"."),(0,r.kt)("h2",{id:"truncate"},"TRUNCATE"),(0,r.kt)("p",null,"It\u2019s rather radical to drop all data from a table, but in some cases it might be exactly what you need."),(0,r.kt)("p",null,"More details on ",(0,r.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/sql-reference/statements/truncate"},"table truncation"),"."))}m.isMDXComponent=!0}}]);