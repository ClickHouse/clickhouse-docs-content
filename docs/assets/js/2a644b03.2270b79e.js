"use strict";(self.webpackChunkclickhouse=self.webpackChunkclickhouse||[]).push([[22761],{3905:function(e,t,a){a.d(t,{Zo:function(){return m},kt:function(){return d}});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},m=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),u=p(a),d=r,k=u["".concat(s,".").concat(d)]||u[d]||c[d]||l;return a?n.createElement(k,i(i({ref:t},m),{},{components:a})):n.createElement(k,i({ref:t},m))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=u;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var p=2;p<l;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},40505:function(e,t,a){a.r(t),a.d(t,{assets:function(){return m},contentTitle:function(){return s},default:function(){return d},frontMatter:function(){return o},metadata:function(){return p},toc:function(){return c}});var n=a(87462),r=a(63366),l=(a(67294),a(3905)),i=["components"],o={sidebar_label:"Nodejs",sidebar_position:1,keywords:["clickhouse","nodejs","client","connect","integrate"],slug:"/en/integrations/language-clients/nodejs",description:"The official Node.js client for connecting to ClickHouse."},s="ClickHouse JS",p={unversionedId:"en/integrations/language-clients/nodejs",id:"en/integrations/language-clients/nodejs",title:"ClickHouse JS",description:"The official Node.js client for connecting to ClickHouse.",source:"@site/docs/en/integrations/language-clients/nodejs.md",sourceDirName:"en/integrations/language-clients",slug:"/en/integrations/language-clients/nodejs",permalink:"/docs/en/integrations/language-clients/nodejs",draft:!1,editUrl:"https://github.com/ClickHouse/clickhouse-docs/blob/main/docs/en/integrations/language-clients/nodejs.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_label:"Nodejs",sidebar_position:1,keywords:["clickhouse","nodejs","client","connect","integrate"],slug:"/en/integrations/language-clients/nodejs",description:"The official Node.js client for connecting to ClickHouse."},sidebar:"english",previous:{title:"Language Clients",permalink:"/docs/en/integrations/language-clients"},next:{title:"Java",permalink:"/docs/en/integrations/language-clients/java/"}},m={},c=[{value:"Environment requirements",id:"environment-requirements",level:2},{value:"Installation",id:"installation",level:2},{value:"Support policy",id:"support-policy",level:2},{value:"Compatibility with ClickHouse",id:"compatibility-with-clickhouse",level:2},{value:"ClickHouse Client API",id:"clickhouse-client-api",level:2},{value:"Creating a client instance",id:"creating-a-client-instance",level:4},{value:"Configuration",id:"configuration",level:4},{value:"Connecting",id:"connecting",level:3},{value:"Connection pool",id:"connection-pool",level:4},{value:"Execution",id:"execution",level:3},{value:"Insert",id:"insert",level:3},{value:"Query",id:"query",level:3},{value:"Rows response abstraction",id:"rows-response-abstraction",level:4},{value:"Ping",id:"ping",level:3},{value:"Close",id:"close",level:3},{value:"Supported Data formats",id:"supported-data-formats",level:2},{value:"Supported ClickHouse data types",id:"supported-clickhouse-data-types",level:2},{value:"Date<em> / DateTime</em> types caveats",id:"date--datetime-types-caveats",level:3},{value:"Decimal* types caveats",id:"decimal-types-caveats",level:3},{value:"Integral types: Int64, Int128, Int256, UInt64, UInt128, UInt256",id:"integral-types-int64-int128-int256-uint64-uint128-uint256",level:3},{value:"ClickHouse settings",id:"clickhouse-settings",level:2},{value:"Advanced topics",id:"advanced-topics",level:2},{value:"Queries with parameters",id:"queries-with-parameters",level:3},{value:"Compression",id:"compression",level:3},{value:"Logging",id:"logging",level:3},{value:"Known limitations",id:"known-limitations",level:2},{value:"Tips for performance optimizations",id:"tips-for-performance-optimizations",level:2}],u={toc:c};function d(e){var t=e.components,a=(0,r.Z)(e,i);return(0,l.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"clickhouse-js"},"ClickHouse JS"),(0,l.kt)("p",null,"The official Node.js client for connecting to ClickHouse.\nThe client is written in TypeScript and provides typings for the client public API."),(0,l.kt)("h2",{id:"environment-requirements"},"Environment requirements"),(0,l.kt)("p",null,"The nodejs must be available in the environment to run the client.\nThe client is compatible with all the ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/nodejs/release#readme"},"maintained")," nodejs LTS versions: ",(0,l.kt)("inlineCode",{parentName:"p"},"v14.x")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"v16.x"),"."),(0,l.kt)("p",null,"As soon as a nodejs version approaches End-Of-Life, the client drops support for the outdated insecure nodejs version."),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"Note"),": The Browser environment is not officially supported at the moment."),(0,l.kt)("h2",{id:"installation"},"Installation"),(0,l.kt)("p",null,"To install the latest available client version, run:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"npm i @clickhouse/client\n")),(0,l.kt)("h2",{id:"support-policy"},"Support policy"),(0,l.kt)("p",null,"Clients provide forward compatibility with all the ClickHouse versions released in the following ",(0,l.kt)("strong",{parentName:"p"},"2 years")," from the client release date.\nThe clients also provide backward compatibility with all the ClickHouse versions supported when a client was released, which maps to 3 latest ",(0,l.kt)("inlineCode",{parentName:"p"},"stable")," and max 2 ",(0,l.kt)("inlineCode",{parentName:"p"},"lts")," releases."),(0,l.kt)("h2",{id:"compatibility-with-clickhouse"},"Compatibility with ClickHouse"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Client version"),(0,l.kt)("th",{parentName:"tr",align:null},"ClickHouse"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"0.0.1 - 0.0.4"),(0,l.kt)("td",{parentName:"tr",align:null},"22.8, 22.9")))),(0,l.kt)("h2",{id:"clickhouse-client-api"},"ClickHouse Client API"),(0,l.kt)("h4",{id:"creating-a-client-instance"},"Creating a client instance"),(0,l.kt)("p",null,"You can instantiate as many client instances as necessary with ",(0,l.kt)("inlineCode",{parentName:"p"},"createClient")," factory."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"import { createClient } from '@clickhouse/client'\nconst client = createClient(/* configuration */);\n")),(0,l.kt)("p",null,"A client instance can be ",(0,l.kt)("a",{parentName:"p",href:"#configuration"},"pre-configured")," during instantiation."),(0,l.kt)("h4",{id:"configuration"},"Configuration"),(0,l.kt)("p",null,"When creating a client instance, the following connection settings can be adjusted:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"host?: string")," - a ClickHouse instance URL. Default value: ",(0,l.kt)("inlineCode",{parentName:"p"},"http://localhost:8123"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"connect_timeout?: number")," - the timeout to setup a connection in milliseconds. Default value: ",(0,l.kt)("inlineCode",{parentName:"p"},"10_000"),".")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"request_timeout?: number")," - the request timeout in milliseconds. Default value: ",(0,l.kt)("inlineCode",{parentName:"p"},"30_000"),".")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"max_open_connections?: number")," - maximum number of sockets to allow per host. Default value: ",(0,l.kt)("inlineCode",{parentName:"p"},"Infinity"),".")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"compression?: { response?: boolean; request?: boolean }")," - enable compression. ",(0,l.kt)("a",{parentName:"p",href:"#compression"},"Compression docs"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"username?: string")," - The name of the user on whose behalf requests are made. Default value: ",(0,l.kt)("inlineCode",{parentName:"p"},"default"),".")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"password?: string")," - The user password. Default: ",(0,l.kt)("inlineCode",{parentName:"p"},"''"),".")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"application?: string")," - The name of the application using the nodejs client. Default value: ",(0,l.kt)("inlineCode",{parentName:"p"},"clickhouse-js"),".")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"database?: string")," - Database name to use. Default value: ",(0,l.kt)("inlineCode",{parentName:"p"},"default"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"clickhouse_settings?: ClickHouseSettings")," - ClickHouse settings to apply to all requests. Default value: ",(0,l.kt)("inlineCode",{parentName:"p"},"{}"),".")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("strong",{parentName:"p"},"log?: Log")," - configure logging. ",(0,l.kt)("a",{parentName:"p",href:"#logging"},"Logging docs")))),(0,l.kt)("h3",{id:"connecting"},"Connecting"),(0,l.kt)("p",null,"The client implements a connection via HTTP(s) protocol.\nThe ClickHouse binary protocol is not supported yet."),(0,l.kt)("p",null,"The following example demonstrates how to set up a connection against ClickHouse Cloud. It assumes ",(0,l.kt)("inlineCode",{parentName:"p"},"host")," (including protocol and port) and ",(0,l.kt)("inlineCode",{parentName:"p"},"password")," values are specified via environment variables, and ",(0,l.kt)("inlineCode",{parentName:"p"},"default")," user is used."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Example")," Client instance creation. ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/clickhouse-js/blob/main/examples/ping_cloud.ts"},"Source code"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"import { createClient } from '@clickhouse/client'\nconst client = createClient({\n  host: process.env.CLICKHOUSE_HOST ?? 'https://localhost:8443',\n  user: process.env.CLICKHOUSE_USER ?? 'default'\n  password: process.env.CLICKHOUSE_PASSWORD ?? '',\n})\n")),(0,l.kt)("h4",{id:"connection-pool"},"Connection pool"),(0,l.kt)("p",null,"To avoid the overhead of establishing a connection on every request, the client creates a pool of connections to ClickHouse to reuse. By default, the size of connection pool is not limited, but you can change it with ",(0,l.kt)("inlineCode",{parentName:"p"},"max_open_connections")," ",(0,l.kt)("a",{parentName:"p",href:"#configuration"},"configuration option"),".\nThere is no guarantee the same connection in a pool will be used for subsequent queries unless the user sets ",(0,l.kt)("inlineCode",{parentName:"p"},"max_open_connections: 1"),". This is rarely needed but may be required for cases where users are using temporary tables."),(0,l.kt)("h3",{id:"execution"},"Execution"),(0,l.kt)("p",null,"It can be used for statements that do not have any output, when the format clause is not applicable, or when you are not interested in the response at all. An example of such a statement can be ",(0,l.kt)("inlineCode",{parentName:"p"},"CREATE TABLE")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"ALTER TABLE"),"."),(0,l.kt)("p",null,"Should be awaited."),(0,l.kt)("p",null,"Optionally, it returns a readable stream that can be consumed on the application side if you need it for some reason. But in that case, you might consider using ",(0,l.kt)("a",{parentName:"p",href:"#query"},"query")," instead."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"interface ExecParams {\n  // Statement to execute.\n  query: string\n  // ClickHouse settings that can be applied on query level\n  clickhouse_settings?: ClickHouseSettings\n  // Parameters for query binding.\n  query_params?: Record<string, unknown>\n  // AbortSignal instance to cancel a request in progress.\n  abort_signal?: AbortSignal\n}\n\nclass ClickHouseClient {\n  exec(params: ExecParams): Promise<Stream.Readable> {}\n}\n")),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"A request cancelled with ",(0,l.kt)("inlineCode",{parentName:"p"},"abort_signal")," does not guarantee that DDL wasn't executed by server."))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Example")," Create a table in ClickHouse Cloud. ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/clickhouse-js/blob/main/examples/create_table_cloud.ts"},"Source code"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"await client.exec({\n  query: `\n    CREATE TABLE IF NOT EXISTS my_cloud_table\n    (id UInt64, name String)\n    ORDER BY (id)\n  `,\n  // Recommended for cluster usage to avoid situations\n  // where a query processing error occurred after the response code\n  // and HTTP headers were sent to the client.\n  // See https://clickhouse.com/docs/en/interfaces/http/#response-buffering\n  clickhouse_settings: {\n    wait_end_of_query: 1,\n  },\n})\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Example")," Create a table in a self-hosted ClickHouse instance. ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/clickhouse-js/blob/main/examples/create_table_single_node.ts"},"Source code"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"await client.exec({\n  query: `\n    CREATE TABLE IF NOT EXISTS my_table\n    (id UInt64, name String)\n    ENGINE MergeTree()\n    ORDER BY (id)\n  `,\n})\n")),(0,l.kt)("h3",{id:"insert"},"Insert"),(0,l.kt)("p",null,"The primary method for data insertion. It can work with both ",(0,l.kt)("inlineCode",{parentName:"p"},"Stream.Readable")," (all formats except ",(0,l.kt)("inlineCode",{parentName:"p"},"JSON"),") and plain ",(0,l.kt)("inlineCode",{parentName:"p"},"Array<T>")," (",(0,l.kt)("inlineCode",{parentName:"p"},"JSON*")," family formats only). It is recommended to avoid arrays in case of large inserts to reduce application memory consumption and consider streaming for most of the use cases."),(0,l.kt)("p",null,"Should be awaited, but it does not return anything."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"interface InsertParams<T> {\n  // Table name to insert the data into\n  table: string\n  // A dataset to insert. Stream will work for all formats except JSON.\n  values: ReadonlyArray<T> | Stream.Readable\n  // Format of the dataset to insert.\n  format?: DataFormat\n  // ClickHouse settings that can be applied on statement level.\n  clickhouse_settings?: ClickHouseSettings\n  // Parameters for query binding.\n  query_params?: Record<string, unknown>\n  // AbortSignal instance to cancel an insert in progress.\n  abort_signal?: AbortSignal\n}\n\nclass ClickHouseClient {\n  insert(params: InsertParams): Promise<void> {}\n}\n")),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"A request canceled with ",(0,l.kt)("inlineCode",{parentName:"p"},"abort_signal")," does not guarantee that data insertion did not take place."))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Example")," Insert an array of values. ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/clickhouse-js/blob/main/examples/array_json_each_row.ts"},"Source code"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"await client.insert({\n  table: 'my_table,\n  // structure should match the desired format, JSONEachRow in this example\n  values: [\n    { id: 42, name: 'foo' },\n    { id: 42, name: 'bar' },\n  ],\n  format: 'JSONEachRow',\n})\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Example")," Insert a stream of objects. ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/clickhouse-js/blob/main/examples/insert_json_stream.ts"},"Source code"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const stream = new Stream.Readable({ objectMode: true, ... });\nstream.push({ id: '42' })\nsetTimeout(function closeStream() { stream.push(null) }, 100)\nawait client.insert({\n  table: 'my_table',\n  values: stream,\n  format: 'JSONCompactEachRow',\n})\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Example")," Insert a stream of strings in CSV format from a CSV file. ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/clickhouse-js/blob/main/examples/insert_file_stream_csv.ts"},"Source code"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"await client.insert({\n  table: 'my_table',\n  values: fs.createReadStream('./path/to/a/file.csv'),\n  format: 'CSV',\n})\n")),(0,l.kt)("h3",{id:"query"},"Query"),(0,l.kt)("p",null,"Used for most statements that can have a response, such as ",(0,l.kt)("inlineCode",{parentName:"p"},"SELECT"),", or for sending DDLs such as ",(0,l.kt)("inlineCode",{parentName:"p"},"CREATE TABLE"),".\nPlease consider using the dedicated method ",(0,l.kt)("a",{parentName:"p",href:"#insert"},"insert")," for data insertion."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"interface QueryParams {\n  // Query to execute that might return some data.\n  query: string\n  // Format of the resulting dataset.\n  format?: DataFormat\n  // ClickHouse settings that can be applied on query level.\n  clickhouse_settings?: ClickHouseSettings\n  // Parameters for query binding.\n  query_params?: Record<string, unknown>\n  // AbortSignal instance to cancel a query in progress.\n  abort_signal?: AbortSignal\n}\n\nclass ClickHouseClient {\n  query(params: QueryParams): Promise<Rows> {}\n}\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Do not specify the FORMAT clause in ",(0,l.kt)("inlineCode",{parentName:"p"},"query"),", use ",(0,l.kt)("inlineCode",{parentName:"p"},"format")," parameter instead."))),(0,l.kt)("h4",{id:"rows-response-abstraction"},"Rows response abstraction"),(0,l.kt)("p",null,"Provides several convenience methods for data processing in your application."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"class Rows {\n  // Consume the entire stream and get the contents as a string\n  // Can be used with any DataFormat\n  // Should be called only once\n  text(): Promise<string> {}\n  // Consume the entire stream and get the contents as a JS object\n  // Can be used only with JSON formats\n  // Should be called only once\n  json<T>(): Promise<T> {}\n  // Returns a readable stream of Row instances for responses that can be streamed (i.e. all except JSON)\n  // Should be called only once\n  // NB: if called for the second time, the second stream will be just empty\n  stream(): Stream.Readable {}\n}\n\nclass Row {\n  // Get the content of the row as a plain string\n  text(): string {}\n  // Get the content of the row as a JS object\n  json<T>(): T {}\n}\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Example")," A query with a resulting dataset as ",(0,l.kt)("inlineCode",{parentName:"p"},"json")," in ",(0,l.kt)("inlineCode",{parentName:"p"},"JSONEachRow")," format. ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/clickhouse-js/blob/main/examples/array_json_each_row.ts"},"Source code"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const rows = await client.query({\n  query: 'SELECT * FROM my_table',\n  format: 'JSONEachRow',\n})\nconst dataset = await rows.json()\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Example")," A query with a resulting dataset as a stream of objects in ",(0,l.kt)("inlineCode",{parentName:"p"},"JSONEachRow")," format. ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/clickhouse-js/blob/main/examples/select_streaming.ts"},"Source code"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const rows = await client.query({\n  query: 'SELECT number FROM system.numbers LIMIT 10',\n  format: 'JSONEachRow',\n})\nfor await (const row of rows.stream()) {\n  console.log(row.json())\n}\n")),(0,l.kt)("h3",{id:"ping"},"Ping"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"ping")," method provided to check the connectivity stasus returns ",(0,l.kt)("inlineCode",{parentName:"p"},"true")," if the server can be reached. It can throw a standard Node.js Error such as ",(0,l.kt)("inlineCode",{parentName:"p"},"ECONNREFUSED"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"class ClickHouseClient {\n  ping(): Promise<boolean> {}\n}\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Example")," Ping a ClickHouse server instance. ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/clickhouse-js/blob/main/examples/ping_cloud.ts"},"Source code"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const isAlive = await client.ping();\n")),(0,l.kt)("h3",{id:"close"},"Close"),(0,l.kt)("p",null,"Closes all the open connections and releases resources."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"await client.close()\n")),(0,l.kt)("h2",{id:"supported-data-formats"},"Supported Data formats"),(0,l.kt)("p",null,"The client handles data formats as JSON or text."),(0,l.kt)("p",null,"If you specify ",(0,l.kt)("inlineCode",{parentName:"p"},"format")," as one of the JSON-family (",(0,l.kt)("inlineCode",{parentName:"p"},"JSONEachRow"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"JSONCompactEachRow"),", etc.), the client will serialize and deserialize data during the communication over the wire."),(0,l.kt)("p",null,"Data provided in the text formats (",(0,l.kt)("inlineCode",{parentName:"p"},"CSV"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"TabSeparated")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"CustomSeparated")," families) are sent over the wire without additional transformations."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Format"),(0,l.kt)("th",{parentName:"tr",align:null},"Input (array)"),(0,l.kt)("th",{parentName:"tr",align:null},"Input (stream)"),(0,l.kt)("th",{parentName:"tr",align:null},"Output (JSON)"),(0,l.kt)("th",{parentName:"tr",align:null},"Output (text)"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#json"},"JSON")),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#jsoneachrow"},"JSONEachRow")),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f  \u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#jsonstringseachrow"},"JSONStringsEachRow")),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#jsoncompacteachrow"},"JSONCompactEachRow")),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#jsoncompactstringseachrow"},"JSONCompactStringsEachRow")),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#jsoncompacteachrowwithnames"},"JSONCompactEachRowWithNames")),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#jsoncompacteachrowwithnamesandtypes"},"JSONCompactEachRowWithNamesAndTypes")),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#jsoncompactstringseachrowwithnames"},"JSONCompactStringsEachRowWithNames")),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#jsoncompactstringseachrowwithnamesandtypes"},"JSONCompactStringsEachRowWithNamesAndTypes")),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#csv"},"CSV")),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#csvwithnames"},"CSVWithNames")),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#csvwithnamesandtypes"},"CSVWithNamesAndTypes")),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#tabseparated"},"TabSeparated")),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#tabseparatedraw"},"TabSeparatedRaw")),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#tabseparatedwithnames"},"TabSeparatedWithNames")),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#tabseparatedwithnamesandtypes"},"TabSeparatedWithNamesAndTypes")),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#format-customseparated"},"CustomSeparated")),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#customseparatedwithnames"},"CustomSeparatedWithNames")),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://clickhouse.com/docs/en/interfaces/formats/#customseparatedwithnamesandtypes"},"CustomSeparatedWithNamesAndTypes")),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f")))),(0,l.kt)("p",null,"The entire list of ClickHouse input and output formats is available ",(0,l.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/interfaces/formats"},"here"),"."),(0,l.kt)("h2",{id:"supported-clickhouse-data-types"},"Supported ClickHouse data types"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Status"),(0,l.kt)("th",{parentName:"tr",align:null},"JS type"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"UInt8/16/32"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"number")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"UInt64/128/256"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f\u2757- see below"),(0,l.kt)("td",{parentName:"tr",align:null},"string")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Int8/16/32"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"number")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Int64/128/256"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f\u2757- see below"),(0,l.kt)("td",{parentName:"tr",align:null},"string")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Float32/64"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"number")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Decimal"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f\u2757- see below"),(0,l.kt)("td",{parentName:"tr",align:null},"number")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Boolean"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"boolean")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"String"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"string")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"FixedString"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"string")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"UUID"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"string")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Date32/64"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f\u2757- see below"),(0,l.kt)("td",{parentName:"tr",align:null},"string")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"DateTime32/64"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f\u2757- see below"),(0,l.kt)("td",{parentName:"tr",align:null},"string")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Enum"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"string")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"LowCardinality"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"string")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Array(T)"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"T[]")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"JSON"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"object")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Nested"),(0,l.kt)("td",{parentName:"tr",align:null},"\u274c"),(0,l.kt)("td",{parentName:"tr",align:null},"-")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Tuple"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"Tuple")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Nullable(T)"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"JS type for T or null")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"IPv4"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"string")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"IPv6"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"string")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Point"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"[ number, number ]")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Ring"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"Array\\<Point",">")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Polygon"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"Array\\<Ring",">")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"MultiPolygon"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"Array\\<Polygon",">")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Map(K, V)"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2714\ufe0f"),(0,l.kt)("td",{parentName:"tr",align:null},"Record\\<K, V",">")))),(0,l.kt)("p",null,"The entire list of supported ClickHouse formats is available ",(0,l.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/sql-reference/data-types/"},"here"),"."),(0,l.kt)("h3",{id:"date--datetime-types-caveats"},"Date",(0,l.kt)("em",{parentName:"h3"}," / DateTime")," types caveats"),(0,l.kt)("p",null,"Since the client inserts values without additional type conversion, ",(0,l.kt)("inlineCode",{parentName:"p"},"Date\\*")," type columns can only be inserted as strings and not as Unix time epochs. It might be changed with the future ClickHouse database releases."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Example")," Insert a ",(0,l.kt)("inlineCode",{parentName:"p"},"Date")," type value. ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/clickhouse-js/blob/ba387d7f4ce375a60982ac2d99cb47391cf76cec/__tests__/integration/date_time.test.ts"},"Source code"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"await client.insert({\n  'my_table',\n  values: [{ date: '2022-09-05' }],\n  format: 'JSONEachRow',\n})\n")),(0,l.kt)("h3",{id:"decimal-types-caveats"},"Decimal","*"," types caveats"),(0,l.kt)("p",null,"Since the client performs no additional type conversion, it is not possible to insert ",(0,l.kt)("inlineCode",{parentName:"p"},"Decimal*")," type columns as strings, only as numbers. This is a suboptimal approach as it might end in float precision loss. Thus, it is recommended to avoid ",(0,l.kt)("inlineCode",{parentName:"p"},"JSON*")," formats when using ",(0,l.kt)("inlineCode",{parentName:"p"},"Decimals")," as of now. Consider ",(0,l.kt)("inlineCode",{parentName:"p"},"TabSeparated*"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"CSV*")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"CustomSeparated*")," formats families for that kind of workflows."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Example")," Insert a ",(0,l.kt)("inlineCode",{parentName:"p"},"Decimal")," type value. ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/clickhouse-js/blob/c1b70c82f525c39edb3ca1ee05cb5e6b43dba5b3/__tests__/integration/data_types.test.ts#L98-L131"},"Source code"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"await client.insert({\n  'my_table',\n  values: [{ decimal: '1234567891234567891234567891.1234567891' }],\n  format: 'JSONEachRow',\n})\n")),(0,l.kt)("h3",{id:"integral-types-int64-int128-int256-uint64-uint128-uint256"},"Integral types: Int64, Int128, Int256, UInt64, UInt128, UInt256"),(0,l.kt)("p",null,"Though the server can accept it as a number, it is returned as a string in ",(0,l.kt)("inlineCode",{parentName:"p"},"JSON*")," family output formats to avoid integer overflow as max values for these types are bigger than ",(0,l.kt)("inlineCode",{parentName:"p"},"Number.MAX_SAFE_INTEGER"),"."),(0,l.kt)("p",null,"This behavior, however, can be modified with ",(0,l.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/operations/settings/settings/#output_format_json_quote_64bit_integers"},(0,l.kt)("inlineCode",{parentName:"a"},"output_format_json_quote_64bit_integers")," setting"),"."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Example")," Adjust the JSON output format for 64bit numbers."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const rows = await client.query({\n  query: 'SELECT * from system.numbers LIMIT 1',\n  format: 'JSONEachRow',\n})\n\nawait rows.json() === [{ number: '0' }]\n\nconst rows = await client.query({\n  query: 'SELECT * from system.numbers LIMIT 1',\n  format: 'JSONEachRow',\n  clickhouse_settings: { output_format_json_quote_64bit_integers: 0 },\n})\n\nawait rows.json() === [{ number: 0 }]\n")),(0,l.kt)("h2",{id:"clickhouse-settings"},"ClickHouse settings"),(0,l.kt)("p",null,"The client can adjust ClickHouse behavior via ",(0,l.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/operations/settings/settings/"},"settings")," mechanism.\nThe settings can be set on the client instance level so that they will be applied to every request sent to the ClickHouse:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const client = createClient({...\n  clickhouse_settings: { ... }\n})\n")),(0,l.kt)("p",null,"Or a setting can be configured on a request-level:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"client.query({ ...\n  clickhouse_settings: { ... }\n})\n")),(0,l.kt)("p",null,"A type declaration file with all the supported ClickHouse settings can be found ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/clickhouse-js/blob/730b1b2516e2d47dc9a32b1d8d0b8ba8ceb95ead/src/settings.ts"},"here"),"."),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Make sure that the user on whose behalf the queries are made has sufficient rights to change the settings."))),(0,l.kt)("h2",{id:"advanced-topics"},"Advanced topics"),(0,l.kt)("h3",{id:"queries-with-parameters"},"Queries with parameters"),(0,l.kt)("p",null,"You can create a query with parameters and pass values to them from client application. This allows to avoid formatting query with specific dynamic values on client side."),(0,l.kt)("p",null,"Format a query as usual, then place the values that you want to pass from the app parameters to the query in braces in the following format:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"{<name>:<data type>}\n")),(0,l.kt)("p",null,"where:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"name")," \u2014 Placeholder identifier."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"data type")," -  ",(0,l.kt)("a",{parentName:"li",href:"https://clickhouse.com/docs/en/sql-reference/data-types/"},"Data type")," of the app parameter value.")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Example"),": Query with parameters. ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/clickhouse-js/blob/main/examples/query_with_parameter_binding.ts"},"Source code"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"await client.query({\n  query: 'SELECT plus({val1: Int32}, {val2: Int32})',\n  format: 'CSV',\n  query_params: {\n    val1: 10,\n    val2: 20,\n  },\n})\n")),(0,l.kt)("p",null,"Check ",(0,l.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/interfaces/cli#cli-queries-with-parameters-syntax"},"https://clickhouse.com/docs/en/interfaces/cli#cli-queries-with-parameters-syntax")," for additional details."),(0,l.kt)("h3",{id:"compression"},"Compression"),(0,l.kt)("p",null,"Data applications operating with large datasets over the wire can benefit from enabling compression."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"createClient({\n  compression: {\n    response: true,\n    request: true\n  }\n})\n")),(0,l.kt)("p",null,"Configurations parameters are:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"response: true")," instructs ClickHouse server to respond with compressed response body. Default value: ",(0,l.kt)("inlineCode",{parentName:"li"},"response: true"),". "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"request: true")," enables compression on the client request body. Default value: ",(0,l.kt)("inlineCode",{parentName:"li"},"request: false"))),(0,l.kt)("h3",{id:"logging"},"Logging"),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"The logging is an experimental feature and is subject to change in the future."))),(0,l.kt)("p",null,"You can enable logging for debugging purposes by setting in the client configuration:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"createClient({...\n  log: { enable: true }\n")),(0,l.kt)("p",null,"The default logger implementation emits log records into ",(0,l.kt)("inlineCode",{parentName:"p"},"stdout"),".\nYou can customize the logging logic via providing a ",(0,l.kt)("inlineCode",{parentName:"p"},"LoggerClass"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"import type { Logger } from '@clickhouse/client'\nclass FileLogger implements Logger {...}\ncreateClient({...\n  LoggerClass: FileLogger\n")),(0,l.kt)("p",null,"Check an example implementation ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/clickhouse-js/blob/1977fa466201929a2736bd8ebc442731e0f00d12/__tests__/integration/config.test.ts#L121"},"here"),"."),(0,l.kt)("h2",{id:"known-limitations"},"Known limitations"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Browser environment is not supported."),(0,l.kt)("li",{parentName:"ul"},"There are no data mappers for the result sets, so only language primitives are used."),(0,l.kt)("li",{parentName:"ul"},"There are some ",(0,l.kt)("a",{parentName:"li",href:"#date--datetime-types-caveats"},"Decimal",(0,l.kt)("em",{parentName:"a"}," and Date")," / DateTime","*"," data types caveats"),"."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"/docs/en/sql-reference/data-types/nested-data-structures/nested"},"Nested")," data type is currently not officially supported.")),(0,l.kt)("h2",{id:"tips-for-performance-optimizations"},"Tips for performance optimizations"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"To reduce application memory consumption, consider using streams for large inserts when applicable."),(0,l.kt)("li",{parentName:"ul"},"Node.js HTTP(s) Agent has ",(0,l.kt)("a",{parentName:"li",href:"https://nodejs.org/api/http.html#agentmaxsockets"},"infinite max open sockets")," by default. In some cases, you might want to limit that by using ",(0,l.kt)("inlineCode",{parentName:"li"},"ClickHouseClientConfigOptions.max_open_connections")," setting."),(0,l.kt)("li",{parentName:"ul"},"The client enable compression for ",(0,l.kt)("inlineCode",{parentName:"li"},"query")," responses by default, but ",(0,l.kt)("inlineCode",{parentName:"li"},"insert")," compression is disabled. When using large inserts, you might want to enable request compression as well. You can use ",(0,l.kt)("inlineCode",{parentName:"li"},"ClickHouseClientConfigOptions.compression.request")," for that.")))}d.isMDXComponent=!0}}]);