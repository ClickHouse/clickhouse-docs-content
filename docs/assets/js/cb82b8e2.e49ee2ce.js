"use strict";(self.webpackChunknew_nav_docusaurus_2_2=self.webpackChunknew_nav_docusaurus_2_2||[]).push([[83050],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>E});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=a.createContext({}),c=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(i.Provider,{value:t},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=c(n),h=o,E=u["".concat(i,".").concat(h)]||u[h]||p[h]||r;return n?a.createElement(E,l(l({ref:t},d),{},{components:n})):a.createElement(E,l({ref:t},d))}));function E(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,l=new Array(r);l[0]=h;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[u]="string"==typeof e?e:o,l[1]=s;for(var c=2;c<r;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},98710:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var a=n(87462),o=(n(67294),n(3905));const r={},l="Converting Files from Parquet to CSV or JSON",s={permalink:"/docs/knowledgebase/parquet-to-csv-json",source:"@site/knowledgebase/parquet-to-csv-json.md",title:"Converting Files from Parquet to CSV or JSON",description:"You can use clickhouse-local to convert files between any of the input and output formats that ClickHouse supports (which is over 70 different formats!). In this article, we are convert a Parquet file in S3 into a CSV and JSON file.",date:"2023-03-21T20:59:31.000Z",formattedDate:"March 21, 2023",tags:[],readingTime:2.765,hasTruncateMarker:!1,authors:[],frontMatter:{},prevItem:{title:"What if I have a problem with encodings when using Oracle via ODBC?",permalink:"/docs/knowledgebase/oracle-odbc"},nextItem:{title:"Export PostgreSQL data to Parquet, CSV or JSON",permalink:"/docs/knowledgebase/postgresql-to-parquet-csv-json"}},i={authorsImageUrls:[]},c=[{value:"Accessing the data using a table function",id:"accessing-the-data-using-a-table-function",level:2},{value:"Convert the Parquet file to a CSV",id:"convert-the-parquet-file-to-a-csv",level:2},{value:"Convert the Parquet file to a JSON",id:"convert-the-parquet-file-to-a-json",level:2},{value:"Convert CSV to Parquet",id:"convert-csv-to-parquet",level:2}],d={toc:c},u="wrapper";function p(e){let{components:t,...n}=e;return(0,o.kt)(u,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"You can use ",(0,o.kt)("inlineCode",{parentName:"p"},"clickhouse-local")," to convert files between any of the ",(0,o.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/interfaces/formats"},"input and output formats")," that ClickHouse supports (which is over 70 different formats!). In this article, we are convert a Parquet file in S3 into a CSV and JSON file."),(0,o.kt)("p",null,"Let's start at the beginning. ClickHouse has a collection of ",(0,o.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/sql-reference/table-functions/"},"table functions")," that read from files, databases and other resoures and converts the data to a table. To demonstrate, suppose we have a Parquet file in S3. We will use the ",(0,o.kt)("inlineCode",{parentName:"p"},"s3")," table function to read it (ClickHouse knows it's a Parquet file based on the filename)."),(0,o.kt)("p",null,"But first, let's download the ",(0,o.kt)("inlineCode",{parentName:"p"},"clickhouse")," binary:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"curl https://clickhouse.com/ | sh\n")),(0,o.kt)("h2",{id:"accessing-the-data-using-a-table-function"},"Accessing the data using a table function"),(0,o.kt)("p",null,"Let's verify we can read the file by using ",(0,o.kt)("inlineCode",{parentName:"p"},"DESCRIBE")," on the resulting table that the ",(0,o.kt)("inlineCode",{parentName:"p"},"s3")," table function creates:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./clickhouse local -q \"DESCRIBE s3('https://datasets-documentation.s3.eu-west-3.amazonaws.com/house_parquet/house_0.parquet')\"\n")),(0,o.kt)("p",null,"This particular file contains home prices of properties sold in the United Kingdom. The response looks like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-response"},"price   Nullable(Int64)\ndate    Nullable(UInt16)\npostcode1   Nullable(String)\npostcode2   Nullable(String)\ntype    Nullable(String)\nis_new  Nullable(UInt8)\nduration    Nullable(String)\naddr1   Nullable(String)\naddr2   Nullable(String)\nstreet  Nullable(String)\nlocality    Nullable(String)\ntown    Nullable(String)\ndistrict    Nullable(String)\ncounty  Nullable(String)\n")),(0,o.kt)("p",null,"You can run any query you want on the data. For example, let's see which towns have the highest average price of homes:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./clickhouse local -q \"SELECT\n   town,\n   avg(price) AS avg_price\nFROM s3('https://datasets-documentation.s3.eu-west-3.amazonaws.com/house_parquet/house_0.parquet')\nGROUP BY town\nORDER BY avg_price DESC\nLIMIT 10\"\n")),(0,o.kt)("p",null,"The response looks like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"GATWICK 16818750\nCHALFONT ST GILES   938090.0985915493\nVIRGINIA WATER  789301.1320224719\nCOBHAM  699874.7111622555\nBEACONSFIELD    677247.5483146068\nESHER   616004.6888297872\nKESTON  607585.8597560975\nGERRARDS CROSS  566330.2959086584\nASCOT   551491.2975753123\nWEYBRIDGE   548974.828692494\n")),(0,o.kt)("h2",{id:"convert-the-parquet-file-to-a-csv"},"Convert the Parquet file to a CSV"),(0,o.kt)("p",null,"You can send the result of any SQL query to a file. Let's grab all the columns from our Parquet file in S3 and send the output to a new CSV file. Because the output file ends in ",(0,o.kt)("inlineCode",{parentName:"p"},".csv"),", ClickHouse knows to use the ",(0,o.kt)("inlineCode",{parentName:"p"},"CSV")," output format:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./clickhouse local -q \"SELECT *\nFROM s3('https://datasets-documentation.s3.eu-west-3.amazonaws.com/house_parquet/house_0.parquet')\nINTO OUTFILE 'house_prices.csv'\"\n")),(0,o.kt)("p",null,"Let's verify it worked:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-response"},'$ tail house_prices.csv\n70000,10508,"YO8","9XN","detached",0,"freehold","7","","POPPY CLOSE","SELBY","SELBY","SELBY","NORTH YORKSHIRE"\n130000,14274,"YO8","9XP","detached",0,"freehold","10","","HEATHER CLOSE","","SELBY","SELBY","NORTH YORKSHIRE"\n150000,18180,"YO8","9XP","detached",0,"freehold","11","","HEATHER CLOSE","","SELBY","SELBY","NORTH YORKSHIRE"\n157000,18088,"YO8","9XP","detached",0,"freehold","12","","HEATHER CLOSE","","SELBY","SELBY","NORTH YORKSHIRE"\n134000,17333,"YO8","9XP","semi-detached",0,"freehold","16","","HEATHER CLOSE","","SELBY","SELBY","NORTH YORKSHIRE"\n250000,13405,"YO8","9YA","detached",0,"freehold","6","","YORKDALE COURT","HAMBLETON","SELBY","SELBY","NORTH YORKSHIRE"\n59500,11166,"YO8","9YB","semi-detached",0,"freehold","4","","YORKDALE DRIVE","HAMBLETON","SELBY","SELBY","NORTH YORKSHIRE"\n142500,17648,"YO8","9YB","semi-detached",0,"freehold","4A","","YORKDALE DRIVE","HAMBLETON","SELBY","SELBY","NORTH YORKSHIRE"\n230000,15125,"YO8","9YD","detached",0,"freehold","1","","ONE ACRE GARTH","HAMBLETON","SELBY","SELBY","NORTH YORKSHIRE"\n250000,15950,"YO8","9YD","detached",0,"freehold","3","","ONE ACRE GARTH","HAMBLETON","SELBY","SELBY","NORTH YORKSHIRE"\n')),(0,o.kt)("h2",{id:"convert-the-parquet-file-to-a-json"},"Convert the Parquet file to a JSON"),(0,o.kt)("p",null,"To convert the Parquet file to JSON, simply change the extension on the output filename:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./clickhouse local -q \"SELECT *\nFROM s3('https://datasets-documentation.s3.eu-west-3.amazonaws.com/house_parquet/house_0.parquet')\nINTO OUTFILE 'house_prices.ndjson'\"\n")),(0,o.kt)("p",null,"Let's verify it worked:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-response"},' $ tail house_prices.ndjson\n{"price":"70000","date":10508,"postcode1":"YO8","postcode2":"9XN","type":"detached","is_new":0,"duration":"freehold","addr1":"7","addr2":"","street":"POPPY CLOSE","locality":"SELBY","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}\n{"price":"130000","date":14274,"postcode1":"YO8","postcode2":"9XP","type":"detached","is_new":0,"duration":"freehold","addr1":"10","addr2":"","street":"HEATHER CLOSE","locality":"","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}\n{"price":"150000","date":18180,"postcode1":"YO8","postcode2":"9XP","type":"detached","is_new":0,"duration":"freehold","addr1":"11","addr2":"","street":"HEATHER CLOSE","locality":"","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}\n{"price":"157000","date":18088,"postcode1":"YO8","postcode2":"9XP","type":"detached","is_new":0,"duration":"freehold","addr1":"12","addr2":"","street":"HEATHER CLOSE","locality":"","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}\n{"price":"134000","date":17333,"postcode1":"YO8","postcode2":"9XP","type":"semi-detached","is_new":0,"duration":"freehold","addr1":"16","addr2":"","street":"HEATHER CLOSE","locality":"","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}\n{"price":"250000","date":13405,"postcode1":"YO8","postcode2":"9YA","type":"detached","is_new":0,"duration":"freehold","addr1":"6","addr2":"","street":"YORKDALE COURT","locality":"HAMBLETON","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}\n{"price":"59500","date":11166,"postcode1":"YO8","postcode2":"9YB","type":"semi-detached","is_new":0,"duration":"freehold","addr1":"4","addr2":"","street":"YORKDALE DRIVE","locality":"HAMBLETON","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}\n{"price":"142500","date":17648,"postcode1":"YO8","postcode2":"9YB","type":"semi-detached","is_new":0,"duration":"freehold","addr1":"4A","addr2":"","street":"YORKDALE DRIVE","locality":"HAMBLETON","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}\n{"price":"230000","date":15125,"postcode1":"YO8","postcode2":"9YD","type":"detached","is_new":0,"duration":"freehold","addr1":"1","addr2":"","street":"ONE ACRE GARTH","locality":"HAMBLETON","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}\n{"price":"250000","date":15950,"postcode1":"YO8","postcode2":"9YD","type":"detached","is_new":0,"duration":"freehold","addr1":"3","addr2":"","street":"ONE ACRE GARTH","locality":"HAMBLETON","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}\n')),(0,o.kt)("h2",{id:"convert-csv-to-parquet"},"Convert CSV to Parquet"),(0,o.kt)("p",null,"It works both ways - we can easily read in the new CSV file and output it into a Parquet file. The local file ",(0,o.kt)("inlineCode",{parentName:"p"},"house_prices.csv")," can be read in ClickHouse using the ",(0,o.kt)("inlineCode",{parentName:"p"},"file")," table function, and ClickHouse outputs the file in Parquet format based on the filename ending in ",(0,o.kt)("inlineCode",{parentName:"p"},".parquet")," (or we could have added the ",(0,o.kt)("inlineCode",{parentName:"p"},"FORMAT Parquet")," clause):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./clickhouse local -q \"SELECT *\nFROM file('house_prices.csv')\nINTO OUTFILE 'house_prices.parquet'\"\n")),(0,o.kt)("p",null,"As we mentioned above, you can use any of the ClickHouse ",(0,o.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/interfaces/formats"},"input and output formats")," along with ",(0,o.kt)("inlineCode",{parentName:"p"},"clickhouse local")," to easily convert files into different formats."))}p.isMDXComponent=!0}}]);