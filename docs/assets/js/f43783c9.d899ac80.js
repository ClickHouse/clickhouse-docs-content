"use strict";(self.webpackChunknew_nav_docusaurus_2_2=self.webpackChunknew_nav_docusaurus_2_2||[]).push([[43434],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>y});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=p(t),u=r,y=m["".concat(l,".").concat(u)]||m[u]||d[u]||o;return t?a.createElement(y,i(i({ref:n},c),{},{components:t})):a.createElement(y,i({ref:n},c))}));function y(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=u;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[m]="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},65584:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var a=t(87462),r=(t(67294),t(3905));const o={date:new Date("2023-03-24T00:00:00.000Z")},i="Importing and querying JSON array objects",s={permalink:"/docs/knowledgebase/importing_and_working_with_JSON_array_objects",source:"@site/knowledgebase/importing_and_working_with_JSON_array_objects.md",title:"Importing and querying JSON array objects",description:"Question: How do I import JSON arrays and how can I query the inner objects?",date:"2023-03-24T00:00:00.000Z",formattedDate:"March 24, 2023",tags:[],readingTime:5.085,hasTruncateMarker:!1,authors:[],frontMatter:{date:"2023-03-24T00:00:00.000Z"},prevItem:{title:"What queries are using Materialized Views?",permalink:"/docs/knowledgebase/how_to_display_queries_using_MV"},nextItem:{title:"How to quickly recreate a small table across different terminals",permalink:"/docs/knowledgebase/recreate_table_across_terminals"}},l={authorsImageUrls:[]},p=[],c={toc:p},m="wrapper";function d(e){let{components:n,...t}=e;return(0,r.kt)(m,(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Question:")," How do I import JSON arrays and how can I query the inner objects?"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Answer:")),(0,r.kt)("p",null,"Dump this 1 line JSON array to ",(0,r.kt)("inlineCode",{parentName:"p"},"sample.json")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{"_id":"1","channel":"help","events":[{"eventType":"open","time":"2021-06-18T09:42:39.527Z"},{"eventType":"close","time":"2021-06-18T09:48:05.646Z"}]},{"_id":"2","channel":"help","events":[{"eventType":"open","time":"2021-06-18T09:42:39.535Z"},{"eventType":"edit","time":"2021-06-18T09:42:41.317Z"}]},{"_id":"3","channel":"questions","events":[{"eventType":"close","time":"2021-06-18T09:42:39.543Z"},{"eventType":"create","time":"2021-06-18T09:52:51.299Z"}]},{"_id":"4","channel":"general","events":[{"eventType":"create","time":"2021-06-18T09:42:39.552Z"},{"eventType":"edit","time":"2021-06-18T09:47:29.109Z"}]},{"_id":"5","channel":"general","events":[{"eventType":"edit","time":"2021-06-18T09:42:39.560Z"},{"eventType":"open","time":"2021-06-18T09:42:39.680Z"},{"eventType":"close","time":"2021-06-18T09:42:41.207Z"},{"eventType":"edit","time":"2021-06-18T09:42:43.372Z"},{"eventType":"edit","time":"2021-06-18T09:42:45.642Z"}]}\n')),(0,r.kt)("p",null,"Check the data:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"clickhousebook.local :) SELECT * FROM file('/path/to/sample.json','JSONEachRow');\n\nSELECT *\nFROM file('/path/to/sample.json', 'JSONEachRow')\n\nQuery id: 0bbfa09f-ac7f-4a1e-9227-2961b5ffc2d4\n\n\u250c\u2500_id\u2500\u252c\u2500channel\u2500\u2500\u2500\u252c\u2500events\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   1 \u2502 help      \u2502 [{'eventType':'open','time':'2021-06-18T09:42:39.527Z'},{'eventType':'close','time':'2021-06-18T09:48:05.646Z'}]                                                                                                                                           \u2502\n\u2502   2 \u2502 help      \u2502 [{'eventType':'open','time':'2021-06-18T09:42:39.535Z'},{'eventType':'edit','time':'2021-06-18T09:42:41.317Z'}]                                                                                                                                            \u2502\n\u2502   3 \u2502 questions \u2502 [{'eventType':'close','time':'2021-06-18T09:42:39.543Z'},{'eventType':'create','time':'2021-06-18T09:52:51.299Z'}]                                                                                                                                         \u2502\n\u2502   4 \u2502 general   \u2502 [{'eventType':'create','time':'2021-06-18T09:42:39.552Z'},{'eventType':'edit','time':'2021-06-18T09:47:29.109Z'}]                                                                                                                                          \u2502\n\u2502   5 \u2502 general   \u2502 [{'eventType':'edit','time':'2021-06-18T09:42:39.560Z'},{'eventType':'open','time':'2021-06-18T09:42:39.680Z'},{'eventType':'close','time':'2021-06-18T09:42:41.207Z'},{'eventType':'edit','time':'2021-06-18T09:42:43.372Z'},{'eventType':'edit','time':'2021-06-18T09:42:45.642Z'}] \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n5 rows in set. Elapsed: 0.001 sec. \n")),(0,r.kt)("p",null,"Create a table to receive the JSON rows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"clickhousebook.local :) CREATE TABLE IF NOT EXISTS sample_json_array (\n                            `rawJSON` String EPHEMERAL,\n                            `_id` String DEFAULT JSONExtractString(rawJSON, '_id'),\n                            `channel` String DEFAULT JSONExtractString(rawJSON, 'channel'),\n                            `actions` Array(JSON) DEFAULT JSONExtract(rawJSON, 'actions')\n                        ) ENGINE = MergeTree\n                        ORDER BY\n                            channel\n\nCREATE TABLE IF NOT EXISTS sample_json_array\n(\n    `rawJSON` String EPHEMERAL,\n    `_id` String DEFAULT JSONExtractString(rawJSON, '_id'),\n    `channel` String DEFAULT JSONExtractString(rawJSON, 'channel'),\n    `actions` Array(JSON) DEFAULT JSONExtract(rawJSON, 'actions')\n)\nENGINE = MergeTree\nORDER BY channel\n\nQuery id: e90c26e7-a950-4520-a517-6d437856f81d\n\n\n0 rows in set. Elapsed: 0.173 sec. \n")),(0,r.kt)("p",null,"Insert the data:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"clickhousebook.local :) INSERT INTO\n                            sample_json_array\n                        SELECT\n                            *\n                        FROM\n                            file(\n                                '/opt/cases/000000/sample_json_arrays.json',\n                                'JSONEachRow'\n                            );\n\nINSERT INTO sample_json_array SELECT *\nFROM file('/opt/cases/000000/sample.json', 'JSONEachRow')\n\nQuery id: 60c4beab-3c2c-40c1-9c6f-bbbd7118dde3\n\nOk.\n\n0 rows in set. Elapsed: 0.002 sec.\n")),(0,r.kt)("p",null,"Check how the data inference acted on JSON object type:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"clickhousebook.local :) DESCRIBE TABLE sample_json_object_array SETTINGS describe_extend_object_types = 1;\n\nDESCRIBE TABLE sample_json_object_array\nSETTINGS describe_extend_object_types = 1\n\nQuery id: a28c2850-885d-4c3a-b1bc-e5931909e89a\n\n\u250c\u2500name\u2500\u2500\u2500\u2500\u252c\u2500type\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500default_type\u2500\u252c\u2500default_expression\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500comment\u2500\u252c\u2500codec_expression\u2500\u252c\u2500ttl_expression\u2500\u2510\n\u2502 rawJSON \u2502 String                                      \u2502 EPHEMERAL    \u2502 defaultValueOfTypeName('String')       \u2502         \u2502                  \u2502                \u2502\n\u2502 _id     \u2502 String                                      \u2502 DEFAULT      \u2502 JSONExtractString(rawJSON, '_id')      \u2502         \u2502                  \u2502                \u2502\n\u2502 channel \u2502 String                                      \u2502 DEFAULT      \u2502 JSONExtractString(rawJSON, 'channel')  \u2502         \u2502                  \u2502                \u2502\n\u2502 events  \u2502 Array(Tuple(eventType String, time String)) \u2502 DEFAULT      \u2502 JSONExtractArrayRaw(rawJSON, 'events') \u2502         \u2502                  \u2502                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Events")," is an ",(0,r.kt)("em",{parentName:"p"},"Array")," of ",(0,r.kt)("inlineCode",{parentName:"p"},"Tuple")," each containing a ",(0,r.kt)("em",{parentName:"p"},"eventType")," ",(0,r.kt)("inlineCode",{parentName:"p"},"String")," and a ",(0,r.kt)("em",{parentName:"p"},"time")," ",(0,r.kt)("inlineCode",{parentName:"p"},"String")," fields. This latter type is suboptimal (we'd want ",(0,r.kt)("inlineCode",{parentName:"p"},"DateTime")," instead)."),(0,r.kt)("p",null,"Let's see the data:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"clickhousebook.local :) SELECT\n                            _id,\n                            channel,\n                            events.eventType,\n                            events.time\n                        FROM sample_json_object_array\n                        WHERE has(events.eventType, 'close')\n\nSELECT\n    _id,\n    channel,\n    events.eventType,\n    events.time\nFROM sample_json_object_array\nWHERE has(events.eventType, 'close')\n\nQuery id: 3ddd6843-5206-4f52-971f-1699f0ba1728\n\n\u250c\u2500_id\u2500\u252c\u2500channel\u2500\u2500\u2500\u252c\u2500events.eventType\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500events.time\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 5   \u2502 general   \u2502 ['edit','open','close','edit','edit'] \u2502 ['2021-06-18T09:42:39.560Z','2021-06-18T09:42:39.680Z','2021-06-18T09:42:41.207Z','2021-06-18T09:42:43.372Z','2021-06-18T09:42:45.642Z'] \u2502\n\u2502 1   \u2502 help      \u2502 ['open','close']                      \u2502 ['2021-06-18T09:42:39.527Z','2021-06-18T09:48:05.646Z']                                                                                  \u2502\n\u2502 3   \u2502 questions \u2502 ['close','create']                    \u2502 ['2021-06-18T09:42:39.543Z','2021-06-18T09:52:51.299Z']                                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n3 rows in set. Elapsed: 0.001 sec. \n")),(0,r.kt)("p",null,"Let's run a few queries:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"_id")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"channel")," of events that have an ",(0,r.kt)("inlineCode",{parentName:"p"},"eventType")," of value ",(0,r.kt)("inlineCode",{parentName:"p"},"close")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"clickhousebook.local :) SELECT\n                            _id,\n                            channel,\n                            events.eventType\n                        FROM\n                            sample_json_object_array\n                        WHERE\n                            has(events.eventType,'close')\n\nSELECT\n    _id,\n    channel,\n    events.eventType\nFROM sample_json_object_array\nWHERE has(events.eventType, 'close')\n\nQuery id: 033a0c56-7bfa-4261-a334-7323bdc40f87\n\n\u250c\u2500_id\u2500\u252c\u2500channel\u2500\u2500\u2500\u252c\u2500events.eventType\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 5   \u2502 general   \u2502 ['edit','open','close','edit','edit'] \u2502\n\u2502 1   \u2502 help      \u2502 ['open','close']                      \u2502\n\u2502 3   \u2502 questions \u2502 ['close','create']                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500_id\u2500\u252c\u2500channel\u2500\u2500\u2500\u252c\u2500events.eventType\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 5   \u2502 general   \u2502 ['edit','open','close','edit','edit'] \u2502\n\u2502 1   \u2502 help      \u2502 ['open','close']                      \u2502\n\u2502 3   \u2502 questions \u2502 ['close','create']                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n6 rows in set. Elapsed: 0.001 sec. \n")),(0,r.kt)("p",null,"We want to query the ",(0,r.kt)("inlineCode",{parentName:"p"},"time")," , for example all events between a given time range, but we notice it was imported as ",(0,r.kt)("inlineCode",{parentName:"p"},"String"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"clickhousebook.local :) SELECT toTypeName(events.time) FROM sample_json_object_array;\n\nSELECT toTypeName(events.time)\nFROM sample_json_object_array\n\nQuery id: 27f07f02-66cd-420d-8623-eeed7d501014\n\n\u250c\u2500toTypeName(events.time)\u2500\u2510\n\u2502 Array(String)           \u2502\n\u2502 Array(String)           \u2502\n\u2502 Array(String)           \u2502\n\u2502 Array(String)           \u2502\n\u2502 Array(String)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n5 rows in set. Elapsed: 0.001 sec. \n")),(0,r.kt)("p",null,"So, in order to handle these as dates, first we want to convert to ",(0,r.kt)("inlineCode",{parentName:"p"},"DateTime"),".\nTo convert an array we use a map function:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"clickhousebook.local :) \n                        SELECT\n                            _id,\n                            channel,\n                            arrayMap(x->parseDateTimeBestEffort(x), events.time)\n                        FROM\n                            sample_json_object_array\n\nSELECT\n    _id,\n    channel,\n    arrayMap(x -> parseDateTimeBestEffort(x), events.time)\nFROM sample_json_object_array\n\nQuery id: f3c7881e-b41c-4872-9c67-5c25966599a1\n\n\u250c\u2500_id\u2500\u252c\u2500channel\u2500\u2500\u2500\u252c\u2500arrayMap(lambda(tuple(x), parseDateTimeBestEffort(x)), events.time)\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 4   \u2502 general   \u2502 ['2021-06-18 11:42:39','2021-06-18 11:47:29']                                                                   \u2502\n\u2502 5   \u2502 general   \u2502 ['2021-06-18 11:42:39','2021-06-18 11:42:39','2021-06-18 11:42:41','2021-06-18 11:42:43','2021-06-18 11:42:45'] \u2502\n\u2502 1   \u2502 help      \u2502 ['2021-06-18 11:42:39','2021-06-18 11:48:05']                                                                   \u2502\n\u2502 2   \u2502 help      \u2502 ['2021-06-18 11:42:39','2021-06-18 11:42:41']                                                                   \u2502\n\u2502 3   \u2502 questions \u2502 ['2021-06-18 11:42:39','2021-06-18 11:52:51']                                                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n5 rows in set. Elapsed: 0.001 sec.\n")),(0,r.kt)("p",null,"we can appreciate the diffs using ",(0,r.kt)("inlineCode",{parentName:"p"},"toTypeName")," on both the arrays:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"clickhousebook.local :) SELECT\n                            _id,\n                            channel,\n                            toTypeName(events.time) as events_as_strings,\n                            toTypeName(arrayMap(x->parseDateTimeBestEffort(x), events.time)) as events_as_datetime\n                        FROM\n                            sample_json_object_array\n\nSELECT\n    _id,\n    channel,\n    toTypeName(events.time) AS events_as_strings,\n    toTypeName(arrayMap(x -> parseDateTimeBestEffort(x), events.time)) AS events_as_datetime\nFROM sample_json_object_array\n\nQuery id: 1af54994-b756-472f-88d7-8b5cdca0e54e\n\n\u250c\u2500_id\u2500\u252c\u2500channel\u2500\u2500\u2500\u252c\u2500events_as_strings\u2500\u252c\u2500events_as_datetime\u2500\u2510\n\u2502 4   \u2502 general   \u2502 Array(String)     \u2502 Array(DateTime)    \u2502\n\u2502 5   \u2502 general   \u2502 Array(String)     \u2502 Array(DateTime)    \u2502\n\u2502 1   \u2502 help      \u2502 Array(String)     \u2502 Array(DateTime)    \u2502\n\u2502 2   \u2502 help      \u2502 Array(String)     \u2502 Array(DateTime)    \u2502\n\u2502 3   \u2502 questions \u2502 Array(String)     \u2502 Array(DateTime)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n5 rows in set. Elapsed: 0.001 sec. \n")),(0,r.kt)("p",null,"now let's get the ",(0,r.kt)("inlineCode",{parentName:"p"},"id")," of  of the rows where ",(0,r.kt)("inlineCode",{parentName:"p"},"time")," is between a given interval."),(0,r.kt)("p",null,"we use ",(0,r.kt)("inlineCode",{parentName:"p"},"arrayCount")," to see if there is a count greater than than 0 of items in the array returned by the map function that will match the condition ",(0,r.kt)("inlineCode",{parentName:"p"},"x BETWEEN toDateTime('2021-06-18 11:46:00', 'Europe/Rome') AND toDateTime('2021-06-18 11:50:00', 'Europe/Rome')")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"clickhousebook.local :) SELECT\n                            _id,\n                            arrayMap(x -> parseDateTimeBestEffort(x), events.time)\n                        FROM\n                            sample_json_object_array\n                        WHERE\n                            arrayCount(\n                                x -> x BETWEEN toDateTime('2021-06-18 11:46:00', 'Europe/Rome')\n                                AND toDateTime('2021-06-18 11:50:00', 'Europe/Rome'),\n                                arrayMap(x -> parseDateTimeBestEffort(x), events.time)\n                            ) > 0;\n\nSELECT\n    _id,\n    arrayMap(x -> parseDateTimeBestEffort(x), events.time)\nFROM sample_json_object_array\nWHERE arrayCount(x -> ((x >= toDateTime('2021-06-18 11:46:00', 'Europe/Rome')) AND (x <= toDateTime('2021-06-18 11:50:00', 'Europe/Rome'))), arrayMap(x -> parseDateTimeBestEffort(x), events.time)) > 0\n\nQuery id: d4882fc3-9f99-4e87-9f89-47683f10656d\n\n\u250c\u2500_id\u2500\u252c\u2500arrayMap(lambda(tuple(x), parseDateTimeBestEffort(x)), events.time)\u2500\u2510\n\u2502 4   \u2502 ['2021-06-18 11:42:39','2021-06-18 11:47:29']                       \u2502\n\u2502 1   \u2502 ['2021-06-18 11:42:39','2021-06-18 11:48:05']                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n2 rows in set. Elapsed: 0.002 sec. \n")),(0,r.kt)("p",null,"\u26a0\ufe0f"),(0,r.kt)("p",null,"Please remember, at the time of writing this article the current implementation of JSON is experimental and not suited for production."),(0,r.kt)("p",null,"This example highlights how to quickly import JSON and start querying it and represents a tradeoff between the ease of use where we import the JSON objects as ",(0,r.kt)("inlineCode",{parentName:"p"},"JSON")," type with no need to specify upfront the schema type. Convenient for a quick test however for long term use of the data we would like to, with regards to this example to store the data using the most appropriate types, so for the ",(0,r.kt)("inlineCode",{parentName:"p"},"time")," field, use ",(0,r.kt)("inlineCode",{parentName:"p"},"DateTime")," instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"String"),", in order to avoid any post-ingestion phase conversion as illustrated above. Please refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/integrations/data-formats/json"},"documentation")," for more about handling JSON."))}d.isMDXComponent=!0}}]);