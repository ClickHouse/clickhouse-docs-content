<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">ClickHouse Knowledge Base | ClickHouse Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://clickhouse.com/docs/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://clickhouse.com/docs/img/logo.png"><meta data-rh="true" property="og:url" content="https://clickhouse.com/docs/knowledgebase"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="ClickHouse Knowledge Base | ClickHouse Docs"><meta data-rh="true" name="description" content="Knowledge Base"><meta data-rh="true" property="og:description" content="Knowledge Base"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://clickhouse.com/docs/knowledgebase"><link data-rh="true" rel="alternate" href="https://clickhouse.com/docs/knowledgebase" hreflang="en"><link data-rh="true" rel="alternate" href="https://clickhouse.com/docs/knowledgebase" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/docs/knowledgebase/rss.xml" title="ClickHouse Knowledge Base Feed RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/knowledgebase/atom.xml" title="ClickHouse Knowledge Base Feed Atom Feed">
<link rel="alternate" type="application/json" href="/docs/knowledgebase/feed.json" title="ClickHouse Knowledge Base Feed JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KF1LLRTQ5Q"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KF1LLRTQ5Q",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="ClickHouse Docs" href="/docs/opensearch.xml">





<script src="/docs/js/analytics.js"></script><link rel="stylesheet" href="/docs/assets/css/styles.d4633d58.css">
<link rel="preload" href="/docs/assets/js/runtime~main.1a20c1e7.js" as="script">
<link rel="preload" href="/docs/assets/js/main.ff0025b5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navBar_gvJn"><div class="navbarHeaderContainer_rccn navbar-header"><div class="navbar__inner navbarInner_W6bg"><div class="navbar__items"><a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/docs/img/logo_without_text.svg" alt="ClickHouse" class="themedImage_ToTc themedImage--light_HNdA"><img src="/docs/img/logo_without_text.svg" alt="ClickHouse" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">ClickHouse</b></a><div class="navbarItemsList_uIZ2 navbar-items-list"><div class="navbar__item dropdown"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link ch-menu">Product</a><ul class="dropdown__menu"><li><a href="https://clickhouse.com/cloud" target="_blank" rel="noopener noreferrer" class="dropdown__link">ClickHouse Cloud</a></li><li><a href="https://clickhouse.com/clickhouse" target="_blank" rel="noopener noreferrer" class="dropdown__link">ClickHouse Open Source</a></li></ul></div><a href="https://clickhouse.com/customer-stories" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link ch-menu">Use Cases</a><div class="navbar__item dropdown"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link ch-menu">Company</a><ul class="dropdown__menu"><li><a href="https://clickhouse.com/blog" target="_blank" rel="noopener noreferrer" class="dropdown__link">Blog</a></li><li><a href="https://clickhouse.com/company/our-story" target="_blank" rel="noopener noreferrer" class="dropdown__link">Our story</a></li><li><a href="https://clickhouse.com/company/careers" target="_blank" rel="noopener noreferrer" class="dropdown__link">Careers</a></li><li><a href="https://clickhouse.com/company/contact" target="_blank" rel="noopener noreferrer" class="dropdown__link">Contact us</a></li><li><a href="https://clickhouse.com/company/news-events" target="_blank" rel="noopener noreferrer" class="dropdown__link">News and events</a></li></ul></div><div class="navbar__item dropdown"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link ch-menu">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/en/intro">Docs</a></li><li><a href="https://clickhouse.com/learn" target="_blank" rel="noopener noreferrer" class="dropdown__link">ClickHouse Academy</a></li></ul></div><a href="https://clickhouse.com/pricing" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link ch-menu">Pricing</a></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item">
                <div class="nav-items-btns">
                  <a href="https://clickhouse.cloud/signIn" class="sign-in navbar__item navbar__link ch-menu">
                    Sign in
                  </a>
                  <a href="https://clickhouse.cloud/signUp" class="click-button-anchor">
                    <button class="click-button primary-btn">Free Trial</button>
                  </a>
                </div></div><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button></div></div><div class="secondary-nav--items secondaryMenu_iuff"><div class="scrollableElement_Qqzp secondaryMenuLeft_tFZR secondary-nav--items-left"><a class="navbar__item navbar__link ch-menu" href="/docs/en/intro">Docs</a><a class="navbar__item navbar__link ch-menu" href="/docs/en/cloud/overview">Cloud</a><a class="navbar__item navbar__link ch-menu" href="/docs/en/sql-reference">SQL Reference</a><a aria-current="page" class="navbar__item navbar__link ch-menu navbar__link--active" href="/docs/knowledgebase">Knowledge Base</a></div><div class="secondaryMenuRight__9m4 secondary-nav--items-right"><div class="navbar__item dropdown dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg width="14" height="13" viewBox="0 0 14 13" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6.95 12.6496L9.75 5.26628H11.0333L13.8333 12.6496H12.55L11.9 10.7663H8.91667L8.25 12.6496H6.95ZM9.28333 9.69961H11.5L10.4167 6.64961H10.3667L9.28333 9.69961ZM2.08333 10.7996L1.21667 9.93294L4.33333 6.83294C3.94444 6.39961 3.60556 5.95228 3.31667 5.49094C3.02778 5.03005 2.77222 4.54405 2.55 4.03294H3.83333C4.02222 4.41072 4.22222 4.74672 4.43333 5.04094C4.64444 5.33561 4.89444 5.64405 5.18333 5.96628C5.63889 5.47739 6.01667 4.97472 6.31667 4.45828C6.61667 3.94139 6.86667 3.3885 7.06667 2.79961H0.25V1.58294H4.55V0.349609H5.78333V1.58294H10.0833V2.79961H8.3C8.07778 3.53294 7.78333 4.24116 7.41667 4.92428C7.05 5.60783 6.59444 6.25516 6.05 6.86628L7.53333 8.36628L7.06667 9.63294L5.16667 7.73294L2.08333 10.7996Z" fill="currentColor"/>
</svg></a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/en/intro">English</a></li><li><a class="dropdown__link" href="/docs/ru">Russian</a></li><li><a class="dropdown__link" href="/docs/zh">Chinese</a></li></ul></div><button class="colorModeButton_hk25 navbar-color-toggle"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.7227 0.724664C8.7227 0.330045 8.39191 0 8.0036 0C7.60809 0 7.2773 0.330045 7.2773 0.724664V2.18834C7.2773 2.57578 7.60809 2.90583 8.0036 2.90583C8.39191 2.90583 8.7227 2.57578 8.7227 2.18834V0.724664ZM11.5991 3.4009C11.3258 3.67354 11.3258 4.13274 11.6063 4.41256C11.8796 4.6852 12.347 4.69238 12.6274 4.40538L13.6629 3.3722C13.9434 3.09238 13.9362 2.62601 13.6629 2.34619C13.3897 2.07354 12.9222 2.08072 12.649 2.35336L11.5991 3.4009ZM3.37258 4.40538C3.64584 4.6852 4.11326 4.6852 4.38652 4.41256C4.66697 4.14709 4.66697 3.66637 4.4009 3.4009L3.3582 2.35336C3.09213 2.08789 2.61753 2.07354 2.34427 2.34619C2.07101 2.62601 2.06382 3.09238 2.33708 3.36502L3.37258 4.40538ZM7.9964 11.774C10.0602 11.774 11.7717 10.0664 11.7717 8C11.7717 5.93363 10.0602 4.22601 7.9964 4.22601C5.93258 4.22601 4.22112 5.93363 4.22112 8C4.22112 10.0664 5.93258 11.774 7.9964 11.774ZM7.9964 10.4395C6.65888 10.4395 5.55146 9.33453 5.55146 8C5.55146 6.66547 6.65888 5.56054 7.9964 5.56054C9.33393 5.56054 10.4413 6.66547 10.4413 8C10.4413 9.33453 9.33393 10.4395 7.9964 10.4395ZM15.2809 8.71749C15.6692 8.71749 16 8.38744 16 8C16 7.60538 15.6692 7.28251 15.2809 7.28251H13.8211C13.4328 7.28251 13.102 7.60538 13.102 8C13.102 8.38744 13.4328 8.71749 13.8211 8.71749H15.2809ZM0.719101 7.28251C0.330787 7.28251 0 7.60538 0 8C0 8.38744 0.330787 8.71749 0.719101 8.71749H2.17888C2.57438 8.71749 2.90517 8.38744 2.90517 8C2.90517 7.60538 2.57438 7.28251 2.17888 7.28251H0.719101ZM12.6202 11.5946C12.347 11.322 11.8796 11.322 11.5991 11.5946C11.3258 11.8744 11.3258 12.3336 11.6063 12.6135L12.649 13.6538C12.9294 13.9265 13.3897 13.9193 13.6701 13.6395C13.9434 13.3668 13.9434 12.9076 13.6629 12.6278L12.6202 11.5946ZM2.33708 12.6206C2.05663 12.9004 2.05663 13.3668 2.3227 13.6395C2.60315 13.9121 3.07056 13.9193 3.34382 13.6466L4.38652 12.6135C4.66697 12.3336 4.66697 11.8744 4.4009 11.6018C4.12045 11.322 3.65303 11.322 3.37258 11.5946L2.33708 12.6206ZM8.7227 13.8117C8.7227 13.4242 8.39191 13.0942 8.0036 13.0942C7.60809 13.0942 7.2773 13.4242 7.2773 13.8117V15.2753C7.2773 15.6628 7.60809 16 8.0036 16C8.39191 16 8.7227 15.6628 8.7227 15.2753V13.8117Z" fill="currentColor"></path></svg><span>light Mode</span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All KB articles</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/find-expensive-queries">How do I find the most expensive queries in my ClickHouse platform?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/cannot-append-data-to-parquet-format">DB::Exception: Cannot append data in format Parquet to file, because this format doesn&#x27;t support appends. (CANNOT_APPEND_TO_FILE)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/how_to_display_queries_using_MV">What queries are using Materialized Views?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/importing_and_working_with_JSON_array_objects">Importing and querying JSON array objects</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/recreate_table_across_terminals">How to quickly recreate a small table across different terminals</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/s3_export_data_year_month_folders">How can I do partitioned writes by year and month on S3?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/which-processes-are-currently-running">How to check what code is currently running on a server?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/file-export">How do I export data from ClickHouse to a file?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/ingest-parquet-files-in-s3">How to ingest Parquet files from an S3 bucket</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/parquet-to-csv-json">Converting Files from Parquet to CSV or JSON</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/postgresql-to-parquet-csv-json">Export PostgreSQL data to Parquet, CSV or JSON</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/mysql-to-parquet-csv-json">Export MySQL data to Parquet, CSV or JSON</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/connection_timeout_remote_remoteSecure">Code: 279. DB::NetException: All connection tries failed.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/exception-too-many-parts">DB::Exception: Too many parts (600). Merges are processing significantly slower than inserts</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/json-import">How to import JSON into ClickHouse?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/useful-queries-for-troubleshooting">Useful queries for troubleshooting</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/calculate-pi-using-sql">It&#x27;s Pi Day! Let&#x27;s calculate pi using SQL</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/are_materialized_views_inserted_asynchronously">Are Materialized Views inserted synchronously?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/async_vs_optimize_read_in_order">Synchronous data reading</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/configure-a-user-setting">How to configure a setting for a user</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/execute-system-queries-in-cloud">Execute SYSTEM statements on all nodes in ClickHouse Cloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/filtered-aggregates">Filtered aggregates in ClickHouse</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/how-to-increase-thread-pool-size">How to increase the number of threads available?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/ignoring-incorrect-settings">Ignoring incorrect settings</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/send_logs_level">Capturing server logs of queries at the client</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/billing">Billing</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/marketplace">Marketplace</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/troubleshooting">Troubleshooting</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/user-permissions-on-cloud">How to check grants and standard permissions for default user in ClickHouse Cloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/improve-map-performance">Improving Map performance</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/delete-old-data">Is it possible to delete old records from a ClickHouse table?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/multi-region-replication">Does ClickHouse support multi-region replication?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/oracle-odbc">What if I have a problem with encodings when using Oracle via ODBC?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/columnar-database">What is a columnar database?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/dbms-naming">What does “ClickHouse” mean?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/how-do-i-contribute-code-to-clickhouse">How do I contribute code to ClickHouse?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/key-value">Can I use ClickHouse as a key-value storage?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/mapreduce">Why not use something like MapReduce?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/maximum_number_of_tables_and_databases">How many maximum databases or tables is recommended in a ClickHouse cluster?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/ne-tormozit">What Does “Не тормозит” Mean?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/olap">What is OLAP?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/production">Which ClickHouse version to use in production?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/time-series">Can I use ClickHouse as a time-series database?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/who-is-using-clickhouse">Who is using ClickHouse?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docs/knowledgebase/why-clickhouse-is-so-fast">Why is ClickHouse so fast?</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/docs/knowledgebase/find-expensive-queries">How do I find the most expensive queries in my ClickHouse platform?</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-26T00:00:00.000Z" itemprop="datePublished">March 26, 2023</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><p>The <code>query_log</code> table in the <code>system</code> database keeps track of all your queries, including:</p><ul><li>how much memory the query consumed, and</li><li>how much CPU time was needed</li></ul><p>The following query returns the top 10 queries, where &quot;top&quot; means the queries that used the most memory:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    event_time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    initial_query_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    formatReadableSize</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">memory_usage</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> memory</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ProfileEvents</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">Values</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">indexOf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ProfileEvents</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Names</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;UserTimeMicroseconds&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> userCPU</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ProfileEvents</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">Values</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">indexOf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">ProfileEvents</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Names</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;SystemTimeMicroseconds&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> systemCPU</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    normalizedQueryHash</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> normalized_query_hash</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> clusterAllReplicas</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> system</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">query_log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> memory_usage </span><span class="token keyword" style="color:rgb(86, 156, 214)">DESC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The response looks like</p><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">┌─type────────┬──────────event_time─┬─initial_query_id─────────────────────┬─memory─────┬─────userCPU─┬──systemCPU─┬─normalized_query_hash─┐</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ QueryFinish │ 2023-03-26 21:36:07 │ 7fc488a5-838f-410d-88ee-2f492825a26b │ 3.45 GiB   │ 28147128901 │ 8590897697 │    178963678599600243 │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ QueryFinish │ 2023-03-26 21:36:04 │ 7fc488a5-838f-410d-88ee-2f492825a26b │ 1.18 GiB   │ 10194162387 │ 1183376457 │   4121209451971717712 │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ QueryFinish │ 2023-03-26 21:36:06 │ 7fc488a5-838f-410d-88ee-2f492825a26b │ 1.16 GiB   │ 10516510952 │ 1484303318 │   4121209451971717712 │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ QueryFinish │ 2023-03-26 21:35:59 │ 7fc488a5-838f-410d-88ee-2f492825a26b │ 1.14 GiB   │ 11484580963 │ 1464145099 │   4121209451971717712 │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ QueryFinish │ 2023-03-26 21:47:01 │ 8119e682-a343-4847-96e7-d34ad8a748a1 │ 455.29 MiB │   123340498 │    8234304 │  10687606311941357470 │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ QueryFinish │ 2023-03-26 22:07:05 │ f2690e48-fe1e-4367-ae9d-435d962003a5 │ 377.94 MiB │  2358130001 │  668098391 │   5988812223780974416 │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ QueryFinish │ 2023-03-26 20:45:42 │ 04618222-40a1-4299-8c3d-9f050a82d849 │ 18.48 MiB  │       24676 │      16620 │   3205198713665290475 │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ QueryFinish │ 2023-03-26 22:14:37 │ badf1097-5f8f-4486-88e9-3a5ac2e4734c │ 17.41 MiB  │      186234 │     148739 │   1910846996890686559 │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ QueryFinish │ 2023-03-26 21:39:42 │ 8d373327-f566-4cd5-9f2c-cec75f534751 │ 16.19 MiB  │       23169 │      12365 │   3205198713665290475 │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ QueryFinish │ 2023-03-26 21:35:42 │ ea672dba-7c10-4dd4-b819-cad9dccbf5d0 │ 13.97 MiB  │       20696 │       8001 │   3205198713665290475 │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">└─────────────┴─────────────────────┴──────────────────────────────────────┴────────────┴─────────────┴────────────┴───────────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can use the query ID to extract more details about the query. Let&#x27;s research our longest running query above (the first one):</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> query</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> clusterAllReplicas</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> system</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">query_log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">WHERE</span><span class="token plain"> initial_query_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;7fc488a5-838f-410d-88ee-2f492825a26b&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It turns out to be the query we used to insert a few billion rows of data into a table named <code>youtube</code> (see the <a href="https://clickhouse.com/docs/en/getting-started/example-datasets/youtube-dislikes" target="_blank" rel="noopener noreferrer">YouTube dislikes dataset</a>):</p><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">INSERT INTO youtube</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">SETTINGS input_format_null_as_default = 1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">SELECT</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    id,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    parseDateTimeBestEffortUS(toString(fetch_date)) AS fetch_date,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    upload_date,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ifNull(title, &#x27;&#x27;) AS title,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    uploader_id,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ifNull(uploader, &#x27;&#x27;) AS uploader,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    uploader_sub_count,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    is_age_limit,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    view_count,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    like_count,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    dislike_count,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    is_crawlable,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    has_subtitles,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    is_ads_enabled,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    is_comments_enabled,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ifNull(description, &#x27;&#x27;) AS description,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    rich_metadata,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    super_titles,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ifNull(uploader_badges, &#x27;&#x27;) AS uploader_badges,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ifNull(video_badges, &#x27;&#x27;) AS video_badges</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">FROM s3Cluster(&#x27;default&#x27;,&#x27;https://clickhouse-public-datasets.s3.amazonaws.com/youtube/original/files/*.zst&#x27;, &#x27;JSONLines&#x27;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/docs/knowledgebase/cannot-append-data-to-parquet-format">DB::Exception: Cannot append data in format Parquet to file, because this format doesn&#x27;t support appends. (CANNOT_APPEND_TO_FILE)</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-25T00:00:00.000Z" itemprop="datePublished">March 25, 2023</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><p>Suppose you create a table that uses the <code>File</code> table engine with the Parquet format:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> parquet_test</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">x</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> UInt32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">y</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> String</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">ENGINE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">File</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Parquet</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can write to the table once:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> parquet_test </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUES</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Hello&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Hi&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This creates a file named <code>data.Parquet</code> in the <code>data/default/parquet_test</code> folder. If you try to insert another batch:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> parquet_test </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUES</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;World&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Bye&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>...you get the following error:</p><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">Code: 641. DB::Exception: Received from localhost:9000. DB::Exception: Cannot append data in format Parquet to file, because this format doesn&#x27;t support appends. You can allow to create a new file on each insert by enabling setting engine_file_allow_create_multiple_files. (CANNOT_APPEND_TO_FILE)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can not append to Parquet files in ClickHouse. But you can tell ClickHouse to create a new file for every <code>INSERT</code> by enabling the <a href="https://clickhouse.com/docs/en/operations/settings/settings#engine_file_allow_create_multiple_files" target="_blank" rel="noopener noreferrer"><code>engine_file_allow_create_multiple_files</code> setting</a>. If enabled, on each insert a new file will be created with a name following this pattern:</p><div class="codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">`data.Parquet` -&gt; `data.1.Parquet` -&gt; `data.2.Parquet`, etc.:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s give it a try. We will put our two commands into a single file named <code>parquet.sql</code>:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SET</span><span class="token plain"> engine_file_allow_create_multiple_files </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">parquet_test </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUES</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;World&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Bye&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Run it using <code>clickhouse-client</code>:</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">./clickhouse client --queries-file parquet.sql</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And now you will see two files in <code>data/default/parquet_test</code> (and a new file for each subsequent insert).</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div><div class="alert-content admonitionContent_vXIg"><div class="admonitionHeading_TMsN">note</div><p>The <code>engine_file_allow_create_multiple_files</code> setting applies to other data formats that are not appendable, like JSON and ORC.</p></div></div></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/docs/knowledgebase/how_to_display_queries_using_MV">What queries are using Materialized Views?</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-24T00:00:00.000Z" itemprop="datePublished">March 24, 2023</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><p><strong>Question:</strong> How do I show all queries involving materialized views in the last 60m?</p><p><strong>Answer:</strong></p><p>This query will display all queries directed towards Materialized Views considering that:</p><ul><li>we can leverage the <code>create_table_query</code> field in <code>system.tables</code> table to identify what tables are explicit (<code>TO</code>) recipient of MVs;</li><li>we can track back (using <code>uuid</code> and the name convention <code>.inner_id.&lt;uuid&gt;</code>) what tables are implicit recipient of MVs;</li></ul><p>We can also configure how long back in time we want to look, by changing the value (<code>60</code> m by default) in the initial query CTE</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">WITH</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">60</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">-- default 60m</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> timeRange</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">--prepare names of possible implicit MV hidden target tables for *any* table with NON NULL uuid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> groupArray</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;default.`.inner_id.&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> toString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">uuid</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;`&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> clusterAllReplicas</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> system</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">tables</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">WHERE</span><span class="token plain"> notEmpty</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">uuid</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> MV_implicit_possible_hidden_target_tables_names_array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">--captures MV name and target tables (if TO is specified)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">--TODO it seems that extract will return just the first capturing group :( replace with regexpExtract once available</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> arrayFilter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            x</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain">x </span><span class="token operator" style="color:rgb(212, 212, 212)">!=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">--remove empty captures</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            groupArray</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                extract</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    create_table_query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;^CREATE MATERIALIZED VIEW\s(\w+\.\w+)\s(?:TO\s(\S+))?&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> clusterAllReplicas</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> system</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">tables</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">engine</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;MaterializedView&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> MV_explicit_target_tables_names_array</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> event_time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">tables</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;MVs tables&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> clusterAllReplicas</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> system</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">query_log</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">WHERE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">-- only SELECT within 60m</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        event_time </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">now</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> toIntervalMinute</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">timeRange</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token operator" style="color:rgb(212, 212, 212)">AND</span><span class="token plain"> startsWith</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;SELECT&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">-- check either that query involves implicit MV target table names</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        hasAny</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token keyword" style="color:rgb(86, 156, 214)">tables</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            MV_implicit_possible_hidden_target_tables_names_array</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token operator" style="color:rgb(212, 212, 212)">OR</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">-- check that query involves explicit MV target table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        hasAny</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">tables</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> MV_explicit_target_tables_names_array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> event_time </span><span class="token keyword" style="color:rgb(86, 156, 214)">DESC</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>expected output:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> event_time          </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> query                                                                                          </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> MVs </span><span class="token keyword" style="color:rgb(86, 156, 214)">tables</span><span class="token plain">                                                            </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">------------------- | ---------------------------------------------------------------------------------------------- | --------------------------------------------------------------------- |</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2023</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">02</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">08</span><span class="token plain">:</span><span class="token number" style="color:rgb(181, 206, 168)">14</span><span class="token plain">:</span><span class="token number" style="color:rgb(181, 206, 168)">14</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain">     rand</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain">     </span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">sum_of_volumes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">     </span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">big_changes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">     system</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">users </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;default.big_changes_mv&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;default.sum_of_volumes_mv&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;system.users&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2023</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">02</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">08</span><span class="token plain">:</span><span class="token number" style="color:rgb(181, 206, 168)">04</span><span class="token plain">:</span><span class="token number" style="color:rgb(181, 206, 168)">47</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain">     price</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain">     </span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">sum_of_volumes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">     </span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">big_changes                    </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;default.big_changes_mv&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;default.sum_of_volumes_mv&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example results above <code>default.big_changes_mv</code> and <code>default.sum_of_volumes_mv</code> are both materialized views.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/docs/knowledgebase/importing_and_working_with_JSON_array_objects">Importing and querying JSON array objects</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-24T00:00:00.000Z" itemprop="datePublished">March 24, 2023</time> · <!-- -->6 min read</div></header><div class="markdown" itemprop="articleBody"><p><strong>Question:</strong> How do I import JSON arrays and how can I query the inner objects?</p><p><strong>Answer:</strong></p><p>Dump this 1 line JSON array to <code>sample.json</code></p><div class="codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{&quot;_id&quot;:&quot;1&quot;,&quot;channel&quot;:&quot;help&quot;,&quot;events&quot;:[{&quot;eventType&quot;:&quot;open&quot;,&quot;time&quot;:&quot;2021-06-18T09:42:39.527Z&quot;},{&quot;eventType&quot;:&quot;close&quot;,&quot;time&quot;:&quot;2021-06-18T09:48:05.646Z&quot;}]},{&quot;_id&quot;:&quot;2&quot;,&quot;channel&quot;:&quot;help&quot;,&quot;events&quot;:[{&quot;eventType&quot;:&quot;open&quot;,&quot;time&quot;:&quot;2021-06-18T09:42:39.535Z&quot;},{&quot;eventType&quot;:&quot;edit&quot;,&quot;time&quot;:&quot;2021-06-18T09:42:41.317Z&quot;}]},{&quot;_id&quot;:&quot;3&quot;,&quot;channel&quot;:&quot;questions&quot;,&quot;events&quot;:[{&quot;eventType&quot;:&quot;close&quot;,&quot;time&quot;:&quot;2021-06-18T09:42:39.543Z&quot;},{&quot;eventType&quot;:&quot;create&quot;,&quot;time&quot;:&quot;2021-06-18T09:52:51.299Z&quot;}]},{&quot;_id&quot;:&quot;4&quot;,&quot;channel&quot;:&quot;general&quot;,&quot;events&quot;:[{&quot;eventType&quot;:&quot;create&quot;,&quot;time&quot;:&quot;2021-06-18T09:42:39.552Z&quot;},{&quot;eventType&quot;:&quot;edit&quot;,&quot;time&quot;:&quot;2021-06-18T09:47:29.109Z&quot;}]},{&quot;_id&quot;:&quot;5&quot;,&quot;channel&quot;:&quot;general&quot;,&quot;events&quot;:[{&quot;eventType&quot;:&quot;edit&quot;,&quot;time&quot;:&quot;2021-06-18T09:42:39.560Z&quot;},{&quot;eventType&quot;:&quot;open&quot;,&quot;time&quot;:&quot;2021-06-18T09:42:39.680Z&quot;},{&quot;eventType&quot;:&quot;close&quot;,&quot;time&quot;:&quot;2021-06-18T09:42:41.207Z&quot;},{&quot;eventType&quot;:&quot;edit&quot;,&quot;time&quot;:&quot;2021-06-18T09:42:43.372Z&quot;},{&quot;eventType&quot;:&quot;edit&quot;,&quot;time&quot;:&quot;2021-06-18T09:42:45.642Z&quot;}]}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Check the data:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhousebook</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">local</span><span class="token plain"> :</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">file</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;/path/to/sample.json&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;JSONEachRow&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">file</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;/path/to/sample.json&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;JSONEachRow&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain">bbfa09f</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ac7f</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain">a1e</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">9227</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">2961</span><span class="token plain">b5ffc2d4</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">┌─_id─┬─channel───┬─events─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> │ help      │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">{</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;eventType&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;open&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;time&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:39.527Z&#x27;</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">{</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;eventType&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;close&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;time&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:48:05.646Z&#x27;</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                                                                                                                                           │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> │ help      │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">{</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;eventType&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;open&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;time&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:39.535Z&#x27;</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">{</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;eventType&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;edit&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;time&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:41.317Z&#x27;</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                                                                                                                                            │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"> │ questions │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">{</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;eventType&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;close&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;time&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:39.543Z&#x27;</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">{</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;eventType&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;create&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;time&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:52:51.299Z&#x27;</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                                                                                                                                         │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain"> │ general   │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">{</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;eventType&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;create&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;time&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:39.552Z&#x27;</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">{</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;eventType&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;edit&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;time&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:47:29.109Z&#x27;</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                                                                                                                                          │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│   </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> │ general   │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">{</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;eventType&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;edit&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;time&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:39.560Z&#x27;</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">{</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;eventType&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;open&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;time&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:39.680Z&#x27;</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">{</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;eventType&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;close&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;time&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:41.207Z&#x27;</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">{</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;eventType&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;edit&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;time&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:43.372Z&#x27;</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">{</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;eventType&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;edit&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;time&#x27;</span><span class="token plain">:</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:45.642Z&#x27;</span><span class="token plain">}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">└─────┴───────────┴────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">rows</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">set</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Elapsed: </span><span class="token number" style="color:rgb(181, 206, 168)">0.001</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create a table to receive the JSON rows:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhousebook</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">local</span><span class="token plain"> :</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">EXISTS</span><span class="token plain"> sample_json_array </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">rawJSON</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> String EPHEMERAL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> String </span><span class="token keyword" style="color:rgb(86, 156, 214)">DEFAULT</span><span class="token plain"> JSONExtractString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rawJSON</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">channel</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> String </span><span class="token keyword" style="color:rgb(86, 156, 214)">DEFAULT</span><span class="token plain"> JSONExtractString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rawJSON</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;channel&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">actions</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">DEFAULT</span><span class="token plain"> JSONExtract</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rawJSON</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actions&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ENGINE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> MergeTree</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            channel</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">NOT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">EXISTS</span><span class="token plain"> sample_json_array</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">rawJSON</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> String EPHEMERAL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">_id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> String </span><span class="token keyword" style="color:rgb(86, 156, 214)">DEFAULT</span><span class="token plain"> JSONExtractString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rawJSON</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">channel</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> String </span><span class="token keyword" style="color:rgb(86, 156, 214)">DEFAULT</span><span class="token plain"> JSONExtractString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rawJSON</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;channel&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">actions</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">JSON</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">DEFAULT</span><span class="token plain"> JSONExtract</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rawJSON</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actions&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">ENGINE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> MergeTree</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> channel</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: e90c26e7</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">a950</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">4520</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">a517</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">6</span><span class="token plain">d437856f81d</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">rows</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">set</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Elapsed: </span><span class="token number" style="color:rgb(181, 206, 168)">0.173</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Insert the data:</p><div class="codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhousebook.local :) INSERT INTO</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            sample_json_array</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        SELECT</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            *</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        FROM</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            file(</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                &#x27;/opt/cases/000000/sample_json_arrays.json&#x27;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                &#x27;JSONEachRow&#x27;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            );</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">INSERT INTO sample_json_array SELECT *</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">FROM file(&#x27;/opt/cases/000000/sample.json&#x27;, &#x27;JSONEachRow&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: 60c4beab-3c2c-40c1-9c6f-bbbd7118dde3</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Ok.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">0 rows in set. Elapsed: 0.002 sec.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Check how the data inference acted on JSON object type:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhousebook</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">local</span><span class="token plain"> :</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">DESCRIBE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> sample_json_object_array SETTINGS describe_extend_object_types </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">DESCRIBE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> sample_json_object_array</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">SETTINGS describe_extend_object_types </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: a28c2850</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">885</span><span class="token plain">d</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain">c3a</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">b1bc</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">e5931909e89a</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">┌─name────┬─</span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain">────────────────────────────────────────┬─default_type─┬─default_expression─────────────────────┬─</span><span class="token keyword" style="color:rgb(86, 156, 214)">comment</span><span class="token plain">─┬─codec_expression─┬─ttl_expression─┐</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ rawJSON │ String                                      │ EPHEMERAL    │ defaultValueOfTypeName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;String&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">       │         │                  │                │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ _id     │ String                                      │ </span><span class="token keyword" style="color:rgb(86, 156, 214)">DEFAULT</span><span class="token plain">      │ JSONExtractString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rawJSON</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;_id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">      │         │                  │                │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ channel │ String                                      │ </span><span class="token keyword" style="color:rgb(86, 156, 214)">DEFAULT</span><span class="token plain">      │ JSONExtractString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rawJSON</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;channel&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">  │         │                  │                │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ events  │ Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Tuple</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">eventType String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> │ </span><span class="token keyword" style="color:rgb(86, 156, 214)">DEFAULT</span><span class="token plain">      │ JSONExtractArrayRaw</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rawJSON</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;events&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> │         │                  │                │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">└─────────┴─────────────────────────────────────────────┴──────────────┴────────────────────────────────────────┴─────────┴──────────────────┴────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>Events</code> is an <em>Array</em> of <code>Tuple</code> each containing a <em>eventType</em> <code>String</code> and a <em>time</em> <code>String</code> fields. This latter type is suboptimal (we&#x27;d want <code>DateTime</code> instead).</p><p>Let&#x27;s see the data:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhousebook</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">local</span><span class="token plain"> :</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            _id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            channel</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">eventType</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> sample_json_object_array</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token keyword" style="color:rgb(86, 156, 214)">WHERE</span><span class="token plain"> has</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">eventType</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;close&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    _id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    channel</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">eventType</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> sample_json_object_array</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">WHERE</span><span class="token plain"> has</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">eventType</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;close&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain">ddd6843</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">5206</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain">f52</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">971</span><span class="token plain">f</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">1699</span><span class="token plain">f0ba1728</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">┌─_id─┬─channel───┬─events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">eventType──────────────────────┬─events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token plain">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain">   │ general   │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;edit&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;open&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;close&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;edit&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;edit&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:39.560Z&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:39.680Z&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:41.207Z&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:43.372Z&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:45.642Z&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">   │ help      │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;open&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;close&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                      │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:39.527Z&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:48:05.646Z&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                                                                                  │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain">   │ questions │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;close&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;create&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                    │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:42:39.543Z&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18T09:52:51.299Z&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                                                                                  │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">└─────┴───────────┴───────────────────────────────────────┴──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">rows</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">set</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Elapsed: </span><span class="token number" style="color:rgb(181, 206, 168)">0.001</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s run a few queries:</p><p><code>_id</code> and <code>channel</code> of events that have an <code>eventType</code> of value <code>close</code></p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhousebook</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">local</span><span class="token plain"> :</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            _id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            channel</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">eventType</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            sample_json_object_array</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token keyword" style="color:rgb(86, 156, 214)">WHERE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            has</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">eventType</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;close&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    _id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    channel</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">eventType</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> sample_json_object_array</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">WHERE</span><span class="token plain"> has</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">eventType</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;close&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: </span><span class="token number" style="color:rgb(181, 206, 168)">033</span><span class="token plain">a0c56</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">7</span><span class="token plain">bfa</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">4261</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">a334</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">7323</span><span class="token plain">bdc40f87</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">┌─_id─┬─channel───┬─events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">eventType──────────────────────┐</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain">   │ general   │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;edit&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;open&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;close&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;edit&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;edit&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">   │ help      │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;open&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;close&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                      │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain">   │ questions │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;close&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;create&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                    │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">└─────┴───────────┴───────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">┌─_id─┬─channel───┬─events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">eventType──────────────────────┐</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain">   │ general   │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;edit&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;open&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;close&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;edit&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;edit&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">   │ help      │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;open&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;close&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                      │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain">   │ questions │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;close&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;create&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                    │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">└─────┴───────────┴───────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">6</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">rows</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">set</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Elapsed: </span><span class="token number" style="color:rgb(181, 206, 168)">0.001</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We want to query the <code>time</code> , for example all events between a given time range, but we notice it was imported as <code>String</code>:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhousebook</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">local</span><span class="token plain"> :</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> toTypeName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> sample_json_object_array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> toTypeName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> sample_json_object_array</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: </span><span class="token number" style="color:rgb(181, 206, 168)">27</span><span class="token plain">f07f02</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">66</span><span class="token plain">cd</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">420</span><span class="token plain">d</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">8623</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">eeed7d501014</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">┌─toTypeName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">─┐</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">           │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">           │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">           │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">           │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">           │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">└─────────────────────────┘</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">rows</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">set</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Elapsed: </span><span class="token number" style="color:rgb(181, 206, 168)">0.001</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So, in order to handle these as dates, first we want to convert to <code>DateTime</code>.
To convert an array we use a map function:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhousebook</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">local</span><span class="token plain"> :</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            _id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            channel</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            arrayMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain">parseDateTimeBestEffort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            sample_json_object_array</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    _id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    channel</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    arrayMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> parseDateTimeBestEffort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> sample_json_object_array</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: f3c7881e</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">b41c</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">4872</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">9</span><span class="token plain">c67</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain">c25966599a1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">┌─_id─┬─channel───┬─arrayMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">lambda</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">tuple</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> parseDateTimeBestEffort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">─────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain">   │ general   │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:42:39&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:47:29&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                                                                   │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain">   │ general   │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:42:39&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:42:39&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:42:41&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:42:43&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:42:45&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">   │ help      │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:42:39&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:48:05&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                                                                   │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain">   │ help      │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:42:39&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:42:41&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                                                                   │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain">   │ questions │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:42:39&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:52:51&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                                                                   │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">└─────┴───────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">rows</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">set</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Elapsed: </span><span class="token number" style="color:rgb(181, 206, 168)">0.001</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>we can appreciate the diffs using <code>toTypeName</code> on both the arrays:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhousebook</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">local</span><span class="token plain"> :</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            _id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            channel</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            toTypeName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> events_as_strings</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            toTypeName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">arrayMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain">parseDateTimeBestEffort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> events_as_datetime</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            sample_json_object_array</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    _id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    channel</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    toTypeName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> events_as_strings</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    toTypeName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">arrayMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> parseDateTimeBestEffort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> events_as_datetime</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> sample_json_object_array</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">af54994</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">b756</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">472</span><span class="token plain">f</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">88</span><span class="token plain">d7</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">8</span><span class="token plain">b5cdca0e54e</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">┌─_id─┬─channel───┬─events_as_strings─┬─events_as_datetime─┐</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain">   │ general   │ Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">     │ Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">    │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain">   │ general   │ Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">     │ Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">    │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">   │ help      │ Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">     │ Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">    │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain">   │ help      │ Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">     │ Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">    │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain">   │ questions │ Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">     │ Array</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">DateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">    │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">└─────┴───────────┴───────────────────┴────────────────────┘</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">rows</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">set</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Elapsed: </span><span class="token number" style="color:rgb(181, 206, 168)">0.001</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>now let&#x27;s get the <code>id</code> of  of the rows where <code>time</code> is between a given interval.</p><p>we use <code>arrayCount</code> to see if there is a count greater than than 0 of items in the array returned by the map function that will match the condition <code>x BETWEEN toDateTime(&#x27;2021-06-18 11:46:00&#x27;, &#x27;Europe/Rome&#x27;) AND toDateTime(&#x27;2021-06-18 11:50:00&#x27;, &#x27;Europe/Rome&#x27;)</code></p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhousebook</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">local</span><span class="token plain"> :</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            _id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            arrayMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> parseDateTimeBestEffort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            sample_json_object_array</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                        </span><span class="token keyword" style="color:rgb(86, 156, 214)">WHERE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            arrayCount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                x </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(212, 212, 212)">BETWEEN</span><span class="token plain"> toDateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:46:00&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Europe/Rome&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                </span><span class="token operator" style="color:rgb(212, 212, 212)">AND</span><span class="token plain"> toDateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:50:00&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Europe/Rome&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                                arrayMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> parseDateTimeBestEffort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    _id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    arrayMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> parseDateTimeBestEffort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> sample_json_object_array</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">WHERE</span><span class="token plain"> arrayCount</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;=</span><span class="token plain"> toDateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:46:00&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Europe/Rome&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">AND</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;=</span><span class="token plain"> toDateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:50:00&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Europe/Rome&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> arrayMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> parseDateTimeBestEffort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: d4882fc3</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">9</span><span class="token plain">f99</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain">e87</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">9</span><span class="token plain">f89</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">47683</span><span class="token plain">f10656d</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">┌─_id─┬─arrayMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">lambda</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">tuple</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> parseDateTimeBestEffort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> events</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">─┐</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain">   │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:42:39&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:47:29&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                       │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">   │ </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:42:39&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2021-06-18 11:48:05&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">                       │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">└─────┴─────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">rows</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">set</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Elapsed: </span><span class="token number" style="color:rgb(181, 206, 168)">0.002</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>⚠️</p><p>Please remember, at the time of writing this article the current implementation of JSON is experimental and not suited for production.</p><p>This example highlights how to quickly import JSON and start querying it and represents a tradeoff between the ease of use where we import the JSON objects as <code>JSON</code> type with no need to specify upfront the schema type. Convenient for a quick test however for long term use of the data we would like to, with regards to this example to store the data using the most appropriate types, so for the <code>time</code> field, use <code>DateTime</code> instead of <code>String</code>, in order to avoid any post-ingestion phase conversion as illustrated above. Please refer to the <a href="https://clickhouse.com/docs/en/integrations/data-formats/json" target="_blank" rel="noopener noreferrer">documentation</a> for more about handling JSON.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/docs/knowledgebase/recreate_table_across_terminals">How to quickly recreate a small table across different terminals</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-24T00:00:00.000Z" itemprop="datePublished">March 24, 2023</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><p><strong>Question:</strong></p><p>How can I quickly recreate a table and its data using just copy/paste across different terminals?</p><p><strong>Answer:</strong></p><p>This is NOT a recommended practice to migrate data from one database to another and it should NOT be used for production data migration.</p><p>This is simply intended as a quick and dirty way to recreate small amount of data when developing across multiple environments.</p><ol><li>Get the CREATE TABLE statement with <code>SHOW CREATE table</code>:</li></ol><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SHOW</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> cookies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SHOW</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> cookies</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: </span><span class="token number" style="color:rgb(181, 206, 168)">248</span><span class="token plain">ec8e2</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain">bce</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">45</span><span class="token plain">b3</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">97</span><span class="token plain">d9</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ed68edf445a5</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">┌─statement────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ </span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">cookies</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">timestamp</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">DateTime</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">ENGINE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> MergeTree</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">SETTINGS index_granularity </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">8192</span><span class="token plain"> │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Get the data export using <code>FORMAT SQLInsert</code></li></ol><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> cookies FORMAT SQLInsert</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> cookies</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">FORMAT SQLInsert</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: </span><span class="token number" style="color:rgb(181, 206, 168)">383759</span><span class="token plain">b8</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">69</span><span class="token plain">c0</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">4561</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">ab95</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">f8224abc0071</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">table</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">timestamp</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;4&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2023-03-15 16:28:46&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2023-03-15 16:28:41&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;1&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2023-03-15 16:11:02&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;1&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2023-03-15 16:11:40&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;1&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2023-03-15 16:11:48&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;1&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2023-03-15 16:16:05&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2023-03-15 16:11:06&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;3&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2023-03-15 16:11:12&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;3&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2023-03-15 16:11:45&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;3&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2023-03-15 16:16:08&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;4&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2023-03-15 16:11:14&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;4&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2023-03-15 16:11:50&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;4&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2023-03-15 16:16:01&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;5&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2023-03-15 16:11:18&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;5&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2023-03-15 16:16:11&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">rows</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">set</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Elapsed: </span><span class="token number" style="color:rgb(181, 206, 168)">0.023</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note you will need to replace the name <code>table</code> at point 2 with the actual table name (<code>cookies</code> in this example)</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/docs/knowledgebase/s3_export_data_year_month_folders">How can I do partitioned writes by year and month on S3?</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-24T00:00:00.000Z" itemprop="datePublished">March 24, 2023</time> · <!-- -->One min read</div></header><div class="markdown" itemprop="articleBody"><p>I want to export data segregating the path in S3 bucket to follow a structure like:</p><ul><li>2022<ul><li>1</li><li>2</li><li>...</li><li>12</li></ul></li><li>2021<ul><li>1</li><li>2</li><li>...</li><li>12</li></ul></li></ul><p>and so on ...</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="answer">Answer<a href="#answer" class="hash-link" aria-label="Direct link to Answer" title="Direct link to Answer">​</a></h3><p>Considering the ClickHouse table:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> sample_data </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">age</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">Int</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token identifier">time</span><span class="token identifier punctuation" style="color:rgb(212, 212, 212)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">DateTime</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ENGINE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> MergeTree</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Add 10000 entries:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    sample_data</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    generateRandom</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;name String, age Int, time DateTime&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token number" style="color:rgb(181, 206, 168)">10000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Run this to create the desired structure in s3 bucket <code>my_bucket</code> (note this example writes files in parquet format):</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">FUNCTION</span><span class="token plain"> s3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;https://s3-host:4321/my_bucket/{_partition_id}/file.parquet.gz&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;s3-access-key&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;s3-secret-access-key&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        Parquet</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;name String, age Int, time DateTime&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        formatDateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;%Y&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;/&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        formatDateTime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;%m&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    age</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    sample_data</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: </span><span class="token number" style="color:rgb(181, 206, 168)">55</span><span class="token plain">adcf22</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">f6af</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">491</span><span class="token plain">e</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">b697</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d09694bbcc56</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Ok</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">rows</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">in</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">set</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Elapsed: </span><span class="token number" style="color:rgb(181, 206, 168)">15.579</span><span class="token plain"> sec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"> Processed </span><span class="token number" style="color:rgb(181, 206, 168)">10.00</span><span class="token plain"> thousand </span><span class="token keyword" style="color:rgb(86, 156, 214)">rows</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">219.93</span><span class="token plain"> KB </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">641.87</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">rows</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">14.12</span><span class="token plain"> KB</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/docs/knowledgebase/which-processes-are-currently-running">How to check what code is currently running on a server?</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-24T00:00:00.000Z" itemprop="datePublished">March 24, 2023</time> · <!-- -->3 min read</div></header><div class="markdown" itemprop="articleBody"><p>ClickHouse has a built-in debugger and introspection capabilities. For example, you can get the stack traces of every server&#x27;s thread at runtime by querying the <code>system.stack_trace</code> table:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    arrayStringConcat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">arrayMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">demangle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">addressToSymbol</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;\n    &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> addressToLine</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> trace</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;\n&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">AS</span><span class="token plain"> sym</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> system</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">stack_trace</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> trace</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">count</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">DESC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">FORMAT Vertical</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">SETTINGS allow_introspection_functions </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The query result will show the locations in the ClickHouse source code where the threads are running or waiting. (You will need to set <code>allow_introspection_functions</code> to <code>1</code> to enable the <a href="https://clickhouse.com/docs/en/sql-reference/functions/introspection" target="_blank" rel="noopener noreferrer">introspection functions</a>.) The response looks like:</p><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">Row 1:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">──────</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">count(): 144</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sym:     pthread_cond_wait</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">DB::BackgroundSchedulePool::threadFunction()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ThreadPoolImpl&lt;std::__1::thread&gt;::worker(std::__1::__list_iterator&lt;std::__1::thread, void*&gt;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">clone</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Row 2:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">──────</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">count(): 80</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sym:     pthread_cond_wait</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">std::__1::condition_variable::wait(std::__1::unique_lock&lt;std::__1::mutex&gt;&amp;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">DB::MergeTreeBackgroundExecutor&lt;DB::OrdinaryRuntimeQueue&gt;::threadFunction()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ThreadPoolImpl&lt;ThreadFromGlobalPoolImpl&lt;false&gt;&gt;::worker(std::__1::__list_iterator&lt;ThreadFromGlobalPoolImpl&lt;false&gt;, void*&gt;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">void std::__1::__function::__policy_invoker&lt;void ()&gt;::__call_impl&lt;std::__1::__function::__default_alloc_func&lt;ThreadFromGlobalPoolImpl&lt;false&gt;::ThreadFromGlobalPoolImpl&lt;void ThreadPoolImpl&lt;ThreadFromGlobalPoolImpl&lt;false&gt;&gt;::scheduleImpl&lt;void&gt;(std::__1::function&lt;void ()&gt;, long, std::__1::optional&lt;unsigned long&gt;, bool)::&#x27;lambda0&#x27;()&gt;(void&amp;&amp;)::&#x27;lambda&#x27;(), void ()&gt;&gt;(std::__1::__function::__policy_storage const*)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ThreadPoolImpl&lt;std::__1::thread&gt;::worker(std::__1::__list_iterator&lt;std::__1::thread, void*&gt;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">clone</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Row 3:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">──────</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">count(): 55</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sym:     pthread_cond_wait</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ThreadPoolImpl&lt;ThreadFromGlobalPoolImpl&lt;false&gt;&gt;::worker(std::__1::__list_iterator&lt;ThreadFromGlobalPoolImpl&lt;false&gt;, void*&gt;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">void std::__1::__function::__policy_invoker&lt;void ()&gt;::__call_impl&lt;std::__1::__function::__default_alloc_func&lt;ThreadFromGlobalPoolImpl&lt;false&gt;::ThreadFromGlobalPoolImpl&lt;void ThreadPoolImpl&lt;ThreadFromGlobalPoolImpl&lt;false&gt;&gt;::scheduleImpl&lt;void&gt;(std::__1::function&lt;void ()&gt;, long, std::__1::optional&lt;unsigned long&gt;, bool)::&#x27;lambda0&#x27;()&gt;(void&amp;&amp;)::&#x27;lambda&#x27;(), void ()&gt;&gt;(std::__1::__function::__policy_storage const*)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ThreadPoolImpl&lt;std::__1::thread&gt;::worker(std::__1::__list_iterator&lt;std::__1::thread, void*&gt;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">clone</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Row 4:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">──────</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">count(): 16</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sym:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">DB::AsynchronousInsertQueue::processBatchDeadlines(unsigned long)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ThreadPoolImpl&lt;std::__1::thread&gt;::worker(std::__1::__list_iterator&lt;std::__1::thread, void*&gt;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">clone</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Row 5:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">──────</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">count(): 16</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sym:     pthread_cond_wait</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">std::__1::condition_variable::wait(std::__1::unique_lock&lt;std::__1::mutex&gt;&amp;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">DB::MergeTreeBackgroundExecutor&lt;DB::MergeMutateRuntimeQueue&gt;::threadFunction()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ThreadPoolImpl&lt;ThreadFromGlobalPoolImpl&lt;false&gt;&gt;::worker(std::__1::__list_iterator&lt;ThreadFromGlobalPoolImpl&lt;false&gt;, void*&gt;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">void std::__1::__function::__policy_invoker&lt;void ()&gt;::__call_impl&lt;std::__1::__function::__default_alloc_func&lt;ThreadFromGlobalPoolImpl&lt;false&gt;::ThreadFromGlobalPoolImpl&lt;void ThreadPoolImpl&lt;ThreadFromGlobalPoolImpl&lt;false&gt;&gt;::scheduleImpl&lt;void&gt;(std::__1::function&lt;void ()&gt;, long, std::__1::optional&lt;unsigned long&gt;, bool)::&#x27;lambda0&#x27;()&gt;(void&amp;&amp;)::&#x27;lambda&#x27;(), void ()&gt;&gt;(std::__1::__function::__policy_storage const*)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ThreadPoolImpl&lt;std::__1::thread&gt;::worker(std::__1::__list_iterator&lt;std::__1::thread, void*&gt;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">clone</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Row 6:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">──────</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">count(): 10</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sym:     poll</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Poco::Net::SocketImpl::pollImpl(Poco::Timespan&amp;, int)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Poco::Net::SocketImpl::poll(Poco::Timespan const&amp;, int)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Poco::Net::TCPServer::run()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Poco::ThreadImpl::runnableEntry(void*)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">clone</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Row 7:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">──────</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">count(): 9</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sym:     pthread_cond_wait</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ThreadPoolImpl&lt;std::__1::thread&gt;::worker(std::__1::__list_iterator&lt;std::__1::thread, void*&gt;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">clone</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Row 8:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">──────</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">count(): 7</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sym:     poll</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Poco::Net::SocketImpl::pollImpl(Poco::Timespan&amp;, int)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Poco::Net::SocketImpl::poll(Poco::Timespan const&amp;, int)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">DB::ReadBufferFromPocoSocket::poll(unsigned long) const</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">DB::TCPHandler::runImpl()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">DB::TCPHandler::run()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Poco::Net::TCPServerConnection::start()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Poco::Net::TCPServerDispatcher::run()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Poco::PooledThread::run()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Poco::ThreadImpl::runnableEntry(void*)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">clone</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Row 9:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">───────</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">count(): 3</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sym:     pthread_cond_wait</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Poco::EventImpl::waitImpl()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">DB::DDLWorker::runCleanupThread()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">void std::__1::__function::__policy_invoker&lt;void ()&gt;::__call_impl&lt;std::__1::__function::__default_alloc_func&lt;ThreadFromGlobalPoolImpl&lt;true&gt;::ThreadFromGlobalPoolImpl&lt;void (DB::DDLWorker::*)(), DB::DDLWorker*&gt;(void (DB::DDLWorker::*&amp;&amp;)(), DB::DDLWorker*&amp;&amp;)::&#x27;lambda&#x27;(), void ()&gt;&gt;(std::__1::__function::__policy_storage const*)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ThreadPoolImpl&lt;std::__1::thread&gt;::worker(std::__1::__list_iterator&lt;std::__1::thread, void*&gt;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">clone</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Row 10:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">───────</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">count(): 3</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">sym:     pthread_cond_wait</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Poco::EventImpl::waitImpl()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">DB::DDLWorker::runMainThread()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">void std::__1::__function::__policy_invoker&lt;void ()&gt;::__call_impl&lt;std::__1::__function::__default_alloc_func&lt;ThreadFromGlobalPoolImpl&lt;true&gt;::ThreadFromGlobalPoolImpl&lt;void (DB::DDLWorker::*)(), DB::DDLWorker*&gt;(void (DB::DDLWorker::*&amp;&amp;)(), DB::DDLWorker*&amp;&amp;)::&#x27;lambda&#x27;(), void ()&gt;&gt;(std::__1::__function::__policy_storage const*)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ThreadPoolImpl&lt;std::__1::thread&gt;::worker(std::__1::__list_iterator&lt;std::__1::thread, void*&gt;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /usr/bin/clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">clone</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">10 rows in set. Elapsed: 0.026 sec.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div><div class="alert-content admonitionContent_vXIg"><div class="admonitionHeading_TMsN">note</div><p>If you installed ClickHouse from a <strong>.deb/.rpm/.tgz</strong> you can also install the package with the debug info to see the line numbers from the source code:</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token function" style="color:rgb(220, 220, 170)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">install</span><span class="token plain"> clickhouse-common-static-dbg</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you&#x27;ve installed ClickHouse as a single-binary, it already contains the debug info.</p></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></div><div class="alert-content admonitionContent_vXIg"><div class="admonitionHeading_TMsN">tip</div><p>For more high-level information, check out some of these other system tables:</p><ul><li><a href="https://clickhouse.com/docs/en/operations/system-tables/processes" target="_blank" rel="noopener noreferrer">system.processes</a></li><li><a href="https://clickhouse.com/docs/en/operations/system-tables/query_log" target="_blank" rel="noopener noreferrer">system.query_log</a></li><li><a href="https://clickhouse.com/docs/en/operations/system-tables/metric_log" target="_blank" rel="noopener noreferrer">system.metric_log</a></li><li><a href="https://clickhouse.com/docs/en/operations/system-tables/asynchronous_metric_log" target="_blank" rel="noopener noreferrer">system.asynchronous_metric_log</a></li><li><a href="https://clickhouse.com/docs/en/operations/system-tables/trace_log" target="_blank" rel="noopener noreferrer">system.trace_log</a></li><li><a href="https://clickhouse.com/docs/en/operations/system-tables/processors_profile_log" target="_blank" rel="noopener noreferrer">system.processor_profile_log</a></li></ul><p>And there is handy info in the <a href="https://clickhouse.com/docs/en/operations/system-tables" target="_blank" rel="noopener noreferrer">other system tables</a> also.</p></div></div></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/docs/knowledgebase/file-export">How do I export data from ClickHouse to a file?</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-22T00:00:00.000Z" itemprop="datePublished">March 22, 2023</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-into-outfile-clause">Using INTO OUTFILE Clause<a href="#using-into-outfile-clause" class="hash-link" aria-label="Direct link to Using INTO OUTFILE Clause" title="Direct link to Using INTO OUTFILE Clause">​</a></h2><p>Add an <a href="https://clickhouse.com/docs/en/sql-reference/statements/select/into-outfile.md" target="_blank" rel="noopener noreferrer">INTO OUTFILE</a> clause to your query.</p><p>For example:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">table</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTFILE</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;file&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>By default, ClickHouse uses the file extension of the filename to deteremine the output format and compression. For example, all of the rows in <code>nyc_taxi</code> will be exported to the <code>nyc_taxi.parquet</code> using the Parquet format:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> nyc_taxi</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTFILE</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;taxi_rides.parquet&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And the following file will be a compressed, tab-separated file:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> nyc_taxi</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTFILE</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;taxi_rides.tsv.gz&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If ClickHouse can not determine the format from the file extension, then the output format defaults to <a href="https://clickhouse.com/docs/en/interfaces/formats.md" target="_blank" rel="noopener noreferrer">TabSeparated</a> for output data. To specify the <a href="https://clickhouse.com/docs/en/interfaces/formats.md" target="_blank" rel="noopener noreferrer">output format</a>, use the <a href="https://clickhouse.com/docs/en/sql-reference/statements/select/format.md" target="_blank" rel="noopener noreferrer">FORMAT clause</a>.</p><p>For example:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> nyc_taxi</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTFILE</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;taxi_rides.txt&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">FORMAT CSV</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-a-file-engine-table">Using the File table engine<a href="#using-a-file-engine-table" class="hash-link" aria-label="Direct link to Using the File table engine" title="Direct link to Using the File table engine">​</a></h2><p>Another option is to use the <a href="https://clickhouse.com/docs/en/engines/table-engines/special/file" target="_blank" rel="noopener noreferrer">File</a> table engine, where ClickHouse uses the file to store the data. You can perform queries and inserts directly on the file.</p><p>For example:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> my_table </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   x UInt32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   y String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   z </span><span class="token keyword" style="color:rgb(86, 156, 214)">DateTime</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">ENGINE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">File</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Parquet</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Insert a few rows:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> my_table </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUES</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Hello&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">now</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;World&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">now</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Goodbye&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">now</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The file is stored in the <code>data</code> folder of your ClickHouse server - specifically in <code>/data/default/my_table</code> in a file named <code>data.Parquet</code>.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div><div class="alert-content admonitionContent_vXIg"><div class="admonitionHeading_TMsN">note</div><p>Using the <code>File</code> table engine is incredibly handy for creating and querying files on your file system, but keep in mind that <code>File</code> tables are not <code>MergeTree</code> tables, so you don&#x27;t get all the benefits that come with <code>MergeTree</code>. Use <code>File</code> for convenience when exporting data out of ClickHouse in convenient formats.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-command-line-redirection">Using Command-Line Redirection<a href="#using-command-line-redirection" class="hash-link" aria-label="Direct link to Using Command-Line Redirection" title="Direct link to Using Command-Line Redirection">​</a></h2><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ clickhouse-client --query </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;SELECT * from table&quot;</span><span class="token plain"> --format FormatName </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> result.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>See <a href="https://clickhouse.com/docs/en/interfaces/cli.md" target="_blank" rel="noopener noreferrer">clickhouse-client</a>.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/docs/knowledgebase/ingest-parquet-files-in-s3">How to ingest Parquet files from an S3 bucket</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-22T00:00:00.000Z" itemprop="datePublished">March 22, 2023</time> · <!-- -->3 min read</div></header><div class="markdown" itemprop="articleBody"><p>Below are some basics of using the S3 table engine to read parquet files.</p><ul><li><p>create access and secret keys for an IAM service user.
normal login users usually don&#x27;t work since they may have been configured with an MFA policy.</p></li><li><p>set the permissions on the policy to allow the service user to access the bucket and folders.</p></li></ul><p>The following is a very simple example that you can use to test the mechanics of accessing your parquet files successfully prior to applying to your actual data.</p><p>If you need an example of creating a user and bucket, you can follow the first two sections (create user and create bucket):
<a href="https://clickhouse.com/docs/en/guides/sre/configuring-s3-for-clickhouse-use/" target="_blank" rel="noopener noreferrer">https://clickhouse.com/docs/en/guides/sre/configuring-s3-for-clickhouse-use/</a></p><p>I used this sample file: <a href="https://github.com/Teradata/kylo/tree/master/samples/sample-data/parquet" target="_blank" rel="noopener noreferrer">https://github.com/Teradata/kylo/tree/master/samples/sample-data/parquet</a>
and uploaded it to my test bucket</p><p>You can set the policy something like this on the bucket:
(adjust as needed, this one is fairly open for privileges but will help in testing. you can narrow your permissions as necessary)</p><div class="codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &quot;Id&quot;: &quot;Policy123456&quot;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    &quot;Statement&quot;: [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            &quot;Sid&quot;: &quot;abc123&quot;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            &quot;Principal&quot;: {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                &quot;AWS&quot;: [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    &quot;arn:aws:iam::1234567890:user/mars-s3-user&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                ]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            &quot;Action&quot;: &quot;s3:*&quot;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            &quot;Resource&quot;: [</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                &quot;arn:aws:s3:::mars-doc-test&quot;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                &quot;arn:aws:s3:::mars-doc-test/*&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            ]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can run queries with this type of syntax using the S3 table engine:
<a href="https://clickhouse.com/docs/en/sql-reference/table-functions/s3/" target="_blank" rel="noopener noreferrer">https://clickhouse.com/docs/en/sql-reference/table-functions/s3/</a></p><div class="codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-cloud :)  select count(*) from s3(&#x27;https://mars-doc-test.s3.amazonaws.com/s3-parquet-test/userdata1.parquet&#x27;,&#x27;ABC123&#x27;, &#x27;abc+123&#x27;, &#x27;Parquet&#x27;, &#x27;first_name String&#x27;);</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">SELECT count(*)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">FROM s3(&#x27;https://mars-doc-test.s3.amazonaws.com/s3-parquet-test/userdata1.parquet&#x27;, &#x27;ABC123&#x27;, &#x27;abc+123&#x27;, &#x27;Parquet&#x27;, &#x27;first_name String&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: fd4f1193-d604-4ac0-9a46-bdd2d5e14727</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">┌─count()─┐</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│    1000 │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">└─────────┘</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">1 row in set. Elapsed: 1.274 sec. Processed 1.00 thousand rows, 14.64 KB (784.81 rows/s., 11.49 KB/s.)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The data types reference for parquet format are here:
<a href="https://clickhouse.com/docs/en/interfaces/formats/#data-format-parquet" target="_blank" rel="noopener noreferrer">https://clickhouse.com/docs/en/interfaces/formats/#data-format-parquet</a></p><p>To bring in the data into a native ClickHouse table:</p><p>create the table, something like this (just chose a couple of the columns in the parquet file):</p><div class="codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-cloud :) CREATE TABLE my_parquet_table (id UInt64, first_name String) ENGINE = MergeTree ORDER BY id;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">CREATE TABLE my_parquet_table</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">(</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    `id` UInt64,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    `first_name` String</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ENGINE = MergeTree</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ORDER BY id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: 412e3994-bf8e-444e-ac43-a7c82642b7da</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Ok.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">0 rows in set. Elapsed: 0.600 sec.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Select the data from the S3 bucket to insert into the new table:</p><div class="codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-cloud :) INSERT INTO my_parquet_table (id, first_name) SELECT id, first_name FROM s3(&#x27;https://mars-doc-test.s3.amazonaws.com/s3-parquet-test/userdata1.parquet&#x27;, &#x27;ABC123&#x27;,&#x27;abc+123&#x27;, &#x27;Parquet&#x27;, &#x27;id UInt64, first_name String&#x27;) FORMAT Parquet</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">INSERT INTO my_parquet_table (id, first_name) SELECT</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    id,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    first_name</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">FROM s3(&#x27;https://mars-doc-test.s3.amazonaws.com/s3-parquet-test/userdata1.parquet&#x27;, &#x27;ABC123&#x27;, &#x27;abc+123&#x27;, &#x27;Parquet&#x27;, &#x27;id UInt64, first_name String&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: c3cdc871-f338-462d-8797-6751b45a0b58</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Ok.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">0 rows in set. Elapsed: 1.220 sec. Processed 1.00 thousand rows, 22.64 KB (819.61 rows/s., 18.56 KB/s.)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify the import:</p><div class="codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-cloud :) SELECT * FROM my_parquet_table LIMIT 10;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">SELECT *</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">FROM my_parquet_table</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">LIMIT 10</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Query id: 1ccf59dd-d804-46a9-aadd-ed5c57b9e1a0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">┌─id─┬─first_name─┐</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│  1 │ Amanda     │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│  2 │ Albert     │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│  3 │ Evelyn     │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│  4 │ Denise     │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│  5 │ Carlos     │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│  6 │ Kathryn    │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│  7 │ Samuel     │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│  8 │ Harry      │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│  9 │ Jose       │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">│ 10 │ Emily      │</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">└────┴────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When you are ready to import your real data, you can use some special syntax like wildcards and ranges to specify your folders, subfolders and files in your bucket.
I&#x27;d recommend to filter a few directories and files to test the import, maybe a certain year, a couple months and some date range to test first.</p><p>besides the path options here, newly released is syntax <code>**</code> which specifies all subdirectories recursively.
<a href="https://clickhouse.com/docs/en/sql-reference/table-functions/s3/" target="_blank" rel="noopener noreferrer">https://clickhouse.com/docs/en/sql-reference/table-functions/s3/</a></p><p>For example, assuming the paths and bucket structure is something like this:
<code>https://your_s3_bucket.s3.amazonaws.com/&lt;your_folder&gt;/&lt;year&gt;/&lt;month&gt;/&lt;day&gt;/&lt;filename&gt;.parquet</code>
<code>https://mars-doc-test.s3.amazonaws.com/system_logs/2022/11/01/my-app-logs-0001.parquet</code></p><p>This would get all files for 1st day of every month in 2021-2022
<code>https://mars-doc-test.s3.amazonaws.com/system_logs/{2021-2022}/**/01/*.parquet</code></p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/docs/knowledgebase/parquet-to-csv-json">Converting Files from Parquet to CSV or JSON</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-03-22T00:00:00.000Z" itemprop="datePublished">March 22, 2023</time> · <!-- -->3 min read</div></header><div class="markdown" itemprop="articleBody"><p>You can use <code>clickhouse-local</code> to convert files between any of the <a href="https://clickhouse.com/docs/en/interfaces/formats" target="_blank" rel="noopener noreferrer">input and output formats</a> that ClickHouse supports (which is over 70 different formats!). In this article, we are convert a Parquet file in S3 into a CSV and JSON file.</p><p>Let&#x27;s start at the beginning. ClickHouse has a collection of <a href="https://clickhouse.com/docs/en/sql-reference/table-functions/" target="_blank" rel="noopener noreferrer">table functions</a> that read from files, databases and other resoures and converts the data to a table. To demonstrate, suppose we have a Parquet file in S3. We will use the <code>s3</code> table function to read it (ClickHouse knows it&#x27;s a Parquet file based on the filename).</p><p>But first, let&#x27;s download the <code>clickhouse</code> binary:</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token function" style="color:rgb(220, 220, 170)">curl</span><span class="token plain"> https://clickhouse.com/ </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="accessing-the-data-using-a-table-function">Accessing the data using a table function<a href="#accessing-the-data-using-a-table-function" class="hash-link" aria-label="Direct link to Accessing the data using a table function" title="Direct link to Accessing the data using a table function">​</a></h2><p>Let&#x27;s verify we can read the file by using <code>DESCRIBE</code> on the resulting table that the <code>s3</code> table function creates:</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">./clickhouse </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">local</span><span class="token plain"> -q </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;DESCRIBE s3(&#x27;https://datasets-documentation.s3.eu-west-3.amazonaws.com/house_parquet/house_0.parquet&#x27;)&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This particular file contains home prices of properties sold in the United Kingdom. The response looks like:</p><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">price   Nullable(Int64)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">date    Nullable(UInt16)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">postcode1   Nullable(String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">postcode2   Nullable(String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">type    Nullable(String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">is_new  Nullable(UInt8)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">duration    Nullable(String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">addr1   Nullable(String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">addr2   Nullable(String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">street  Nullable(String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">locality    Nullable(String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">town    Nullable(String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">district    Nullable(String)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">county  Nullable(String)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can run any query you want on the data. For example, let&#x27;s see which towns have the highest average price of homes:</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">./clickhouse </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">local</span><span class="token plain"> -q </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;SELECT</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">   town,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">   avg(price) AS avg_price</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">FROM s3(&#x27;https://datasets-documentation.s3.eu-west-3.amazonaws.com/house_parquet/house_0.parquet&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">GROUP BY town</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">ORDER BY avg_price DESC</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">LIMIT 10&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The response looks like:</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">GATWICK </span><span class="token number" style="color:rgb(181, 206, 168)">16818750</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">CHALFONT ST GILES   </span><span class="token number" style="color:rgb(181, 206, 168)">938090.0985915493</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">VIRGINIA WATER  </span><span class="token number" style="color:rgb(181, 206, 168)">789301.1320224719</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">COBHAM  </span><span class="token number" style="color:rgb(181, 206, 168)">699874.7111622555</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">BEACONSFIELD    </span><span class="token number" style="color:rgb(181, 206, 168)">677247.5483146068</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ESHER   </span><span class="token number" style="color:rgb(181, 206, 168)">616004.6888297872</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">KESTON  </span><span class="token number" style="color:rgb(181, 206, 168)">607585.8597560975</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">GERRARDS CROSS  </span><span class="token number" style="color:rgb(181, 206, 168)">566330.2959086584</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">ASCOT   </span><span class="token number" style="color:rgb(181, 206, 168)">551491.2975753123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">WEYBRIDGE   </span><span class="token number" style="color:rgb(181, 206, 168)">548974.828692494</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="convert-the-parquet-file-to-a-csv">Convert the Parquet file to a CSV<a href="#convert-the-parquet-file-to-a-csv" class="hash-link" aria-label="Direct link to Convert the Parquet file to a CSV" title="Direct link to Convert the Parquet file to a CSV">​</a></h2><p>You can send the result of any SQL query to a file. Let&#x27;s grab all the columns from our Parquet file in S3 and send the output to a new CSV file. Because the output file ends in <code>.csv</code>, ClickHouse knows to use the <code>CSV</code> output format:</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">./clickhouse </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">local</span><span class="token plain"> -q </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;SELECT *</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">FROM s3(&#x27;https://datasets-documentation.s3.eu-west-3.amazonaws.com/house_parquet/house_0.parquet&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">INTO OUTFILE &#x27;house_prices.csv&#x27;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s verify it worked:</p><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ tail house_prices.csv</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">70000,10508,&quot;YO8&quot;,&quot;9XN&quot;,&quot;detached&quot;,0,&quot;freehold&quot;,&quot;7&quot;,&quot;&quot;,&quot;POPPY CLOSE&quot;,&quot;SELBY&quot;,&quot;SELBY&quot;,&quot;SELBY&quot;,&quot;NORTH YORKSHIRE&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">130000,14274,&quot;YO8&quot;,&quot;9XP&quot;,&quot;detached&quot;,0,&quot;freehold&quot;,&quot;10&quot;,&quot;&quot;,&quot;HEATHER CLOSE&quot;,&quot;&quot;,&quot;SELBY&quot;,&quot;SELBY&quot;,&quot;NORTH YORKSHIRE&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">150000,18180,&quot;YO8&quot;,&quot;9XP&quot;,&quot;detached&quot;,0,&quot;freehold&quot;,&quot;11&quot;,&quot;&quot;,&quot;HEATHER CLOSE&quot;,&quot;&quot;,&quot;SELBY&quot;,&quot;SELBY&quot;,&quot;NORTH YORKSHIRE&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">157000,18088,&quot;YO8&quot;,&quot;9XP&quot;,&quot;detached&quot;,0,&quot;freehold&quot;,&quot;12&quot;,&quot;&quot;,&quot;HEATHER CLOSE&quot;,&quot;&quot;,&quot;SELBY&quot;,&quot;SELBY&quot;,&quot;NORTH YORKSHIRE&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">134000,17333,&quot;YO8&quot;,&quot;9XP&quot;,&quot;semi-detached&quot;,0,&quot;freehold&quot;,&quot;16&quot;,&quot;&quot;,&quot;HEATHER CLOSE&quot;,&quot;&quot;,&quot;SELBY&quot;,&quot;SELBY&quot;,&quot;NORTH YORKSHIRE&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">250000,13405,&quot;YO8&quot;,&quot;9YA&quot;,&quot;detached&quot;,0,&quot;freehold&quot;,&quot;6&quot;,&quot;&quot;,&quot;YORKDALE COURT&quot;,&quot;HAMBLETON&quot;,&quot;SELBY&quot;,&quot;SELBY&quot;,&quot;NORTH YORKSHIRE&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">59500,11166,&quot;YO8&quot;,&quot;9YB&quot;,&quot;semi-detached&quot;,0,&quot;freehold&quot;,&quot;4&quot;,&quot;&quot;,&quot;YORKDALE DRIVE&quot;,&quot;HAMBLETON&quot;,&quot;SELBY&quot;,&quot;SELBY&quot;,&quot;NORTH YORKSHIRE&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">142500,17648,&quot;YO8&quot;,&quot;9YB&quot;,&quot;semi-detached&quot;,0,&quot;freehold&quot;,&quot;4A&quot;,&quot;&quot;,&quot;YORKDALE DRIVE&quot;,&quot;HAMBLETON&quot;,&quot;SELBY&quot;,&quot;SELBY&quot;,&quot;NORTH YORKSHIRE&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">230000,15125,&quot;YO8&quot;,&quot;9YD&quot;,&quot;detached&quot;,0,&quot;freehold&quot;,&quot;1&quot;,&quot;&quot;,&quot;ONE ACRE GARTH&quot;,&quot;HAMBLETON&quot;,&quot;SELBY&quot;,&quot;SELBY&quot;,&quot;NORTH YORKSHIRE&quot;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">250000,15950,&quot;YO8&quot;,&quot;9YD&quot;,&quot;detached&quot;,0,&quot;freehold&quot;,&quot;3&quot;,&quot;&quot;,&quot;ONE ACRE GARTH&quot;,&quot;HAMBLETON&quot;,&quot;SELBY&quot;,&quot;SELBY&quot;,&quot;NORTH YORKSHIRE&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="convert-the-parquet-file-to-a-json">Convert the Parquet file to a JSON<a href="#convert-the-parquet-file-to-a-json" class="hash-link" aria-label="Direct link to Convert the Parquet file to a JSON" title="Direct link to Convert the Parquet file to a JSON">​</a></h2><p>To convert the Parquet file to JSON, simply change the extension on the output filename:</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">./clickhouse </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">local</span><span class="token plain"> -q </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;SELECT *</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">FROM s3(&#x27;https://datasets-documentation.s3.eu-west-3.amazonaws.com/house_parquet/house_0.parquet&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">INTO OUTFILE &#x27;house_prices.ndjson&#x27;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s verify it worked:</p><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain"> $ tail house_prices.ndjson</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{&quot;price&quot;:&quot;70000&quot;,&quot;date&quot;:10508,&quot;postcode1&quot;:&quot;YO8&quot;,&quot;postcode2&quot;:&quot;9XN&quot;,&quot;type&quot;:&quot;detached&quot;,&quot;is_new&quot;:0,&quot;duration&quot;:&quot;freehold&quot;,&quot;addr1&quot;:&quot;7&quot;,&quot;addr2&quot;:&quot;&quot;,&quot;street&quot;:&quot;POPPY CLOSE&quot;,&quot;locality&quot;:&quot;SELBY&quot;,&quot;town&quot;:&quot;SELBY&quot;,&quot;district&quot;:&quot;SELBY&quot;,&quot;county&quot;:&quot;NORTH YORKSHIRE&quot;}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{&quot;price&quot;:&quot;130000&quot;,&quot;date&quot;:14274,&quot;postcode1&quot;:&quot;YO8&quot;,&quot;postcode2&quot;:&quot;9XP&quot;,&quot;type&quot;:&quot;detached&quot;,&quot;is_new&quot;:0,&quot;duration&quot;:&quot;freehold&quot;,&quot;addr1&quot;:&quot;10&quot;,&quot;addr2&quot;:&quot;&quot;,&quot;street&quot;:&quot;HEATHER CLOSE&quot;,&quot;locality&quot;:&quot;&quot;,&quot;town&quot;:&quot;SELBY&quot;,&quot;district&quot;:&quot;SELBY&quot;,&quot;county&quot;:&quot;NORTH YORKSHIRE&quot;}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{&quot;price&quot;:&quot;150000&quot;,&quot;date&quot;:18180,&quot;postcode1&quot;:&quot;YO8&quot;,&quot;postcode2&quot;:&quot;9XP&quot;,&quot;type&quot;:&quot;detached&quot;,&quot;is_new&quot;:0,&quot;duration&quot;:&quot;freehold&quot;,&quot;addr1&quot;:&quot;11&quot;,&quot;addr2&quot;:&quot;&quot;,&quot;street&quot;:&quot;HEATHER CLOSE&quot;,&quot;locality&quot;:&quot;&quot;,&quot;town&quot;:&quot;SELBY&quot;,&quot;district&quot;:&quot;SELBY&quot;,&quot;county&quot;:&quot;NORTH YORKSHIRE&quot;}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{&quot;price&quot;:&quot;157000&quot;,&quot;date&quot;:18088,&quot;postcode1&quot;:&quot;YO8&quot;,&quot;postcode2&quot;:&quot;9XP&quot;,&quot;type&quot;:&quot;detached&quot;,&quot;is_new&quot;:0,&quot;duration&quot;:&quot;freehold&quot;,&quot;addr1&quot;:&quot;12&quot;,&quot;addr2&quot;:&quot;&quot;,&quot;street&quot;:&quot;HEATHER CLOSE&quot;,&quot;locality&quot;:&quot;&quot;,&quot;town&quot;:&quot;SELBY&quot;,&quot;district&quot;:&quot;SELBY&quot;,&quot;county&quot;:&quot;NORTH YORKSHIRE&quot;}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{&quot;price&quot;:&quot;134000&quot;,&quot;date&quot;:17333,&quot;postcode1&quot;:&quot;YO8&quot;,&quot;postcode2&quot;:&quot;9XP&quot;,&quot;type&quot;:&quot;semi-detached&quot;,&quot;is_new&quot;:0,&quot;duration&quot;:&quot;freehold&quot;,&quot;addr1&quot;:&quot;16&quot;,&quot;addr2&quot;:&quot;&quot;,&quot;street&quot;:&quot;HEATHER CLOSE&quot;,&quot;locality&quot;:&quot;&quot;,&quot;town&quot;:&quot;SELBY&quot;,&quot;district&quot;:&quot;SELBY&quot;,&quot;county&quot;:&quot;NORTH YORKSHIRE&quot;}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{&quot;price&quot;:&quot;250000&quot;,&quot;date&quot;:13405,&quot;postcode1&quot;:&quot;YO8&quot;,&quot;postcode2&quot;:&quot;9YA&quot;,&quot;type&quot;:&quot;detached&quot;,&quot;is_new&quot;:0,&quot;duration&quot;:&quot;freehold&quot;,&quot;addr1&quot;:&quot;6&quot;,&quot;addr2&quot;:&quot;&quot;,&quot;street&quot;:&quot;YORKDALE COURT&quot;,&quot;locality&quot;:&quot;HAMBLETON&quot;,&quot;town&quot;:&quot;SELBY&quot;,&quot;district&quot;:&quot;SELBY&quot;,&quot;county&quot;:&quot;NORTH YORKSHIRE&quot;}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{&quot;price&quot;:&quot;59500&quot;,&quot;date&quot;:11166,&quot;postcode1&quot;:&quot;YO8&quot;,&quot;postcode2&quot;:&quot;9YB&quot;,&quot;type&quot;:&quot;semi-detached&quot;,&quot;is_new&quot;:0,&quot;duration&quot;:&quot;freehold&quot;,&quot;addr1&quot;:&quot;4&quot;,&quot;addr2&quot;:&quot;&quot;,&quot;street&quot;:&quot;YORKDALE DRIVE&quot;,&quot;locality&quot;:&quot;HAMBLETON&quot;,&quot;town&quot;:&quot;SELBY&quot;,&quot;district&quot;:&quot;SELBY&quot;,&quot;county&quot;:&quot;NORTH YORKSHIRE&quot;}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{&quot;price&quot;:&quot;142500&quot;,&quot;date&quot;:17648,&quot;postcode1&quot;:&quot;YO8&quot;,&quot;postcode2&quot;:&quot;9YB&quot;,&quot;type&quot;:&quot;semi-detached&quot;,&quot;is_new&quot;:0,&quot;duration&quot;:&quot;freehold&quot;,&quot;addr1&quot;:&quot;4A&quot;,&quot;addr2&quot;:&quot;&quot;,&quot;street&quot;:&quot;YORKDALE DRIVE&quot;,&quot;locality&quot;:&quot;HAMBLETON&quot;,&quot;town&quot;:&quot;SELBY&quot;,&quot;district&quot;:&quot;SELBY&quot;,&quot;county&quot;:&quot;NORTH YORKSHIRE&quot;}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{&quot;price&quot;:&quot;230000&quot;,&quot;date&quot;:15125,&quot;postcode1&quot;:&quot;YO8&quot;,&quot;postcode2&quot;:&quot;9YD&quot;,&quot;type&quot;:&quot;detached&quot;,&quot;is_new&quot;:0,&quot;duration&quot;:&quot;freehold&quot;,&quot;addr1&quot;:&quot;1&quot;,&quot;addr2&quot;:&quot;&quot;,&quot;street&quot;:&quot;ONE ACRE GARTH&quot;,&quot;locality&quot;:&quot;HAMBLETON&quot;,&quot;town&quot;:&quot;SELBY&quot;,&quot;district&quot;:&quot;SELBY&quot;,&quot;county&quot;:&quot;NORTH YORKSHIRE&quot;}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{&quot;price&quot;:&quot;250000&quot;,&quot;date&quot;:15950,&quot;postcode1&quot;:&quot;YO8&quot;,&quot;postcode2&quot;:&quot;9YD&quot;,&quot;type&quot;:&quot;detached&quot;,&quot;is_new&quot;:0,&quot;duration&quot;:&quot;freehold&quot;,&quot;addr1&quot;:&quot;3&quot;,&quot;addr2&quot;:&quot;&quot;,&quot;street&quot;:&quot;ONE ACRE GARTH&quot;,&quot;locality&quot;:&quot;HAMBLETON&quot;,&quot;town&quot;:&quot;SELBY&quot;,&quot;district&quot;:&quot;SELBY&quot;,&quot;county&quot;:&quot;NORTH YORKSHIRE&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="convert-csv-to-parquet">Convert CSV to Parquet<a href="#convert-csv-to-parquet" class="hash-link" aria-label="Direct link to Convert CSV to Parquet" title="Direct link to Convert CSV to Parquet">​</a></h2><p>It works both ways - we can easily read in the new CSV file and output it into a Parquet file. The local file <code>house_prices.csv</code> can be read in ClickHouse using the <code>file</code> table function, and ClickHouse outputs the file in Parquet format based on the filename ending in <code>.parquet</code> (or we could have added the <code>FORMAT Parquet</code> clause):</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">./clickhouse </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">local</span><span class="token plain"> -q </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;SELECT *</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">FROM file(&#x27;house_prices.csv&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">INTO OUTFILE &#x27;house_prices.parquet&#x27;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As we mentioned above, you can use any of the ClickHouse <a href="https://clickhouse.com/docs/en/interfaces/formats" target="_blank" rel="noopener noreferrer">input and output formats</a> along with <code>clickhouse local</code> to easily convert files into different formats.</p></div></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--next paginationNavLink_UdUv" href="/docs/knowledgebase/page/2"><div class="paginationNavContent__3xr"><div class="paginationNavLabel_YPzM pagination-nav__label">Older Entries</div></div><svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.7249 19.175L13.6749 18.125L18.5499 13.25H2.3999V11.75H18.5499L13.6749 6.87501L14.7249 5.82501L21.4249 12.5L14.7249 19.175Z" fill="currentColor"></path></svg></a></nav></main></div></div></div><footer class="footer footer_jryj"><div class="container_y1z5 container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© 2016&ndash;2023 ClickHouse, Inc.</div></div><div><div class="footer__links text--center"><div class="footer__links"><a href="https://clickhouse.com/legal/trademark-policy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Trademark</a><span class="footer__link-separator">·</span><a href="https://clickhouse.com/legal/privacy-policy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a><span class="footer__link-separator">·</span><a href="https://trust.clickhouse.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a><span class="footer__link-separator">·</span><a href="https://clickhouse.com/legal/agreements/terms-of-service" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Service</a></div></div></div></div><button class="colorModeButton_hk25"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.7227 0.724664C8.7227 0.330045 8.39191 0 8.0036 0C7.60809 0 7.2773 0.330045 7.2773 0.724664V2.18834C7.2773 2.57578 7.60809 2.90583 8.0036 2.90583C8.39191 2.90583 8.7227 2.57578 8.7227 2.18834V0.724664ZM11.5991 3.4009C11.3258 3.67354 11.3258 4.13274 11.6063 4.41256C11.8796 4.6852 12.347 4.69238 12.6274 4.40538L13.6629 3.3722C13.9434 3.09238 13.9362 2.62601 13.6629 2.34619C13.3897 2.07354 12.9222 2.08072 12.649 2.35336L11.5991 3.4009ZM3.37258 4.40538C3.64584 4.6852 4.11326 4.6852 4.38652 4.41256C4.66697 4.14709 4.66697 3.66637 4.4009 3.4009L3.3582 2.35336C3.09213 2.08789 2.61753 2.07354 2.34427 2.34619C2.07101 2.62601 2.06382 3.09238 2.33708 3.36502L3.37258 4.40538ZM7.9964 11.774C10.0602 11.774 11.7717 10.0664 11.7717 8C11.7717 5.93363 10.0602 4.22601 7.9964 4.22601C5.93258 4.22601 4.22112 5.93363 4.22112 8C4.22112 10.0664 5.93258 11.774 7.9964 11.774ZM7.9964 10.4395C6.65888 10.4395 5.55146 9.33453 5.55146 8C5.55146 6.66547 6.65888 5.56054 7.9964 5.56054C9.33393 5.56054 10.4413 6.66547 10.4413 8C10.4413 9.33453 9.33393 10.4395 7.9964 10.4395ZM15.2809 8.71749C15.6692 8.71749 16 8.38744 16 8C16 7.60538 15.6692 7.28251 15.2809 7.28251H13.8211C13.4328 7.28251 13.102 7.60538 13.102 8C13.102 8.38744 13.4328 8.71749 13.8211 8.71749H15.2809ZM0.719101 7.28251C0.330787 7.28251 0 7.60538 0 8C0 8.38744 0.330787 8.71749 0.719101 8.71749H2.17888C2.57438 8.71749 2.90517 8.38744 2.90517 8C2.90517 7.60538 2.57438 7.28251 2.17888 7.28251H0.719101ZM12.6202 11.5946C12.347 11.322 11.8796 11.322 11.5991 11.5946C11.3258 11.8744 11.3258 12.3336 11.6063 12.6135L12.649 13.6538C12.9294 13.9265 13.3897 13.9193 13.6701 13.6395C13.9434 13.3668 13.9434 12.9076 13.6629 12.6278L12.6202 11.5946ZM2.33708 12.6206C2.05663 12.9004 2.05663 13.3668 2.3227 13.6395C2.60315 13.9121 3.07056 13.9193 3.34382 13.6466L4.38652 12.6135C4.66697 12.3336 4.66697 11.8744 4.4009 11.6018C4.12045 11.322 3.65303 11.322 3.37258 11.5946L2.33708 12.6206ZM8.7227 13.8117C8.7227 13.4242 8.39191 13.0942 8.0036 13.0942C7.60809 13.0942 7.2773 13.4242 7.2773 13.8117V15.2753C7.2773 15.6628 7.60809 16 8.0036 16C8.39191 16 8.7227 15.6628 8.7227 15.2753V13.8117Z" fill="currentColor"></path></svg><span>light Mode</span></button></footer></div>
<script src="/docs/assets/js/runtime~main.1a20c1e7.js"></script>
<script src="/docs/assets/js/main.ff0025b5.js"></script>
</body>
</html>