<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-en/integrations/data-ingestion/etl-tools/dbt/index">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Integrating dbt and ClickHouse | ClickHouse Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://clickhouse.com/docs/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://clickhouse.com/docs/img/logo.png"><meta data-rh="true" property="og:url" content="https://clickhouse.com/docs/en/integrations/dbt"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Integrating dbt and ClickHouse | ClickHouse Docs"><meta data-rh="true" name="description" content="Users can transform and model their data in ClickHouse using dbt"><meta data-rh="true" property="og:description" content="Users can transform and model their data in ClickHouse using dbt"><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://clickhouse.com/docs/en/integrations/dbt"><link data-rh="true" rel="alternate" href="https://clickhouse.com/docs/en/integrations/dbt" hreflang="en"><link data-rh="true" rel="alternate" href="https://clickhouse.com/docs/en/integrations/dbt" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://62VCH2MD74-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/docs/knowledgebase/rss.xml" title="ClickHouse Knowledge Base Feed RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/knowledgebase/atom.xml" title="ClickHouse Knowledge Base Feed Atom Feed">
<link rel="alternate" type="application/json" href="/docs/knowledgebase/feed.json" title="ClickHouse Knowledge Base Feed JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KF1LLRTQ5Q"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-KF1LLRTQ5Q",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="ClickHouse Docs" href="/docs/opensearch.xml">





<script src="/docs/js/analytics.js"></script><link rel="stylesheet" href="/docs/assets/css/styles.084d673f.css">
<link rel="preload" href="/docs/assets/js/runtime~main.92881152.js" as="script">
<link rel="preload" href="/docs/assets/js/main.92fcbde1.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navBar_gvJn"><div class="navbarHeaderContainer_rccn navbar-header"><div class="navbar__inner navbarInner_W6bg"><div class="navbar__items"><a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/docs/img/logo_without_text.svg" alt="ClickHouse" class="themedImage_ToTc themedImage--light_HNdA"><img src="/docs/img/logo_without_text.svg" alt="ClickHouse" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">ClickHouse</b></a><div class="navbarItemsList_uIZ2 navbar-items-list"><div class="navbar__item dropdown"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link ch-menu">Product</a><ul class="dropdown__menu"><li><a href="https://clickhouse.com/cloud" target="_blank" rel="noopener noreferrer" class="dropdown__link">ClickHouse Cloud</a></li><li><a href="https://clickhouse.com/clickhouse" target="_blank" rel="noopener noreferrer" class="dropdown__link">ClickHouse Open Source</a></li></ul></div><a href="https://clickhouse.com/customer-stories" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link ch-menu">Use Cases</a><div class="navbar__item dropdown"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link ch-menu">Company</a><ul class="dropdown__menu"><li><a href="https://clickhouse.com/blog" target="_blank" rel="noopener noreferrer" class="dropdown__link">Blog</a></li><li><a href="https://clickhouse.com/company/our-story" target="_blank" rel="noopener noreferrer" class="dropdown__link">Our story</a></li><li><a href="https://clickhouse.com/company/careers" target="_blank" rel="noopener noreferrer" class="dropdown__link">Careers</a></li><li><a href="https://clickhouse.com/company/contact" target="_blank" rel="noopener noreferrer" class="dropdown__link">Contact us</a></li><li><a href="https://clickhouse.com/company/news-events" target="_blank" rel="noopener noreferrer" class="dropdown__link">News and events</a></li></ul></div><div class="navbar__item dropdown"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link ch-menu">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/en/intro">Docs</a></li><li><a href="https://clickhouse.com/learn" target="_blank" rel="noopener noreferrer" class="dropdown__link">ClickHouse Academy</a></li></ul></div><a href="https://clickhouse.com/pricing" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link ch-menu">Pricing</a></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item">
                <div class="nav-items-btns">
                  <a href="https://clickhouse.cloud/signIn" class="sign-in navbar__item navbar__link ch-menu">
                    Sign in
                  </a>
                  <a href="https://clickhouse.cloud/signUp" class="click-button-anchor">
                    <button class="click-button primary-btn">Free Trial</button>
                  </a>
                </div></div><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button></div></div><div class="secondary-nav--items secondaryMenu_iuff"><div class="scrollableElement_Qqzp secondaryMenuLeft_tFZR secondary-nav--items-left"><a aria-current="page" class="navbar__item navbar__link ch-menu navbar__link--active" href="/docs/en/intro">Docs</a><a class="navbar__item navbar__link ch-menu" href="/docs/en/cloud/overview">Cloud</a><a class="navbar__item navbar__link ch-menu" href="/docs/en/sql-reference">SQL Reference</a><a class="navbar__item navbar__link ch-menu" href="/docs/knowledgebase">Knowledge Base</a></div><div class="secondaryMenuRight__9m4 secondary-nav--items-right"><div class="navbar__item dropdown dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg width="14" height="13" viewBox="0 0 14 13" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6.95 12.6496L9.75 5.26628H11.0333L13.8333 12.6496H12.55L11.9 10.7663H8.91667L8.25 12.6496H6.95ZM9.28333 9.69961H11.5L10.4167 6.64961H10.3667L9.28333 9.69961ZM2.08333 10.7996L1.21667 9.93294L4.33333 6.83294C3.94444 6.39961 3.60556 5.95228 3.31667 5.49094C3.02778 5.03005 2.77222 4.54405 2.55 4.03294H3.83333C4.02222 4.41072 4.22222 4.74672 4.43333 5.04094C4.64444 5.33561 4.89444 5.64405 5.18333 5.96628C5.63889 5.47739 6.01667 4.97472 6.31667 4.45828C6.61667 3.94139 6.86667 3.3885 7.06667 2.79961H0.25V1.58294H4.55V0.349609H5.78333V1.58294H10.0833V2.79961H8.3C8.07778 3.53294 7.78333 4.24116 7.41667 4.92428C7.05 5.60783 6.59444 6.25516 6.05 6.86628L7.53333 8.36628L7.06667 9.63294L5.16667 7.73294L2.08333 10.7996Z" fill="currentColor"/>
</svg></a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/en/intro">English</a></li><li><a class="dropdown__link" href="/docs/ru">Russian</a></li><li><a class="dropdown__link" href="/docs/zh">Chinese</a></li></ul></div><button class="colorModeButton_hk25 navbar-color-toggle"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.7227 0.724664C8.7227 0.330045 8.39191 0 8.0036 0C7.60809 0 7.2773 0.330045 7.2773 0.724664V2.18834C7.2773 2.57578 7.60809 2.90583 8.0036 2.90583C8.39191 2.90583 8.7227 2.57578 8.7227 2.18834V0.724664ZM11.5991 3.4009C11.3258 3.67354 11.3258 4.13274 11.6063 4.41256C11.8796 4.6852 12.347 4.69238 12.6274 4.40538L13.6629 3.3722C13.9434 3.09238 13.9362 2.62601 13.6629 2.34619C13.3897 2.07354 12.9222 2.08072 12.649 2.35336L11.5991 3.4009ZM3.37258 4.40538C3.64584 4.6852 4.11326 4.6852 4.38652 4.41256C4.66697 4.14709 4.66697 3.66637 4.4009 3.4009L3.3582 2.35336C3.09213 2.08789 2.61753 2.07354 2.34427 2.34619C2.07101 2.62601 2.06382 3.09238 2.33708 3.36502L3.37258 4.40538ZM7.9964 11.774C10.0602 11.774 11.7717 10.0664 11.7717 8C11.7717 5.93363 10.0602 4.22601 7.9964 4.22601C5.93258 4.22601 4.22112 5.93363 4.22112 8C4.22112 10.0664 5.93258 11.774 7.9964 11.774ZM7.9964 10.4395C6.65888 10.4395 5.55146 9.33453 5.55146 8C5.55146 6.66547 6.65888 5.56054 7.9964 5.56054C9.33393 5.56054 10.4413 6.66547 10.4413 8C10.4413 9.33453 9.33393 10.4395 7.9964 10.4395ZM15.2809 8.71749C15.6692 8.71749 16 8.38744 16 8C16 7.60538 15.6692 7.28251 15.2809 7.28251H13.8211C13.4328 7.28251 13.102 7.60538 13.102 8C13.102 8.38744 13.4328 8.71749 13.8211 8.71749H15.2809ZM0.719101 7.28251C0.330787 7.28251 0 7.60538 0 8C0 8.38744 0.330787 8.71749 0.719101 8.71749H2.17888C2.57438 8.71749 2.90517 8.38744 2.90517 8C2.90517 7.60538 2.57438 7.28251 2.17888 7.28251H0.719101ZM12.6202 11.5946C12.347 11.322 11.8796 11.322 11.5991 11.5946C11.3258 11.8744 11.3258 12.3336 11.6063 12.6135L12.649 13.6538C12.9294 13.9265 13.3897 13.9193 13.6701 13.6395C13.9434 13.3668 13.9434 12.9076 13.6629 12.6278L12.6202 11.5946ZM2.33708 12.6206C2.05663 12.9004 2.05663 13.3668 2.3227 13.6395C2.60315 13.9121 3.07056 13.9193 3.34382 13.6466L4.38652 12.6135C4.66697 12.3336 4.66697 11.8744 4.4009 11.6018C4.12045 11.322 3.65303 11.322 3.37258 11.5946L2.33708 12.6206ZM8.7227 13.8117C8.7227 13.4242 8.39191 13.0942 8.0036 13.0942C7.60809 13.0942 7.2773 13.4242 7.2773 13.8117V15.2753C7.2773 15.6628 7.60809 16 8.0036 16C8.39191 16 8.7227 15.6628 8.7227 15.2753V13.8117Z" fill="currentColor"></path></svg><span>light Mode</span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_W2AM"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage_qMb8"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_mhZE"><div class="sidebarSearchContainer_Lwc8"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_Y1UP"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="false"><a class="menu__link">Get Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/intro">What is ClickHouse?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/getting-started/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/tutorial">Advanced Tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/install">Install</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item top-nav-item"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="false"><a class="menu__link">Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/concepts/why-clickhouse-is-so-fast">Why is ClickHouse so Fast?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/concepts/olap">What is OLAP?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/about-us/distinctive-features">Why is ClickHouse unique?</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="false"><a class="menu__link">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/guides/creating-tables">Creating Tables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/guides/inserting-data">Inserting Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/guides/writing-queries">SELECT Queries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/guides/developer/mutations">Updating and Deleting Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/guides/joining-tables">Joining Tables</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="true"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/en/guides/developer/cascading-materialized-views">Advanced Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="true"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/en/optimize/sparse-primary-indexes">Best Practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="true"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/en/getting-started/example-datasets">Example Datasets</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="false"><a class="menu__link menu__link--active">Integrations</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/integrations">View all integrations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/integrations/s3">AWS S3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/integrations/gcs">Google Cloud Storage (GCS)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/integrations/postgresql">PostgreSQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/integrations/mysql">MySQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/integrations/kafka">Kafka</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/en/integrations/dbt">dbt</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/integrations/redshift">Redshift</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed top-nav-item"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="true"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/en/integrations/airbyte">More...</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="false"><a class="menu__link">Data Formats</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/integrations/data-formats/csv-tsv">CSV and TSV</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/integrations/data-formats/json">JSON</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/integrations/data-formats/parquet">Parquet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/integrations/data-formats/arrow-avro-orc">Avro, Arrow and ORC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/interfaces/formats">View all formats...</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="false"><a class="menu__link">Clients and Drivers</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/integrations/sql-clients/clickhouse-client-local">clickhouse-client (CLI)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/integrations/sql-clients/sql-console">SQL Console</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/getting-started/playground">ClickHouse Playground</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/integrations/language-clients/nodejs">Node.js</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/integrations/java">Java</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/integrations/python">Python</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="true"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/en/integrations/language-clients/nodejs">View all languages</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="true"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/en/interfaces/overview">Drivers and Interfaces</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="true"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/en/integrations/datagrip">SQL Clients</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="true"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/en/integrations/data-visualization">Business Intelligence</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="false"><a class="menu__link">Managing ClickHouse</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/operations/access-rights">Users and Roles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/operations/backup">Backup and Restore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/operations/monitoring">Monitoring</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="true"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/en/architecture/introduction">Deploying</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="true"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/en/guides/sre/configuring-ldap">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="true"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/en/operations/settings">Advanced Settings</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="true"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/en/guides/sre/scaling-clusters">Performance and Optimizations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="true"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/en/operations/utilities">Tools and Utilities</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="true"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/en/operations/update">More...</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="false"><a class="menu__link">About ClickHouse</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/about-us/adopters">Adopters</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="true"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/changelog">Changelog</a><button aria-label="Toggle the collapsible sidebar category &#x27;Changelog&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/whats-new/security-changelog">Security Changelog</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/whats-new/roadmap">Roadmap</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menuListItemCollapsed_i9wL menu__list-item-collapsible" data-link="true"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/en/development/developer-instruction">Contribute</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/en/about-us/history">ClickHouse History</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_RiV8"><div class="container padding-top--md padding-bottom--lg main-content-wrapper"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><div class="theme-doc-markdown markdown"><h1>Integrating dbt and ClickHouse</h1><p><strong>dbt</strong> (data build tool) enables analytics engineers to transform data in their warehouses by simply writing select statements. dbt handles materializing these select statements into objects in the database in the form of tables and views - performing the T of <a href="https://en.wikipedia.org/wiki/Extract,_load,_transform" target="_blank" rel="noopener noreferrer">Extract Load and Transform (ELT)</a>. Users can create a model defined by a SELECT statement.</p><p>Within dbt, these models can be cross-referenced and layered to allow the construction of higher-level concepts. The boilerplate SQL required to connect models is automatically generated. Furthermore, dbt identifies dependencies between models and ensures they are created in the appropriate order using a directed acyclic graph (DAG).</p><p>Dbt is compatible with ClickHouse through a <a href="https://github.com/ClickHouse/dbt-clickhouse" target="_blank" rel="noopener noreferrer">ClickHouse-supported plugin</a>. We describe the process for connecting ClickHouse with a simple example based on a publicly available IMDB dataset. We additionally highlight some of the limitations of the current connector.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="concepts">Concepts<a href="#concepts" class="hash-link" aria-label="Direct link to Concepts" title="Direct link to Concepts">​</a></h2><p>dbt introduces the concept of a model. This is defined as a SQL statement, potentially joining many tables. A model can be “materialized” in a number of ways. A materialization represents a build strategy for the model’s select query. The code behind a materialization is boilerplate SQL that wraps your SELECT query in a statement in order to create a new or update an existing relation.</p><p>dbt provides 4 types of materialization:</p><ul><li><strong>view</strong> (default): The model is built as a view in the database.</li><li><strong>table</strong>: The model is built as a table in the database.</li><li><strong>ephemeral</strong>: The model is not directly built in the database but is instead pulled into dependent models as common table expressions.</li><li><strong>incremental</strong>: The model is initially materialized as a table, and in subsequent runs, dbt inserts new rows and updates changed rows in the table.</li></ul><p>Additional syntax and clauses define how these models should be updated if their underlying data changes. dbt generally recommends starting with the view materialization until performance becomes a concern. The table materialization provides a query time performance improvement by capturing the results of the model’s query as a table at the expense of increased storage. The incremental approach builds on this further to allow subsequent updates to the underlying data to be captured in the target table.</p><p>The<a href="https://github.com/silentsokolov/dbt-clickhouse" target="_blank" rel="noopener noreferrer"> current plugin</a> for ClickHouse supports the <strong>view</strong>, <strong>table,</strong> and <strong>incremental</strong> materializations. Ephemeral is not supported. The plugin also supports dbt<a href="https://docs.getdbt.com/docs/building-a-dbt-project/snapshots#check-strategy" target="_blank" rel="noopener noreferrer"> snapshots</a> and<a href="https://docs.getdbt.com/docs/building-a-dbt-project/seeds" target="_blank" rel="noopener noreferrer"> seeds</a> which we explore in this guide.</p><p>For the following guides, we assume you have a ClickHouse instance available.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup-of-dbt-and-the-clickhouse-plugin">Setup of dbt and the ClickHouse plugin<a href="#setup-of-dbt-and-the-clickhouse-plugin" class="hash-link" aria-label="Direct link to Setup of dbt and the ClickHouse plugin" title="Direct link to Setup of dbt and the ClickHouse plugin">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dbt">dbt<a href="#dbt" class="hash-link" aria-label="Direct link to dbt" title="Direct link to dbt">​</a></h3><p>We assume the use of the dbt CLI for the following examples. Users may also wish to consider<a href="https://docs.getdbt.com/docs/dbt-cloud/cloud-overview" target="_blank" rel="noopener noreferrer"> dbt Cloud</a>, which offers a web-based Integrated Development Environment (IDE) allowing users to edit and run projects.</p><p>dbt offers a number of options for CLI installation. Follow the instructions described<a href="https://docs.getdbt.com/dbt-cli/install/overview" target="_blank" rel="noopener noreferrer"> here</a>. At this stage install dbt-core only. We recommend the use of <code>pip</code>.</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">pip </span><span class="token function" style="color:rgb(220, 220, 170)">install</span><span class="token plain"> dbt-core</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Important: The following is tested under python 3.9.</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="clickhouse-plugin">ClickHouse plugin<a href="#clickhouse-plugin" class="hash-link" aria-label="Direct link to ClickHouse plugin" title="Direct link to ClickHouse plugin">​</a></h3><p>Install the dbt ClickHouse plugin:</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">pip </span><span class="token function" style="color:rgb(220, 220, 170)">install</span><span class="token plain"> dbt-clickhouse</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prepare-clickhouse">Prepare ClickHouse<a href="#prepare-clickhouse" class="hash-link" aria-label="Direct link to Prepare ClickHouse" title="Direct link to Prepare ClickHouse">​</a></h3><p>dbt excels when modeling highly relational data. For the purposes of example, we provide a small IMDB dataset with the following relational schema. This dataset originates from the<a href="https://relational.fit.cvut.cz/dataset/IMDb" target="_blank" rel="noopener noreferrer"> relational dataset repository</a>. This is trivial relative to common schemas used with dbt but represents a manageable sample:</p><img loading="lazy" src="/docs/assets/images/dbt_01-24a161b0216de65d39a8785fb345730e.png" class="image" alt="IMDB table schema" style="width:100%" class="img_ev3q"><p>We use a subset of these tables as shown.</p><p>Create the following tables:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">DATABASE</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    id         UInt32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    first_name String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    last_name  String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    gender     FixedString</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ENGINE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> MergeTree </span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> first_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> last_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> gender</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">directors</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    id         UInt32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    first_name String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    last_name  String</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ENGINE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> MergeTree </span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> first_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> last_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">genres</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    movie_id UInt32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    genre    String</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ENGINE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> MergeTree </span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> genre</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_directors</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    director_id UInt32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    movie_id    UInt64</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ENGINE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> MergeTree </span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">director_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    id   UInt32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    name String</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">year</span><span class="token plain"> UInt32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    rank Float32 </span><span class="token keyword" style="color:rgb(86, 156, 214)">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ENGINE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> MergeTree </span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">year</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">roles</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    created_at </span><span class="token keyword" style="color:rgb(86, 156, 214)">DateTime</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">DEFAULT</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">now</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    actor_id   UInt32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    movie_id   UInt32</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    role       String</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ENGINE</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> MergeTree </span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">actor_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_WoCw"><div class="alert-icon admonitionIcon_Ibzs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div><div class="alert-content admonitionContent_vXIg"><div class="admonitionHeading_TMsN">note</div><p>The column <code>created_at</code> for the table <code>roles</code>, which defaults to a value of <code>now()</code>. We use this later to identify incremental updates to our models - see <a href="#creating-an-incremental-materialization">Incremental Models</a>.</p></div></div><p>We use the <code>s3</code> function to read the source data from public endpoints to insert data. Run the following commands to populate the tables:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> s3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;https://datasets-documentation.s3.eu-west-3.amazonaws.com/imdb/imdb_ijs_actors.tsv.gz&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;TSVWithNames&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">directors</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> s3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;https://datasets-documentation.s3.eu-west-3.amazonaws.com/imdb/imdb_ijs_directors.tsv.gz&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;TSVWithNames&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">genres</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> s3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;https://datasets-documentation.s3.eu-west-3.amazonaws.com/imdb/imdb_ijs_movies_genres.tsv.gz&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;TSVWithNames&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_directors</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> s3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;https://datasets-documentation.s3.eu-west-3.amazonaws.com/imdb/imdb_ijs_movies_directors.tsv.gz&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;TSVWithNames&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> s3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;https://datasets-documentation.s3.eu-west-3.amazonaws.com/imdb/imdb_ijs_movies.tsv.gz&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;TSVWithNames&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">roles</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">actor_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> role</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> actor_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> role</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> s3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;https://datasets-documentation.s3.eu-west-3.amazonaws.com/imdb/imdb_ijs_roles.tsv.gz&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;TSVWithNames&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The execution of these may vary depending on your bandwidth, but each should only take a few seconds to complete. Execute the following query to compute a summary of each actor, ordered by the most movie appearances, and to confirm the data was loaded successfully:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">       </span><span class="token keyword" style="color:rgb(86, 156, 214)">any</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">actor_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">          </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">       uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> num_movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">       </span><span class="token function" style="color:rgb(220, 220, 170)">avg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> avg_rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">       uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">genre</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">         </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> unique_genres</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">       uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">director_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> uniq_directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">       </span><span class="token function" style="color:rgb(220, 220, 170)">max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">created_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">          </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> updated_at</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id  </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">first_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">last_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> actor_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">rank </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                genre</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">first_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">last_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> director_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                created_at</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                  </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">roles </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">roles</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                  </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">roles</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                  </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">genres </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">genres</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                  </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_directors </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                  </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">directors </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">director_id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> num_movies </span><span class="token keyword" style="color:rgb(86, 156, 214)">DESC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The response should look like:</p><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+------------+----------+------------------+-------------+--------------+-------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|id    |name        |num_movies|avg_rank          |unique_genres|uniq_directors|updated_at         |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+------------+----------+------------------+-------------+--------------+-------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|45332 |Mel Blanc   |832       |6.175853582979779 |18           |84            |2022-04-26 14:01:45|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|621468|Bess Flowers|659       |5.57727638854796  |19           |293           |2022-04-26 14:01:46|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|372839|Lee Phelps  |527       |5.032976449684617 |18           |261           |2022-04-26 14:01:46|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|283127|Tom London  |525       |2.8721716524875673|17           |203           |2022-04-26 14:01:46|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|356804|Bud Osborne |515       |2.0389507108727773|15           |149           |2022-04-26 14:01:46|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+------------+----------+------------------+-------------+--------------+-------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the later guides, we will convert this query into a model - materializing it in ClickHouse as a dbt view and table.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="connecting-to-clickhouse">Connecting to ClickHouse<a href="#connecting-to-clickhouse" class="hash-link" aria-label="Direct link to Connecting to ClickHouse" title="Direct link to Connecting to ClickHouse">​</a></h2><ol><li><p>Create a dbt project. In this case we name this after our imdb source. When prompted, select <code>clickhouse</code> as the database source.</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-user@clickhouse:~$ dbt init imdb</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">16</span><span class="token plain">:52:40  Running with </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">dbt</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">1.1</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Which database would you like to use?</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">Don&#x27;t see the one you want? https://docs.getdbt.com/docs/available-adapters</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Enter a number: </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">16</span><span class="token plain">:53:21  No sample profile found </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> clickhouse.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">16</span><span class="token plain">:53:21</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Your new dbt project </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;imdb&quot;</span><span class="token plain"> was created</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">For </span><span class="token function" style="color:rgb(220, 220, 170)">more</span><span class="token plain"> information on how to configure the profiles.yml file,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">please consult the dbt documentation here:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">https://docs.getdbt.com/docs/configure-your-profile</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><code>cd</code> into your project folder:</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token builtin class-name" style="color:rgb(78, 201, 176)">cd</span><span class="token plain"> imdb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>At this point, you will need the text editor of your choice. In the examples below, we use the popular VSCode. Opening the IMDB directory, you should see a collection of yml and sql files:</p><img loading="lazy" src="/docs/assets/images/dbt_02-8318d15ea0eafec005a86dbacfbe4d58.png" class="image" alt="New dbt project" style="width:100%" class="img_ev3q"></li><li><p>Update your <code>dbt_project.yml</code> file to specify our first model - <code>actor_summary</code> and set profile to <code>clickhouse_imdb</code>.</p><img loading="lazy" src="/docs/assets/images/dbt_03-b9c1ccc74eae7f23956f59dc8c9c79ab.png" class="image" alt="dbt profile" style="width:100%" class="img_ev3q"><img loading="lazy" src="/docs/assets/images/dbt_04-e9de140479a78612317ccd005190c381.png" class="image" alt="dbt profile" style="width:100%" class="img_ev3q"></li><li><p>We next need to provide dbt with the connection details for our ClickHouse instance. Add the following to your <code>~/.dbt/profiles.yml</code>.</p><div class="language-yml codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">clickhouse_imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">target</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> dev</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">outputs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">dev</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> clickhouse</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">schema</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> imdb_dbt</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> localhost</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">8123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">user</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">password</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">secure</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token boolean important">False</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note the need to modify the user and password. There are additional available settings documented<a href="https://github.com/silentsokolov/dbt-clickhouse#example-profile" target="_blank" rel="noopener noreferrer"> here</a>.</p></li><li><p>From the IMDB directory, execute the <code>dbt debug</code> command to confirm whether dbt is able to connect to ClickHouse.</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-user@clickhouse:~/imdb$ dbt debug</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:33:53  Running with </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">dbt</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">1.1</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">dbt version: </span><span class="token number" style="color:rgb(181, 206, 168)">1.1</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">python version: </span><span class="token number" style="color:rgb(181, 206, 168)">3.10</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">python path: /home/dale/.pyenv/versions/3.10.1/bin/python3.10</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">os info: Linux-5.13.0-10039-tuxedo-x86_64-with-glibc2.31</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Using profiles.yml </span><span class="token function" style="color:rgb(220, 220, 170)">file</span><span class="token plain"> at /home/dale/.dbt/profiles.yml</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Using dbt_project.yml </span><span class="token function" style="color:rgb(220, 220, 170)">file</span><span class="token plain"> at /opt/dbt/imdb/dbt_project.yml</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Configuration:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">profiles.yml </span><span class="token function" style="color:rgb(220, 220, 170)">file</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">OK found and valid</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">dbt_project.yml </span><span class="token function" style="color:rgb(220, 220, 170)">file</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">OK found and valid</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Required dependencies:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">- </span><span class="token function" style="color:rgb(220, 220, 170)">git</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">OK found</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Connection:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">host: localhost</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">port: </span><span class="token number" style="color:rgb(181, 206, 168)">8123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">user: default</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">schema: imdb_dbt</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">secure: False</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">verify: False</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Connection test: </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">OK connection ok</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">All checks passed</span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Confirm the response includes <code>Connection test: [OK connection ok]</code> indicating a successful connection.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-simple-view-materialization">Creating a Simple View Materialization<a href="#creating-a-simple-view-materialization" class="hash-link" aria-label="Direct link to Creating a Simple View Materialization" title="Direct link to Creating a Simple View Materialization">​</a></h2><p>When using the view materialization, a model is rebuilt as a view on each run, via a <code>CREATE VIEW AS</code> statement in ClickHouse. This doesn&#x27;t require any additional storage of data but will be slower to query than table materializations.</p><ol><li><p>From the <code>imdb</code> folder, delete the directory <code>models/example</code>:</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-user@clickhouse:~/imdb$ </span><span class="token function" style="color:rgb(220, 220, 170)">rm</span><span class="token plain"> -rf models/example</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Create a new file in the <code>actors</code> within the <code>models</code> folder. Here we create files that each represent an actor model:</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-user@clickhouse:~/imdb$ </span><span class="token function" style="color:rgb(220, 220, 170)">mkdir</span><span class="token plain"> models/actors</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Create the files <code>schema.yml</code> and <code>actor_summary.sql</code> in the <code>models/actors</code> folder.</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-user@clickhouse:~/imdb$ </span><span class="token function" style="color:rgb(220, 220, 170)">touch</span><span class="token plain"> models/actors/actor_summary.sql</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-user@clickhouse:~/imdb$ </span><span class="token function" style="color:rgb(220, 220, 170)">touch</span><span class="token plain"> models/actors/schema.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The file <code>schema.yml</code> defines our tables. These will subsequently be available for use in macros.  Edit
<code>models/actors/schema.yml</code> to contain this content:</p><div class="language-yml codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">sources</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> imdb</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">tables</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> directors</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> actors</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> roles</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> movies</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> genres</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> movie_directors</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>actors_summary.sql</code> defines our actual model. Note in the config function we also request the model be materialized as a view in ClickHouse. Our tables are referenced from the <code>schema.yml</code> file via the function <code>source</code> e.g. <code>source(&#x27;imdb&#x27;, &#x27;movies&#x27;)</code> refers to the <code>movies</code> table in the <code>imdb</code> database.  Edit <code>models/actors/actors_summary.sql</code> to contain this content:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{{ config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">materialized</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;view&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">with</span><span class="token plain"> actor_summary </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">any</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">actor_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> num_movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">avg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> avg_rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">genre</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">         </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> genres</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">director_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">created_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> updated_at</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">{{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">first_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">last_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> actor_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">rank </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                genre</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">{{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">first_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">last_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> director_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                created_at</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;roles&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }} </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;roles&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }} </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;roles&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;genres&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }} </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;genres&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movie_directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }} </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movie_directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }} </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movie_directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">director_id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> actor_summary</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note how we include the column <code>updated_at</code> in our final actor_summary. We use this later for incremental materializations.</p></li><li><p>From the <code>imdb</code> directory execute the command <code>dbt run</code>.</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-user@clickhouse:~/imdb$ dbt run</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:05:35  Running with </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">dbt</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">1.1</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:05:35  Found </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> model, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> tests, </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> snapshot, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> analyses, </span><span class="token number" style="color:rgb(181, 206, 168)">181</span><span class="token plain"> macros, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> operations, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> seed files, </span><span class="token number" style="color:rgb(181, 206, 168)">6</span><span class="token plain"> sources, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> exposures, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> metrics</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:05:35</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:05:36  Concurrency: </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> threads </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">target</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;dev&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:05:36</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:05:36  </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> of </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> START view model imdb_dbt.actor_summary</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">RUN</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:05:37  </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> of </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> OK created view model imdb_dbt.actor_summary</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">. </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">OK </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">.00s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:05:37</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:05:37  Finished running </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> view model </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">.97s.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:05:37</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:05:37  Completed successfully</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:05:37</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:05:37  Done. </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">PASS</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">WARN</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">ERROR</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">SKIP</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">TOTAL</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>dbt will represent the model as a view in ClickHouse as requested. We can now query this view directly. This view will have been created in the <code>imdb_dbt</code> database - this is determined by the schema parameter in the file <code>~/.dbt/profiles.yml</code> under the <code>clickhouse_imdb</code> profile.</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SHOW</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">DATABASES</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|name              |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|INFORMATION_SCHEMA|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|default           |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|imdb              |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|imdb_dbt          |  &lt;---created by dbt!</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|information_schema|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|system            |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Querying this view, we can replicate the results of our earlier query with a simpler syntax:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> imdb_dbt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_summary </span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> num_movies </span><span class="token keyword" style="color:rgb(86, 156, 214)">DESC</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+------------+----------+------------------+------+---------+-------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|id    |name        |num_movies|avg_rank          |genres|directors|updated_at         |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+------------+----------+------------------+------+---------+-------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|45332 |Mel Blanc   |832       |6.175853582979779 |18    |84       |2022-04-26 15:26:55|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|621468|Bess Flowers|659       |5.57727638854796  |19    |293      |2022-04-26 15:26:57|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|372839|Lee Phelps  |527       |5.032976449684617 |18    |261      |2022-04-26 15:26:56|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|283127|Tom London  |525       |2.8721716524875673|17    |203      |2022-04-26 15:26:56|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|356804|Bud Osborne |515       |2.0389507108727773|15    |149      |2022-04-26 15:26:56|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+------------+----------+------------------+------+---------+-------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-table-materialization">Creating a Table Materialization<a href="#creating-a-table-materialization" class="hash-link" aria-label="Direct link to Creating a Table Materialization" title="Direct link to Creating a Table Materialization">​</a></h2><p>In the previous example, our model was materialized as a view. While this might offer sufficient performance for some queries, more complex SELECTs or frequently executed queries may be better materialized as a table.  This materialization is useful for models that will be queried by BI tools to ensure users have a faster experience. This effectively causes the query results to be stored as a new table, with the associated storage overheads - effectively, an <code>INSERT TO SELECT</code> is executed. Note that this table will be reconstructed each time i.e., it is not incremental. Large result sets may therefore result in long execution times - see <a href="#limitations">dbt Limitations</a>.</p><ol><li><p>Modify the file <code>actors_summary.sql</code> such that the <code>materialized</code> parameter is set to <code>table</code>. Notice how <code>ORDER BY</code> is defined, and notice we use the <code>MergeTree</code> table engine:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{{ config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">order_by</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;(updated_at, id, name)&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">engine</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;MergeTree()&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> materialized</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;table&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>From the <code>imdb</code> directory execute the command <code>dbt run</code>. This execution may take a little longer to execute - around 10s on most machines.</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-user@clickhouse:~/imdb$ dbt run</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:13:27  Running with </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">dbt</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">1.1</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:13:27  Found </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> model, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> tests, </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> snapshot, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> analyses, </span><span class="token number" style="color:rgb(181, 206, 168)">181</span><span class="token plain"> macros, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> operations, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> seed files, </span><span class="token number" style="color:rgb(181, 206, 168)">6</span><span class="token plain"> sources, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> exposures, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> metrics</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:13:27</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:13:28  Concurrency: </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> threads </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">target</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;dev&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:13:28</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:13:28  </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> of </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> START table model imdb_dbt.actor_summary</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">. </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">RUN</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:13:37  </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> of </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> OK created table model imdb_dbt.actor_summary</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">OK </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">9</span><span class="token plain">.22s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:13:37</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:13:37  Finished running </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> table model </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain">.20s.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:13:37</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:13:37  Completed successfully</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:13:37</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token plain">:13:37  Done. </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">PASS</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">WARN</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">ERROR</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">SKIP</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">TOTAL</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Confirm the creation of the table <code>imdb_dbt.actor_summary</code>:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SHOW</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> imdb_dbt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_summary</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You should the table with the appropriate data types:</p><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">+----------------------------------------</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|statement</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+----------------------------------------</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|CREATE TABLE imdb_dbt.actor_summary</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|(</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|`id` UInt32,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|`first_name` String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|`last_name` String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|`num_movies` UInt64,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|`updated_at` DateTime</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|ENGINE = MergeTree</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|ORDER BY (id, first_name, last_name)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|SETTINGS index_granularity = 8192</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+----------------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Confirm the results from this table are consistent with previous responses. Notice an appreciable improvement in the response time now that the model is a table:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> imdb_dbt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_summary </span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> num_movies </span><span class="token keyword" style="color:rgb(86, 156, 214)">DESC</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+------------+----------+------------------+------+---------+-------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|id    |name        |num_movies|avg_rank          |genres|directors|updated_at         |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+------------+----------+------------------+------+---------+-------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|45332 |Mel Blanc   |832       |6.175853582979779 |18    |84       |2022-04-26 15:26:55|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|621468|Bess Flowers|659       |5.57727638854796  |19    |293      |2022-04-26 15:26:57|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|372839|Lee Phelps  |527       |5.032976449684617 |18    |261      |2022-04-26 15:26:56|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|283127|Tom London  |525       |2.8721716524875673|17    |203      |2022-04-26 15:26:56|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|356804|Bud Osborne |515       |2.0389507108727773|15    |149      |2022-04-26 15:26:56|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+------------+----------+------------------+------+---------+-------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Feel free to issue other queries against this model. For example, which actors have the highest ranking movies with more than 5 appearances?</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> imdb_dbt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_summary </span><span class="token keyword" style="color:rgb(86, 156, 214)">WHERE</span><span class="token plain"> num_movies </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> avg_rank  </span><span class="token keyword" style="color:rgb(86, 156, 214)">DESC</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-an-incremental-materialization">Creating an Incremental Materialization<a href="#creating-an-incremental-materialization" class="hash-link" aria-label="Direct link to Creating an Incremental Materialization" title="Direct link to Creating an Incremental Materialization">​</a></h2><p>The previous example created a table to materialize the model. This table will be reconstructed for each dbt execution. This may be infeasible and extremely costly for larger result sets or complex transformations. To address this challenge and reduce the build time, dbt offers Incremental materializations. This allows dbt to insert or update records into a table since the last execution, making it appropriate for event-style data. Under the hood a temporary table is created with all the updated records and then all the untouched records as well as the updated records are inserted into a new target table. This results in similar <a href="#limitations">limitations</a> for large result sets as for the table model.</p><p>To overcome these limitations for large sets, the plugin supports ‘inserts_only‘ mode, where all the updates are inserted into the target table without creating a temporary table (more about it below).</p><p>To illustrate this example, we will add the actor &quot;Clicky McClickHouse&quot;, who will appear in an incredible 910 movies - ensuring he has appeared in more films than even <a href="https://en.wikipedia.org/wiki/Mel_Blanc" target="_blank" rel="noopener noreferrer">Mel Blanc</a>.</p><ol><li><p>First, we modify our model to be of type incremental. This addition requires:</p><ol><li><strong>unique_key</strong> - To ensure the plugin can uniquely identify rows, we must provide a unique_key - in this case, the <code>id</code> field from our query will suffice. This ensures we will have no row duplicates in our materialized table. For more details on uniqueness constraints, see<a href="https://docs.getdbt.com/docs/building-a-dbt-project/building-models/configuring-incremental-models#defining-a-uniqueness-constraint-optional" target="_blank" rel="noopener noreferrer"> here</a>.</li><li><strong>Incremental filter</strong> - We also need to tell dbt how it should identify which rows have changed on an incremental run. This is achieved by providing a delta expression. Typically this involves a timestamp for event data; hence our updated_at timestamp field. This column, which defaults to the value of now() when rows are inserted, allows new roles to be identified. Additionally, we need to identify the alternative case where new actors are added. Using the {{this}} variable, to denote the existing materialized table, this gives us the expression <code>where id &gt; (select max(id) from {{ this }}) or updated_at &gt; (select max(updated_at) from {{this}})</code>. We embed this inside the <code>{% if is_incremental() %}</code> condition, ensuring it is only used on incremental runs and not when the table is first constructed. For more details on filtering rows for incremental models, see <a href="https://docs.getdbt.com/docs/building-a-dbt-project/building-models/configuring-incremental-models#filtering-rows-on-an-incremental-run" target="_blank" rel="noopener noreferrer">this discussion in the dbt docs</a>.</li></ol><p>Update the file <code>actor_summary.sql</code> as follows:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{{ config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">order_by</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;(updated_at, id, name)&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">engine</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;MergeTree()&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> materialized</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;incremental&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> unique_key</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">with</span><span class="token plain"> actor_summary </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">any</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">actor_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> num_movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">avg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> avg_rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">genre</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">         </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> genres</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">director_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">created_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> updated_at</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">{{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">first_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">last_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> actor_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">rank </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            genre</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">{{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">first_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">last_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> director_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            created_at</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;roles&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }} </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;roles&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }} </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;roles&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;genres&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }} </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;genres&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movie_directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }} </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movie_directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }} </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movie_directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">director_id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> actor_summary</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> is_incremental</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">-- this filter will only be applied on an incremental run</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> {{ this }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">or</span><span class="token plain"> updated_at </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">updated_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> {{this}}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> endif </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that our model will only respond to updates and additions to the <code>roles</code> and <code>actors</code> tables. To respond to all tables, users would be encouraged to split this model into multiple sub-models - each with their own incremental criteria. These models can in turn be referenced and connected. For further details on cross-referencing models see <a href="https://docs.getdbt.com/reference/dbt-jinja-functions/ref" target="_blank" rel="noopener noreferrer">here</a>.</p></li><li><p>Execute a <code>dbt run</code> and confirm the results of the resulting table:</p><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-user@clickhouse:~/imdb$  dbt run</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">15:33:34  Running with dbt=1.1.0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">15:33:34  Found 1 model, 0 tests, 1 snapshot, 0 analyses, 181 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">15:33:34</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">15:33:35  Concurrency: 1 threads (target=&#x27;dev&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">15:33:35</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">15:33:35  1 of 1 START incremental model imdb_dbt.actor_summary........................... [RUN]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">15:33:41  1 of 1 OK created incremental model imdb_dbt.actor_summary...................... [OK in 6.33s]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">15:33:41</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">15:33:41  Finished running 1 incremental model in 7.30s.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">15:33:41</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">15:33:41  Completed successfully</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">15:33:41</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">15:33:41  Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> imdb_dbt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_summary </span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> num_movies </span><span class="token keyword" style="color:rgb(86, 156, 214)">DESC</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+------------+----------+------------------+------+---------+-------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|id    |name        |num_movies|avg_rank          |genres|directors|updated_at         |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+------------+----------+------------------+------+---------+-------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|45332 |Mel Blanc   |832       |6.175853582979779 |18    |84       |2022-04-26 15:26:55|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|621468|Bess Flowers|659       |5.57727638854796  |19    |293      |2022-04-26 15:26:57|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|372839|Lee Phelps  |527       |5.032976449684617 |18    |261      |2022-04-26 15:26:56|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|283127|Tom London  |525       |2.8721716524875673|17    |203      |2022-04-26 15:26:56|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|356804|Bud Osborne |515       |2.0389507108727773|15    |149      |2022-04-26 15:26:56|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+------------+----------+------------------+------+---------+-------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>We will now add data to our model to illustrate an incremental update. Add our actor  &quot;Clicky McClickHouse&quot; to the <code>actors</code> table:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">845466</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Clicky&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;McClickHouse&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;M&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Let&#x27;s have Clicky star in 910 random movies:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">roles</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">now</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> created_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">845466</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> actor_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> id </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Himself&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> role</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">910</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OFFSET</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Confirm he is indeed now the actor with the most appearances by querying the underlying source table and bypassing any dbt models:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">any</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">actor_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">          </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> num_movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">avg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> avg_rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">genre</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">         </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> unique_genres</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">director_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> uniq_directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">created_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">          </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> updated_at</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id                                                   </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">first_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">last_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">       </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> actor_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">rank                                                 </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                genre</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">first_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">last_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> director_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                created_at</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">roles </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">roles</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">roles</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">genres </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">genres</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_directors </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">directors </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">director_id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> num_movies </span><span class="token keyword" style="color:rgb(86, 156, 214)">DESC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+-------------------+----------+------------------+------+---------+-------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|id    |name               |num_movies|avg_rank          |genres|directors|updated_at         |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+-------------------+----------+------------------+------+---------+-------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|845466|Clicky McClickHouse|910       |1.4687938697032283|21    |662      |2022-04-26 16:20:36|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|45332 |Mel Blanc          |909       |5.7884792542982515|19    |148      |2022-04-26 16:17:42|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+-------------------+----------+------------------+------+---------+-------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Execute a <code>dbt run</code> and confirm our model has been updated and matches the above results:</p><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-user@clickhouse:~/imdb$  dbt run</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:16  Running with dbt=1.1.0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:16  Found 1 model, 0 tests, 1 snapshot, 0 analyses, 181 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:16</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:17  Concurrency: 1 threads (target=&#x27;dev&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:17</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:17  1 of 1 START incremental model imdb_dbt.actor_summary........................... [RUN]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:24  1 of 1 OK created incremental model imdb_dbt.actor_summary...................... [OK in 6.82s]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:24</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:24  Finished running 1 incremental model in 7.79s.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:24</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:24  Completed successfully</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:24</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:24  Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> imdb_dbt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_summary </span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> num_movies </span><span class="token keyword" style="color:rgb(86, 156, 214)">DESC</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+-------------------+----------+------------------+------+---------+-------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|id    |name               |num_movies|avg_rank          |genres|directors|updated_at         |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+-------------------+----------+------------------+------+---------+-------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|845466|Clicky McClickHouse|910       |1.4687938697032283|21    |662      |2022-04-26 16:20:36|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|45332 |Mel Blanc          |909       |5.7884792542982515|19    |148      |2022-04-26 16:17:42|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+-------------------+----------+------------------+------+---------+-------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="internals">Internals<a href="#internals" class="hash-link" aria-label="Direct link to Internals" title="Direct link to Internals">​</a></h3><p>We can identify the statements executed to achieve the above incremental update by querying ClickHouse’s query log.</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> event_time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> query  </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> system</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">query_log </span><span class="token keyword" style="color:rgb(86, 156, 214)">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;QueryStart&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">AND</span><span class="token plain"> query </span><span class="token operator" style="color:rgb(212, 212, 212)">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;%dbt%&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">AND</span><span class="token plain"> event_time </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> subtractMinutes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">now</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">15</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> event_time </span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">100</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Adjust the above query to the period of execution. We leave result inspection to the user but highlight the general strategy used by the plugin to perform incremental updates:</p><ol><li>The plugin creates a temporary table <code>actor_sumary__dbt_tmp</code>. Rows that have changed are streamed into this table.</li><li>A new table, <code>actor_summary_new,</code> is created. The rows from the old table are, in turn, streamed from the old to new, with a check to make sure row ids do not exist in the temporary table. This effectively handles updates and duplicates.</li><li>The results from the temporary table are streamed into the new <code>actor_summary</code> table:</li><li>Finally, the new table is exchanged atomically with the old version via an <code>EXCHANGE TABLES</code> statement. The old and temporary tables are in turn dropped.</li></ol><p>This is visualized below:</p><img loading="lazy" src="/docs/assets/images/dbt_05-1e364a9c0b3e8d517a559b582c66571c.png" class="image" alt="incremental updates dbt" style="width:100%" class="img_ev3q"><p>This strategy may encounter challenges on very large models. For further details see <a href="#limitations">Limitations</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="append-strategy-inserts-only-mode">Append Strategy (inserts-only mode)<a href="#append-strategy-inserts-only-mode" class="hash-link" aria-label="Direct link to Append Strategy (inserts-only mode)" title="Direct link to Append Strategy (inserts-only mode)">​</a></h3><p>To overcome the limitations of large datasets in incremental models, the plugin uses the dbt configuration parameter <code>incremental_strategy</code>. This can be set to the value <code>append</code>. When set, updated rows are inserted directly into the target table (a.k.a <code>imdb_dbt.actor_summary</code>) and no temporary table is created.
Note: Append only mode requires your data to be immutable or for duplicates to be acceptable. If you want an incremental table model that supports altered rows don’t use this mode!</p><p>To illustrate this mode, we will add another new actor and re-execute dbt run with <code>incremental_strategy=&#x27;append&#x27;</code>.</p><ol><li><p>Configure append only mode in actor_summary.sql:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{{ config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">order_by</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;(updated_at, id, name)&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">engine</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;MergeTree()&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> materialized</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;incremental&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> unique_key</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> incremental_strategy</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;append&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Let’s add another famous actor - Danny DeBito</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">845467</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Danny&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;DeBito&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;M&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Let&#x27;s star Danny in 920 random movies.</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">roles</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">now</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> created_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">845467</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> actor_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> id </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Himself&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> role</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">920</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OFFSET</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Execute a dbt run and confirm that Danny was added to the actor-summary table</p><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-user@clickhouse:~/imdb$ dbt run</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:16  Running with dbt=1.1.0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:16  Found 1 model, 0 tests, 1 snapshot, 0 analyses, 186 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:16</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:17  Concurrency: 1 threads (target=&#x27;dev&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:17</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:17  1 of 1 START incremental model imdb_dbt.actor_summary........................... [RUN]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:24  1 of 1 OK created incremental model imdb_dbt.actor_summary...................... [OK in 0.17s]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:24</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:24  Finished running 1 incremental model in 0.19s.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:24</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:24  Completed successfully</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:24</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">16:12:24  Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> imdb_dbt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_summary </span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> num_movies </span><span class="token keyword" style="color:rgb(86, 156, 214)">DESC</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+-------------------+----------+------------------+------+---------+-------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|id    |name               |num_movies|avg_rank          |genres|directors|updated_at         |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+-------------------+----------+------------------+------+---------+-------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|845467|Danny DeBito       |920       |1.4768987303293204|21    |670      |2022-04-26 16:22:06|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|845466|Clicky McClickHouse|910       |1.4687938697032283|21    |662      |2022-04-26 16:20:36|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|45332 |Mel Blanc          |909       |5.7884792542982515|19    |148      |2022-04-26 16:17:42|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+-------------------+----------+------------------+------+---------+-------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p>Note how much faster that incremental was compared to the insertion of Clicky.</p><p>Checking again the query_log table reveals the differences between the 2 incremental runs:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">insert</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">into</span><span class="token plain"> imdb_dbt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_summary </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;id&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;num_movies&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;avg_rank&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;genres&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;directors&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;updated_at&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">with</span><span class="token plain"> actor_summary </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">any</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">actor_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> num_movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token function" style="color:rgb(220, 220, 170)">avg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> avg_rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">genre</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">         </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> genres</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">director_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token function" style="color:rgb(220, 220, 170)">max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">created_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> updated_at</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">first_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">last_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> actor_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">rank </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         genre</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">first_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">last_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> director_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         created_at</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">roles </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">roles</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">roles</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">genres </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">genres</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_directors </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">         </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">directors </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">director_id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">   </span><span class="token keyword" style="color:rgb(86, 156, 214)">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> actor_summary</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">-- this filter will only be applied on an incremental run</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> imdb_dbt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_summary</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">or</span><span class="token plain"> updated_at </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">updated_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> imdb_dbt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_summary</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this run, only the new rows are added straight to imdb_dbt.actor_summary table and there is no table creation involved.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deleteinsert-mode-experimental">Delete+Insert mode (Experimental)<a href="#deleteinsert-mode-experimental" class="hash-link" aria-label="Direct link to Delete+Insert mode (Experimental)" title="Direct link to Delete+Insert mode (Experimental)">​</a></h3><p>Historically ClickHouse has had only limited support for updates and deletes, in the form of asynchronous <a href="/docs/en/sql-reference/statements/alter">Mutations</a>.  These can be extremely IO-intensive and should generally be avoided.</p><p>ClickHouse 22.8 introduced <a href="/docs/en/sql-reference/statements/delete">Lightweight deletes</a>. These are currently experimental but offer a more performant means of deleting data.</p><p>This mode can be configured for a model via the <code>incremental_strategy</code> parameter i.e.</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{{ config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">order_by</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;(updated_at, id, name)&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">engine</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;MergeTree()&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> materialized</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;incremental&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> unique_key</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> incremental_strategy</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;delete+insert&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This strategy operates directly on the target model&#x27;s table, so if there is an issue during the operation, the data in the incremental model is likely to be in an invalid state -  there is no atomic update.</p><p>In summary, this approach:</p><ol><li>The plugin creates a temporary table <code>actor_sumary__dbt_tmp</code>. Rows that have changed are streamed into this table.</li><li>A <code>DELETE</code> is issued against the current <code>actor_summary</code> table. Rows are deleted by id from <code>actor_sumary__dbt_tmp</code></li><li>The rows from <code>actor_sumary__dbt_tmp</code> are inserted into <code>actor_summary</code> using an <code>INSERT INTO actor_summary SELECT * FROM actor_sumary__dbt_tmp</code>.</li></ol><p>This process is shown below:</p><img loading="lazy" src="/docs/assets/images/dbt_06-179ed8803cfcbb5ed7661a25cf33cb30.png" class="image" alt="lightweight delete incremental" style="width:100%" class="img_ev3q"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-snapshot">Creating a Snapshot<a href="#creating-a-snapshot" class="hash-link" aria-label="Direct link to Creating a Snapshot" title="Direct link to Creating a Snapshot">​</a></h2><p>dbt snapshots allow a record to be made of changes to a mutable model over time. This in turn allows point-in-time queries on models, where analysts can “look back in time” at the previous state of a model. This is achieved using <a href="https://en.wikipedia.org/wiki/Slowly_changing_dimension#Type_2:_add_new_row" target="_blank" rel="noopener noreferrer">type-2 Slowly Changing Dimensions</a> where from and to date columns record when a row was valid. This functionality is supported by the ClickHouse plugin and is demonstrated below.</p><p>This example assumes you have completed <a href="#creating-an-incremental-materialization">Creating an Incremental Table Model</a>. Make sure your actor_summary.sql doesn&#x27;t set inserts_only=True. Your models/actor_summary.sql should look like this:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{{ config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">order_by</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;(updated_at, id, name)&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">engine</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;MergeTree()&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> materialized</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;incremental&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> unique_key</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">with</span><span class="token plain"> actor_summary </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">any</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">actor_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> num_movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">avg</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">                </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> avg_rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">genre</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">         </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> genres</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        uniqExact</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">director_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> directors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">created_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> updated_at</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">{{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">first_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">last_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> actor_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">rank </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> rank</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            genre</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            concat</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">{{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">first_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27; &#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">last_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> director_name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            created_at</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;roles&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }} </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;roles&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }} </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;roles&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;genres&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }} </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;genres&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movie_directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }} </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movie_directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">movie_id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movies&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">LEFT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">JOIN</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }} </span><span class="token keyword" style="color:rgb(86, 156, 214)">ON</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> {{ source</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;imdb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;movie_directors&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">director_id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> id</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> actor_summary</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> is_incremental</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">-- this filter will only be applied on an incremental run</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> {{ this }}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">or</span><span class="token plain"> updated_at </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">updated_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> {{this}}</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> endif </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li><p>Create a file <code>actor_summary</code> in the snapshots directory.</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">touch</span><span class="token plain"> snapshots/actor_summary.sql</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Update the contents of the actor_summary.sql file with the following content:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">snapshot</span><span class="token plain"> actor_summary_snapshot </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{{</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">config</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">target_schema</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;snapshots&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">unique_key</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;id&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">strategy</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">updated_at</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;updated_at&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> {{ref</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;actor_summary&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">}}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">{</span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> endsnapshot </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p>A few observations regarding this content:</p><ul><li>The select query defines the results you wish to snapshot over time. The function ref is used to reference our previously created actor_summary model.</li><li>We require a timestamp column to indicate record changes. Our updated_at column (see <a href="#creating-an-incremental-materialization">Creating an Incremental Table Model</a>) can be used here. The parameter strategy indicates our use of a timestamp to denote updates, with the parameter updated_at specifying the column to use. If this is not present in your model you can alternatively use the <a href="https://docs.getdbt.com/docs/building-a-dbt-project/snapshots#check-strategy" target="_blank" rel="noopener noreferrer">check strategy</a>. This is significantly more inefficient and requires the user to specify a list of columns to compare.  dbt compares the current and historical values of these columns, recording any changes (or doing nothing if identical).</li></ul><ol start="3"><li><p>Run the command <code>dbt snapshot</code>.</p><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-user@clickhouse:~/imdb$ dbt snapshot</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:26:23  Running with dbt=1.1.0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:26:23  Found 1 model, 0 tests, 1 snapshot, 0 analyses, 181 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:26:23</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:26:25  Concurrency: 1 threads (target=&#x27;dev&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:26:25</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:26:25  1 of 1 START snapshot snapshots.actor_summary_snapshot...................... [RUN]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:26:25  1 of 1 OK snapshotted snapshots.actor_summary_snapshot...................... [OK in 0.79s]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:26:25</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:26:25  Finished running 1 snapshot in 2.11s.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:26:25</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:26:25  Completed successfully</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:26:25</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:26:25  Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p>Note how a table actor_summary_snapshot has been created in the snapshots db (determined by the target_schema parameter).</p><ol start="4"><li><p>Sampling this data you will see how dbt has included the columns dbt_valid_from and dbt_valid_to. The latter has values set to null. Subsequent runs will update this.</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> num_movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> dbt_valid_from</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> dbt_valid_to </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> snapshots</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_summary_snapshot </span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> num_movies </span><span class="token keyword" style="color:rgb(86, 156, 214)">DESC</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+----------+------------+----------+-------------------+------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|id    |first_name|last_name   |num_movies|dbt_valid_from     |dbt_valid_to|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+----------+------------+----------+-------------------+------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|845467|Danny     |DeBito      |920       |2022-05-25 19:33:32|NULL        |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|845466|Clicky    |McClickHouse|910       |2022-05-25 19:32:34|NULL        |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|45332 |Mel       |Blanc       |909       |2022-05-25 19:31:47|NULL        |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|621468|Bess      |Flowers     |672       |2022-05-25 19:31:47|NULL        |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|283127|Tom       |London      |549       |2022-05-25 19:31:47|NULL        |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+----------+------------+----------+-------------------+------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Make our favorite actor Clicky McClickHouse appear in another 10 films.</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> imdb</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">roles</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">now</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> created_at</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">845466</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> actor_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> rand</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">number</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">412320</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> movie_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Himself&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> role</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> system</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">numbers</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Re-run the dbt run command from the imdb directory. This will update the incremental model. Once this is complete, run the dbt snapshot to capture the changes.</p><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-user@clickhouse:~/imdb$ dbt run</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:14  Running with dbt=1.1.0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:14  Found 1 model, 0 tests, 1 snapshot, 0 analyses, 181 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:14</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:15  Concurrency: 1 threads (target=&#x27;dev&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:15</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:15  1 of 1 START incremental model imdb_dbt.actor_summary....................... [RUN]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:18  1 of 1 OK created incremental model imdb_dbt.actor_summary.................. [OK in 2.76s]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:18</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:18  Finished running 1 incremental model in 3.73s.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:18</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:18  Completed successfully</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:18</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:18  Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-user@clickhouse:~/imdb$ dbt snapshot</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:26  Running with dbt=1.1.0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:26  Found 1 model, 0 tests, 1 snapshot, 0 analyses, 181 macros, 0 operations, 0 seed files, 3 sources, 0 exposures, 0 metrics</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:26</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:27  Concurrency: 1 threads (target=&#x27;dev&#x27;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:27</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:27  1 of 1 START snapshot snapshots.actor_summary_snapshot...................... [RUN]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:31  1 of 1 OK snapshotted snapshots.actor_summary_snapshot...................... [OK in 4.05s]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:31</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:31  Finished running 1 snapshot in 5.02s.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:31</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:31  Completed successfully</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:31</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">13:46:31  Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>If we now query our snapshot, notice we have 2 rows for Clicky McClickHouse. Our previous entry now has a dbt_valid_to value. Our new value is recorded with the same value in the dbt_valid_from column, and a dbt_valid_to value of null. If we did have new rows, these would also be appended to the snapshot.</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> num_movies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> dbt_valid_from</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> dbt_valid_to </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> snapshots</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">actor_summary_snapshot </span><span class="token keyword" style="color:rgb(86, 156, 214)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">BY</span><span class="token plain"> num_movies </span><span class="token keyword" style="color:rgb(86, 156, 214)">DESC</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+----------+------------+----------+-------------------+-------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|id    |first_name|last_name   |num_movies|dbt_valid_from     |dbt_valid_to       |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+----------+------------+----------+-------------------+-------------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|845467|Danny     |DeBito      |920       |2022-05-25 19:33:32|NULL               |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|845466|Clicky    |McClickHouse|920       |2022-05-25 19:34:37|NULL               |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|845466|Clicky    |McClickHouse|910       |2022-05-25 19:32:34|2022-05-25 19:34:37|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|45332 |Mel       |Blanc       |909       |2022-05-25 19:31:47|NULL               |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|621468|Bess      |Flowers     |672       |2022-05-25 19:31:47|NULL               |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+------+----------+------------+----------+-------------------+-------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p>For further details on dbt snapshots see <a href="https://docs.getdbt.com/docs/building-a-dbt-project/snapshots" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-seeds">Using Seeds<a href="#using-seeds" class="hash-link" aria-label="Direct link to Using Seeds" title="Direct link to Using Seeds">​</a></h2><p>dbt provides the ability to load data from CSV files. This capability is not suited to loading large exports of a database and is more designed for small files typically used for code tables and <a href="/docs/en/sql-reference/dictionaries">dictionaries</a>, e.g. mapping country codes to country names. For a simple example, we generate and then upload a list of genre codes using the seed functionality.</p><ol><li><p>We generate a list of genre codes from our existing dataset. From the dbt directory, use the <code>clickhouse-client</code> to create a file <code>seeds/genre_codes.csv</code>:</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-user@clickhouse:~/imdb$ clickhouse-client --password </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">password</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> --query</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token string" style="color:rgb(206, 145, 120)">&quot;SELECT genre, ucase(substring(genre, 1, 3)) as code FROM imdb.genres GROUP BY genre</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token string" style="color:rgb(206, 145, 120)">LIMIT 100 FORMAT CSVWithNames&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> seeds/genre_codes.csv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Execute the <code>dbt seed</code> command. This will create a new table <code>genre_codes</code> in our database <code>imdb_dbt</code> (as defined by our schema configuration) with the rows from our csv file.</p><div class="language-bash codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">clickhouse-user@clickhouse:~/imdb$ dbt seed</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:03:23  Running with </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">dbt</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">1.1</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:03:23  Found </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> model, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> tests, </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> snapshot, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> analyses, </span><span class="token number" style="color:rgb(181, 206, 168)">181</span><span class="token plain"> macros, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> operations, </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> seed file, </span><span class="token number" style="color:rgb(181, 206, 168)">6</span><span class="token plain"> sources, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> exposures, </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> metrics</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:03:23</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:03:24  Concurrency: </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> threads </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">target</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;dev&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:03:24</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:03:24  </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> of </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> START seed </span><span class="token function" style="color:rgb(220, 220, 170)">file</span><span class="token plain"> imdb_dbt.genre_codes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">. </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">RUN</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:03:24  </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> of </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> OK loaded seed </span><span class="token function" style="color:rgb(220, 220, 170)">file</span><span class="token plain"> imdb_dbt.genre_codes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">. </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">INSERT </span><span class="token number" style="color:rgb(181, 206, 168)">21</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain">.65s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:03:24</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:03:24  Finished running </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> seed </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">.62s.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:03:24</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:03:24  Completed successfully</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:03:24</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:03:24  Done. </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">PASS</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">WARN</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">ERROR</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">SKIP</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">TOTAL</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Confirm these have been loaded:</p><div class="language-sql codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> imdb_dbt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">genre_codes </span><span class="token keyword" style="color:rgb(86, 156, 214)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-response codeBlockContainer_APcc theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-response codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">+-------+----+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|genre  |code|</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+-------+----+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|Drama  |DRA |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|Romance|ROM |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|Short  |SHO |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|Mystery|MYS |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|Adult  |ADU |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|Family |FAM |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|Action |ACT |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|Sci-Fi |SCI |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|Horror |HOR |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">|War    |WAR |</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+-------+----+=</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="limitations">Limitations<a href="#limitations" class="hash-link" aria-label="Direct link to Limitations" title="Direct link to Limitations">​</a></h2><p>The current ClickHouse plugin for dbt has several limitations users should be aware of:</p><ol><li>The plugin currently materializes models as tables using an <code>INSERT TO SELECT</code>. This effectively means data duplication. Very large datasets (PB) can result in extremely long run times, making some models unviable. Aim to minimize the number of rows returned by any query, utilizing GROUP BY where possible. Prefer models which summarize data over those which simply perform a transform whilst maintaining row counts of the source.</li><li><a href="https://docs.getdbt.com/docs/building-a-dbt-project/building-models/materializations#ephemeral" target="_blank" rel="noopener noreferrer">Ephemeral materializations</a> are not supported.</li><li>To use Distributed tables to represent a model, users must create the underlying replicated tables on each node manually. The Distributed table can, in turn, be created on top of these. The plugin does not manage cluster creation.</li><li>Only the ClickHouse native protocol is supported. There is no support for HTTP.</li><li>When dbt creates a relation (table/view) in a database, it usually creates it as: <code>{{ database }}.{{ schema }}.{{ table/view id }}</code>. ClickHouse has no notion of schemas. The plugin therefore uses <code>{{schema}}.{{ table/view id }}</code>, where <code>schema</code> is the ClickHouse database.</li></ol><p>Further Information</p><p>The previous guides only touch the surface of dbt functionality. Users are recommended to read the excellent <a href="https://docs.getdbt.com/docs/introduction" target="_blank" rel="noopener noreferrer">dbt documentation</a>.</p><p>Additional configuration for the plugin is described <a href="https://github.com/silentsokolov/dbt-clickhouse#model-configuration" target="_blank" rel="noopener noreferrer">here</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ClickHouse/clickhouse-docs/blob/main/docs/en/integrations/data-ingestion/etl-tools/dbt/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev paginationNavLink_UdUv" href="/docs/en/integrations/kafka"><svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.2751 19.175L10.3251 18.125L5.4501 13.25H21.6001V11.75H5.4501L10.3251 6.87501L9.2751 5.82501L2.5751 12.5L9.2751 19.175Z" fill="currentColor"></path></svg><div class="paginationNavContent__3xr"><div class="pagination-nav__sublabel">Previous</div><div class="paginationNavLabel_YPzM pagination-nav__label">Kafka</div></div></a><a class="pagination-nav__link pagination-nav__link--next paginationNavLink_UdUv" href="/docs/en/integrations/redshift"><div class="paginationNavContent__3xr"><div class="pagination-nav__sublabel">Next</div><div class="paginationNavLabel_YPzM pagination-nav__label">Redshift</div></div><svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.7249 19.175L13.6749 18.125L18.5499 13.25H2.3999V11.75H18.5499L13.6749 6.87501L14.7249 5.82501L21.4249 12.5L14.7249 19.175Z" fill="currentColor"></path></svg></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#concepts" class="table-of-contents__link toc-highlight">Concepts</a></li><li><a href="#setup-of-dbt-and-the-clickhouse-plugin" class="table-of-contents__link toc-highlight">Setup of dbt and the ClickHouse plugin</a><ul><li><a href="#dbt" class="table-of-contents__link toc-highlight">dbt</a></li><li><a href="#clickhouse-plugin" class="table-of-contents__link toc-highlight">ClickHouse plugin</a></li><li><a href="#prepare-clickhouse" class="table-of-contents__link toc-highlight">Prepare ClickHouse</a></li></ul></li><li><a href="#connecting-to-clickhouse" class="table-of-contents__link toc-highlight">Connecting to ClickHouse</a></li><li><a href="#creating-a-simple-view-materialization" class="table-of-contents__link toc-highlight">Creating a Simple View Materialization</a></li><li><a href="#creating-a-table-materialization" class="table-of-contents__link toc-highlight">Creating a Table Materialization</a></li><li><a href="#creating-an-incremental-materialization" class="table-of-contents__link toc-highlight">Creating an Incremental Materialization</a><ul><li><a href="#internals" class="table-of-contents__link toc-highlight">Internals</a></li><li><a href="#append-strategy-inserts-only-mode" class="table-of-contents__link toc-highlight">Append Strategy (inserts-only mode)</a></li><li><a href="#deleteinsert-mode-experimental" class="table-of-contents__link toc-highlight">Delete+Insert mode (Experimental)</a></li></ul></li><li><a href="#creating-a-snapshot" class="table-of-contents__link toc-highlight">Creating a Snapshot</a></li><li><a href="#using-seeds" class="table-of-contents__link toc-highlight">Using Seeds</a></li><li><a href="#limitations" class="table-of-contents__link toc-highlight">Limitations</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer_jryj"><div class="container_y1z5 container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© 2016&ndash;2023 ClickHouse, Inc.</div></div><div><div class="footer__links text--center"><div class="footer__links"><a href="https://clickhouse.com/legal/trademark-policy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Trademark</a><span class="footer__link-separator">·</span><a href="https://clickhouse.com/legal/privacy-policy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a><span class="footer__link-separator">·</span><a href="https://trust.clickhouse.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a><span class="footer__link-separator">·</span><a href="https://clickhouse.com/legal/agreements/terms-of-service" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Service</a></div></div></div></div><button class="colorModeButton_hk25"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.7227 0.724664C8.7227 0.330045 8.39191 0 8.0036 0C7.60809 0 7.2773 0.330045 7.2773 0.724664V2.18834C7.2773 2.57578 7.60809 2.90583 8.0036 2.90583C8.39191 2.90583 8.7227 2.57578 8.7227 2.18834V0.724664ZM11.5991 3.4009C11.3258 3.67354 11.3258 4.13274 11.6063 4.41256C11.8796 4.6852 12.347 4.69238 12.6274 4.40538L13.6629 3.3722C13.9434 3.09238 13.9362 2.62601 13.6629 2.34619C13.3897 2.07354 12.9222 2.08072 12.649 2.35336L11.5991 3.4009ZM3.37258 4.40538C3.64584 4.6852 4.11326 4.6852 4.38652 4.41256C4.66697 4.14709 4.66697 3.66637 4.4009 3.4009L3.3582 2.35336C3.09213 2.08789 2.61753 2.07354 2.34427 2.34619C2.07101 2.62601 2.06382 3.09238 2.33708 3.36502L3.37258 4.40538ZM7.9964 11.774C10.0602 11.774 11.7717 10.0664 11.7717 8C11.7717 5.93363 10.0602 4.22601 7.9964 4.22601C5.93258 4.22601 4.22112 5.93363 4.22112 8C4.22112 10.0664 5.93258 11.774 7.9964 11.774ZM7.9964 10.4395C6.65888 10.4395 5.55146 9.33453 5.55146 8C5.55146 6.66547 6.65888 5.56054 7.9964 5.56054C9.33393 5.56054 10.4413 6.66547 10.4413 8C10.4413 9.33453 9.33393 10.4395 7.9964 10.4395ZM15.2809 8.71749C15.6692 8.71749 16 8.38744 16 8C16 7.60538 15.6692 7.28251 15.2809 7.28251H13.8211C13.4328 7.28251 13.102 7.60538 13.102 8C13.102 8.38744 13.4328 8.71749 13.8211 8.71749H15.2809ZM0.719101 7.28251C0.330787 7.28251 0 7.60538 0 8C0 8.38744 0.330787 8.71749 0.719101 8.71749H2.17888C2.57438 8.71749 2.90517 8.38744 2.90517 8C2.90517 7.60538 2.57438 7.28251 2.17888 7.28251H0.719101ZM12.6202 11.5946C12.347 11.322 11.8796 11.322 11.5991 11.5946C11.3258 11.8744 11.3258 12.3336 11.6063 12.6135L12.649 13.6538C12.9294 13.9265 13.3897 13.9193 13.6701 13.6395C13.9434 13.3668 13.9434 12.9076 13.6629 12.6278L12.6202 11.5946ZM2.33708 12.6206C2.05663 12.9004 2.05663 13.3668 2.3227 13.6395C2.60315 13.9121 3.07056 13.9193 3.34382 13.6466L4.38652 12.6135C4.66697 12.3336 4.66697 11.8744 4.4009 11.6018C4.12045 11.322 3.65303 11.322 3.37258 11.5946L2.33708 12.6206ZM8.7227 13.8117C8.7227 13.4242 8.39191 13.0942 8.0036 13.0942C7.60809 13.0942 7.2773 13.4242 7.2773 13.8117V15.2753C7.2773 15.6628 7.60809 16 8.0036 16C8.39191 16 8.7227 15.6628 8.7227 15.2753V13.8117Z" fill="currentColor"></path></svg><span>light Mode</span></button></footer></div>
<script src="/docs/assets/js/runtime~main.92881152.js"></script>
<script src="/docs/assets/js/main.92fcbde1.js"></script>
</body>
</html>